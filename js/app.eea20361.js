(function(t){function e(e){for(var a,o,s=e[0],c=e[1],l=e[2],d=0,g=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&g.push(n[o][0]),n[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);h&&h(e);while(g.length)g.shift()();return r.push.apply(r,l||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],a=!0,s=1;s<i.length;s++){var c=i[s];0!==n[c]&&(a=!1)}a&&(r.splice(e--,1),t=o(o.s=i[0]))}return t}var a={},n={app:0},r=[];function o(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=a,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(i,a,function(e){return t[e]}.bind(null,a));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var h=c;r.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("cd49")},"07f5":function(t,e,i){t.exports=i.p+"img/help_edit_train.67395182.png"},"09ec":function(t,e,i){},"41d8":function(t,e,i){t.exports=i.p+"img/help_select_train.6cd1d819.png"},"5c0b":function(t,e,i){"use strict";i("9c0c")},"60b1":function(t,e,i){t.exports=i.p+"img/help_tips.12f4142e.png"},"965e":function(t,e,i){t.exports=i.p+"img/help_edit_time.25aa545d.png"},"9c0c":function(t,e,i){},a8d2:function(t,e,i){t.exports=i.p+"img/diafreaks_logo.8b0abdc8.png"},b6b6:function(t,e,i){},bfd4:function(t,e,i){t.exports=i.p+"img/help_add_new_train.0fab88c8.png"},c98c:function(t,e,i){t.exports=i.p+"img/help_add_new_station.d55b6e32.png"},cd49:function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var a=i("2b0e"),n=i("289d"),r=(i("5abe"),i("a925")),o=i("7591"),s=i.n(o),c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("diagram-view",{attrs:{id:"diagram-view",diagram:t.diagram,viewConfig:t.viewConfig,historyManager:t.historyManager}}),"help"==t.subView?i("help-view",{attrs:{id:"help-pane"}}):t._e(),i("div",{attrs:{id:"nav-pane"}},[t._m(0),i("span",{attrs:{id:"nav-pane-buttons"}},[i("span",{attrs:{id:"nav-pane-buttons-left"}},[t.enableSwitchEditMode?i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.editButtonTooltip"),type:"is-light"}},[i("b-button",{class:t.viewConfig.editMode?"is-selected":"",attrs:{"icon-left":"pencil-outline",size:"medium"},on:{click:t.onEditButtonClick}})],1)],1):t._e(),t.viewConfig.editMode?i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.undoButtonTooltip"),type:"is-light"}},[i("b-button",{attrs:{"icon-left":"undo",size:"medium",disabled:!t.historyManager.undoable},on:{click:t.onUndoButtonClick}})],1)],1):t._e(),t.viewConfig.editMode?i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.redoButtonTooltip"),type:"is-light"}},[i("b-button",{attrs:{"icon-left":"redo",size:"medium",disabled:!t.historyManager.redoable},on:{click:t.onRedoButtonClick}})],1)],1):t._e(),t.viewConfig.editMode?i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:Object.keys(t.diagram.trains).length>0?t.$t("message.vanishTrainsButtonTooltip"):t.$t("message.vanishStationsButtonTooltip"),type:"is-light"}},[i("b-button",{attrs:{"icon-left":"vanish",size:"medium"},on:{click:t.onVanishButtonClick}})],1)],1):t._e(),i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.uploadButtonTooltip"),type:"is-light"}},[i("b-button",{attrs:{"icon-left":"upload",size:"medium"},on:{click:t.onUploadButtonClick}})],1)],1),i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.downloadButtonTooltip"),type:"is-light"}},[i("b-button",{attrs:{"icon-left":"download",size:"medium"},on:{click:t.onDownloadButtonClick}})],1)],1)]),i("span",{attrs:{id:"nav-pane-buttons-spacer"}}),i("span",{attrs:{id:"nav-pane-buttons-right"}},[t.enableSwitchEditMode?i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.helpButtonTooltip"),type:"is-light"}},[i("b-button",{class:"help"==t.subView?"is-selected":"",attrs:{"icon-left":"help",size:"medium"},on:{click:t.onHelpButtonClick}})],1)],1):t._e()])])])],1)},l=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",{staticClass:"nav-pane-item",attrs:{id:"nav-pane-logo"}},[a("img",{staticStyle:{height:"32px"},attrs:{src:i("a8d2")}})])}],h=i("1da1"),d=i("d4ec"),g=i("bee2"),u=i("262e"),v=i("2caf"),f=(i("96cf"),i("d3b7"),i("b64b"),i("b0c0"),i("99af"),i("25f0"),i("3ca3"),i("ddb0"),i("2b3d"),i("9ab4")),m=i("1b40"),p=(i("a434"),function(){function t(e){Object(d["a"])(this,t),this.capacity=e,this.undos=[],this.redos=[]}return Object(g["a"])(t,[{key:"undoable",get:function(){return this.undos.length>0}},{key:"redoable",get:function(){return this.redos.length>0}},{key:"push",value:function(t){this.undos.length>=this.capacity&&this.undos.splice(0,this.undos.length-this.capacity+1),this.undos.push(t),this.redos.splice(0)}},{key:"clear",value:function(){this.undos.splice(0),this.redos.splice(0)}},{key:"undo",value:function(){var t=this.undos.pop();t&&(this.redos.push(t),t.undo.apply(t.this))}},{key:"redo",value:function(){var t=this.redos.pop();t&&(this.undos.push(t),t.redo.apply(t.this))}}]),t}()),b=i("53ca"),S=i("b85c"),y=(i("07ac"),i("159b"),i("c1f9"),i("d81d"),function(){function t(){Object(d["a"])(this,t),this.minimumTimeUnit=5,this.minPlotTime=0,this.maxPlotTime=108e3,this.fontFamily="Verdana, sans-serif",this.topPaneHeight=30,this.hourlyLabelBottomMargin=4,this.hourlyLabelFontSize=14,this.hourlyLabelColor="rgb(128, 192, 128)",this.hourlyGridLineWidth=2.25,this.hourlyGridLineColor="rgb(128, 192, 128)",this.majorMinutelyGridLineSpan=600,this.majorMinutelyGridLineWidth=1.5,this.majorMinutelyGridLineColor="rgb(128, 192, 128)",this.minorMinutelyGridLineSpan=120,this.minorMinutelyGridLineWidth=.75,this.minorMinutelyGridLineColor="rgb(128, 192, 128)",this.leftPaneWidth=140,this.stationLabelLeftMargin=14,this.stationLabelRightMargin=14,this.stationLabelFontSize=14,this.stationLabelColor="rgb(128, 192, 128)",this.stationLineWidth=1,this.stationLineColor="rgb(128, 192, 128)",this.plotPanePadding=4,this.trackLabelLeftMargin=10,this.trackLabelFontSize=11,this.trackLabelColor="rgb(128, 192, 128)",this.trackLineWidth=.75,this.trackLineColor="rgb(128, 192, 128)",this.trackLineSpan=12,this.scrollX=1728,this.scrollY=0,this.xScale=.08,this.yScale=10,this.trainPathWidth=1,this.trainPathColor="rgb(0, 0, 0)"}return Object(g["a"])(t,null,[{key:"fromJSON",value:function(e){if(!e||"object"!=Object(b["a"])(e))throw"Invalid JSON";var i=new t;return Object.assign(i,e),i}}]),t}()),w=function(){function t(e,i,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(d["a"])(this,t),this.station=e,this.id=i,this.name=a,this.relY=n}return Object(g["a"])(t,[{key:"toJSON",value:function(){return{id:this.id,name:this.name}}}],[{key:"fromJSON",value:function(e,i){if(!e||"object"!=Object(b["a"])(e)||null==e.id)throw"Invalid JSON @ Track";return new t(i,e.id,e.name,e.relY)}}]),t}(),k=function(){function t(e,i,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;Object(d["a"])(this,t),this.id=e,this.name=i,this.mileage=a,this.expanded=n,this.topRelY=r,this.bottomRelY=o,this.tracks=[]}return Object(g["a"])(t,[{key:"addNewTrack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.tracks.length;return this.tracks.splice(e,0,t),this.tracks[e]}},{key:"removeTrack",value:function(t){var e=this.tracks.indexOf(t);e>=0&&this.tracks.splice(e,1)}},{key:"toJSON",value:function(){return{id:this.id,name:this.name,mileage:this.mileage,tracks:this.tracks,expanded:this.expanded}}}],[{key:"fromJSON",value:function(e){if(!e||"object"!=Object(b["a"])(e)||null==e.id||null==e.name||null==e.mileage||!Array.isArray(e.tracks))throw"Invalid JSON @ Station";var i=new t(e.id,e.name,e.mileage,!!e.expanded);return e.tracks.map((function(t){return w.fromJSON(t,i)})).forEach((function(t){return i.tracks.push(t)})),i}}]),t}(),O=(i("5db7"),i("73d9"),i("7db0"),function(){function t(e,i,a){Object(d["a"])(this,t),this.train=e,this.track=i,this.time=a,this.privateId=++t.maxPrivateId}return Object(g["a"])(t,[{key:"station",get:function(){return this.track.station}},{key:"next",get:function(){var t=this.train.stevs.indexOf(this);return t>=0?this.train.stevs[t+1]:void 0}},{key:"prev",get:function(){var t=this.train.stevs.indexOf(this);return t>=0?this.train.stevs[t-1]:void 0}}],[{key:"fromJSONStop",value:function(e,i,a){if(!e||"object"!=Object(b["a"])(e)||null==e.stationId||null==e.trackId||null==e.arrTime||null==e.depTime)throw"Invalid JSON @ Stop";var n=a[e.stationId],r=n&&n.tracks.find((function(t){return t.id==e.trackId}));if(!n||!r)throw"Invalid data @ Stop";return e.arrTime==e.depTime?[new t(i,r,e.arrTime)]:[new t(i,r,e.arrTime),new t(i,r,e.depTime)]}}]),t}());O.maxPrivateId=0;var j=function(){function t(e,i){Object(d["a"])(this,t),this.id=e,this.name=i,this.stevs=[]}return Object(g["a"])(t,[{key:"addNewStopEvent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.stevs.length;return this.stevs.splice(e,0,t),this.stevs[e]}},{key:"removeStopEvent",value:function(t){var e=this.stevs.indexOf(t);e>=0&&this.stevs.splice(e,1)}},{key:"getStopEventsInRange",value:function(t){var e,i=[],a=!1,n=Object(S["a"])(this.stevs);try{for(n.s();!(e=n.n()).done;){var r=e.value;r==t.from&&(a=!0),a&&i.push(r),r==t.to&&(a=!1)}}catch(o){n.e(o)}finally{n.f()}return i}},{key:"toJSON",value:function(){var t,e=[],i=Object(S["a"])(this.stevs);try{for(i.s();!(t=i.n()).done;){var a=t.value,n=e[e.length-1];n&&n.trackId==a.track.id&&n.arrTime==n.depTime?n.depTime=a.time:e.push({stationId:a.station.id,trackId:a.track.id,arrTime:a.time,depTime:a.time})}}catch(r){i.e(r)}finally{i.f()}return{id:this.id,name:this.name,stops:e}}}],[{key:"fromJSON",value:function(e,i){if(!e||"object"!=Object(b["a"])(e)||null==e.id||null==e.name||!Array.isArray(e.stops))throw"Invalid JSON @ Train";var a=new t(e.id,e.name);return e.stops.flatMap((function(t){return O.fromJSONStop(t,a,i)})).forEach((function(t){return a.stevs.push(t)})),a}}]),t}(),T=function(){function t(e,i,a){Object(d["a"])(this,t),this.config=e,this.stations=i,this.trains=a,this.maxId=0,this.maxRelY=0}return Object(g["a"])(t,[{key:"getYByRelY",value:function(t){return t+this.config.topPaneHeight-this.config.scrollY}},{key:"getRelYByY",value:function(t){return t-this.config.topPaneHeight+this.config.scrollY}},{key:"getXByTime",value:function(t){return t*this.config.xScale+this.config.leftPaneWidth-this.config.scrollX}},{key:"getTimeByX",value:function(t){return(t-this.config.leftPaneWidth+this.config.scrollX)/this.config.xScale}},{key:"getStationsInMileageOrder",value:function(){return Object.values(this.stations).sort((function(t,e){return t.mileage-e.mileage}))}},{key:"genId",value:function(){return++this.maxId}},{key:"releaseId",value:function(t){t==this.maxId&&--this.maxId}},{key:"addNewStation",value:function(t){return a["default"].set(this.stations,t.id,t)}},{key:"removeStation",value:function(t){a["default"].delete(this.stations,t.id)}},{key:"addNewTrain",value:function(t){return a["default"].set(this.trains,t.id,t)}},{key:"removeTrain",value:function(t){a["default"].delete(this.trains,t.id)}},{key:"updateY",value:function(){var t=this;if(0!=Object.keys(this.stations).length){var e,i=this.getStationsInMileageOrder(),a=i[0].mileage,n=Object(S["a"])(i);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.mileage=r.mileage-a}}catch(d){n.e(d)}finally{n.f()}var o,s=this.config.plotPanePadding,c=0,l=Object(S["a"])(i);try{for(l.s();!(o=l.n()).done;){var h=o.value;s+=(h.mileage-c)*this.config.yScale,h.topRelY=s,h.expanded?(h.tracks.forEach((function(e,i){e.relY=s+(i+1)*t.config.trackLineSpan})),h.bottomRelY=s+(h.tracks.length+1)*this.config.trackLineSpan,s+=(h.tracks.length+1)*this.config.trackLineSpan):(Object.values(h.tracks).forEach((function(t){return t.relY=s})),h.bottomRelY=s),c=h.mileage}}catch(d){l.e(d)}finally{l.f()}this.maxRelY=i[i.length-1].bottomRelY+this.config.plotPanePadding}else this.maxRelY=0}},{key:"toJSON",value:function(){return{config:this.config,stations:this.stations,trains:this.trains}}}],[{key:"fromJSON",value:function(e){if(!e||"object"!=Object(b["a"])(e)||"object"!=Object(b["a"])(e.stations)||"object"!=Object(b["a"])(e.trains))throw"Invalid JSON";for(var i=y.fromJSON(e.config||{}),a=Object.fromEntries(Object.values(e.stations).map((function(t){return[t.id,k.fromJSON(t)]}))),n=Object.fromEntries(Object.values(e.trains).map((function(t){return[t.id,j.fromJSON(t,a)]}))),r=new t(i,a,n),o=e.maxId?Math.max(e.maxId,0):0,s=0,c=Object.values(a);s<c.length;s++){var l=c[s];o=Math.max(l.id,o);var h,d=Object(S["a"])(l.tracks);try{for(d.s();!(h=d.n()).done;){var g=h.value;o=Math.max(g.id,o)}}catch(m){d.e(m)}finally{d.f()}}for(var u=0,v=Object.values(n);u<v.length;u++){var f=v[u];o=Math.max(f.id,o)}return r.maxId=o,r.updateY(),r}}]),t}(),M=function t(){Object(d["a"])(this,t),this.minHitWidth=3,this.pointerWidth=3,this.pointerColor="rgb(0, 0, 0)",this.pointerLabelFontSize=12,this.pointerPrecisePixelPerTimeUnit=5,this.selectedTrackLabelColor="rgb(255, 0, 0)",this.selectedTrackLineColor="rgb(255, 0, 0)",this.selectedTrainPathColor="rgb(255, 0, 0)",this.selectedTrainPathWidthScale=1.5,this.selectedTrainPathMarkerWidth=5,this.selectedTrainPathMarkerColor="rgb(255, 0, 0)",this.unselectedTrainPathOpacity=.5,this.markerLabelMaxDistance=20,this.markerLabelColor="rgb(255, 0, 0)",this.markerLabelFontSize=12,this.markerLabelLineHeight=16,this.wheelScale=.1,this.editMode=!0},P=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"diagram-view"},[i("stage",{staticClass:"diagram-view-stage",on:{stationNameInputStart:t.onStationNameInputStart,trackNameInputStart:t.onTrackNameInputStart}}),i("div",{staticClass:"diagram-view-ui"},[i("station-name-input",{ref:"stationNameInput"}),i("track-name-input",{ref:"trackNameInput"}),t._l(Object.values(t.diagram.stations),(function(e){return i("station-expand-button",{key:"station-expand-button-"+e.id,attrs:{station:e},on:{trackNameInputStart:t.onTrackNameInputStart}})})),t._l(Object.values(t.diagram.stations),(function(t){return i("station-remove-button",{key:"station-remove-button-"+t.id,attrs:{station:t}})})),t._l(Object.values(t.diagram.stations),(function(e){return i("station-add-track-button",{key:"station-add-track-button-"+e.id,attrs:{station:e},on:{trackNameInputStart:t.onTrackNameInputStart}})})),t._l(Object.values(t.diagram.stations),(function(e){return t._l(e.tracks,(function(t){return i("station-remove-track-button",{key:"station-remove-track-button-"+e.id+"-"+t.id,attrs:{station:e,track:t}})}))}))],2)],1)},Y=[],L=function(){function t(){Object(d["a"])(this,t),this.viewWidth=0,this.viewHeight=0,this.trainSelections={},this.pointerScreenX=0,this.pointerTime=0,this.pointerY=0,this.pointerTargetTrainPath=null,this.pointerTargetLine=null,this.pointerPreciseState=null,this.drawingState=null,this.trainPathDragState=null,this.stationNameInputTarget=null,this.trackNameInputTarget=null,this.controlKeyPressed=!1}return Object(g["a"])(t,[{key:"busy",get:function(){return null!=this.drawingState||null!=this.trainPathDragState||this.inputEnabled}},{key:"inputEnabled",get:function(){return null!=this.stationNameInputTarget||null!=this.trackNameInputTarget}}]),t}(),C=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.diagram?i("v-stage",{attrs:{config:t.stageConfig},on:{mousedown:t.onStageMouseDown,mousemove:t.onStageMouseMove,click:t.onStageClick,dblclick:t.onStageDoubleClick,wheel:t.onStageMouseWheel,contextmenu:t.onContextMenu,touchend:t.onTouchEnd}},[i("back-layer",t._g({},t.$listeners)),i("train-path-layer"),i("v-layer",[i("pointer")],1)],1):t._e()},x=[],R=i("ade3"),N=(i("2af1"),i("4de4"),i("4057"),i("38cf"),i("c8b5")),E=i.n(N),B=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-layer",{attrs:{id:"back-layer"}},[t._l(t.timeGridLines,(function(e){return i("v-group",{key:e.key},[i("v-line",{attrs:{config:e.lineConfig}}),e.labelConfig?i("v-text",{attrs:{config:e.labelConfig}}):t._e()],1)})),t._l(Object.values(t.diagram.stations),(function(e){return i("station-group",t._g({key:"station-"+e.id,attrs:{station:e}},t.$listeners))}))],2)},W=[],_=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-group",[t.isTopLineIntersectingPlotPane?i("v-group",[i("v-line",{attrs:{config:t.topLineConfig}}),t._l(t.labelCharacters,(function(t){return i("v-text",{key:t.key,attrs:{config:t}})})),i("v-rect",{attrs:{config:t.labelRectConfig},on:{click:t.onStationLabelClick,mousedown:t.onStationLabelMouseDown}})],2):t._e(),t.station.expanded&&t.isBottomLineIntersectingPlotPane?i("v-line",{attrs:{config:t.bottomLineConfig}}):t._e(),t.station.expanded?t._l(t.station.tracks,(function(e){return i("track-group",t._g({key:"track-"+t.station.id+"-"+e.id,attrs:{station:t.station,track:e}},t.$listeners))})):t._e()],2)},I=[],$=(i("a630"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.isLineIntersectingPlotPane?i("v-group",[i("v-line",{attrs:{config:t.lineConfig}}),i("v-text",{attrs:{config:t.labelConfig},on:{click:t.onLabelClick,mousedown:t.onLabelMouseDown}})],1):t._e()}),D=[],H=(i("c740"),function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){var t;return Object(d["a"])(this,i),t=e.apply(this,arguments),t.dragState=null,t}return Object(g["a"])(i,[{key:"lineConfig",get:function(){return{points:[this.diagram.config.stationLabelLeftMargin+this.diagram.config.trackLabelLeftMargin,this.diagram.getYByRelY(this.track.relY),this.viewState.viewWidth,this.diagram.getYByRelY(this.track.relY)],stroke:this.diagram.config.trackLineColor,strokeWidth:this.diagram.config.trackLineWidth,listening:!1}}},{key:"labelConfig",get:function(){return{id:"track-label-".concat(this.station.id,"-").concat(this.track.id),x:this.diagram.config.stationLabelLeftMargin+this.diagram.config.trackLabelLeftMargin,y:this.diagram.getYByRelY(this.track.relY)-this.diagram.config.trackLabelFontSize,width:this.diagram.config.leftPaneWidth-this.diagram.config.stationLabelLeftMargin-this.diagram.config.trackLabelLeftMargin-this.diagram.config.stationLabelRightMargin,height:this.diagram.config.trackLabelFontSize,text:this.track.name,fontSize:this.diagram.config.trackLabelFontSize,fontFamily:this.diagram.config.fontFamily,fill:this.diagram.config.trackLabelColor,align:"left",verticalAlign:"bottom"}}},{key:"isLineIntersectingPlotPane",get:function(){return this.diagram.getYByRelY(this.track.relY)>=this.diagram.config.topPaneHeight&&this.diagram.getYByRelY(this.track.relY)<this.viewState.viewHeight}},{key:"onLabelClick",value:function(){var t;!this.viewConfig.editMode||this.viewState.busy||null!==(t=this.dragState)&&void 0!==t&&t.dragging||(this.viewState.trackNameInputTarget=this.track,this.$emit("trackNameInputStart"))}},{key:"onLabelMouseDown",value:function(t){this.viewConfig.editMode&&(this.dragState={sy0:t.evt.screenY,index0:this.station.tracks.indexOf(this.track),dragging:!1},window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp))}},{key:"onWindowMouseMove",value:function(t){if(this.dragState&&(Math.abs(t.screenY-this.dragState.sy0)>1&&(this.dragState.dragging=!0),this.dragState.dragging)){this.station.removeTrack(this.track);var e=this.diagram.getRelYByY(t.clientY),i=this.station.tracks.findIndex((function(t){return e<t.relY}));i<0?this.station.tracks.push(this.track):this.station.tracks.splice(i,0,this.track),this.diagram.updateY()}}},{key:"onWindowMouseUp",value:function(t){var e=this;if(this.dragState){window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp),this.onWindowMouseMove(t);var i=this.dragState.index0,a=this.station.tracks.indexOf(this.track);i!=a&&this.historyManager.push({this:this,undo:function(){e.station.removeTrack(e.track),e.station.addNewTrack(e.track,i)},redo:function(){e.station.removeTrack(e.track),e.station.addNewTrack(e.track,a)}}),this.dragState=null}}}]),i}(m["g"]));Object(f["a"])([Object(m["c"])()],H.prototype,"viewConfig",void 0),Object(f["a"])([Object(m["c"])()],H.prototype,"viewState",void 0),Object(f["a"])([Object(m["c"])()],H.prototype,"diagram",void 0),Object(f["a"])([Object(m["b"])()],H.prototype,"historyManager",void 0),Object(f["a"])([Object(m["d"])()],H.prototype,"station",void 0),Object(f["a"])([Object(m["d"])()],H.prototype,"track",void 0),H=Object(f["a"])([m["a"]],H);var z=H,F=z,X=i("2877"),J=Object(X["a"])(F,$,D,!1,null,"137cac32",null),U=J.exports,G=function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){var t;return Object(d["a"])(this,i),t=e.apply(this,arguments),t.dragState=null,t}return Object(g["a"])(i,[{key:"topLineConfig",get:function(){return{points:[0,this.diagram.getYByRelY(this.station.topRelY),this.viewState.viewWidth,this.diagram.getYByRelY(this.station.topRelY)],stroke:this.diagram.config.stationLineColor,strokeWidth:this.diagram.config.stationLineWidth,listening:!1}}},{key:"bottomLineConfig",get:function(){return{points:[0,this.diagram.getYByRelY(this.station.bottomRelY),this.viewState.viewWidth,this.diagram.getYByRelY(this.station.bottomRelY)],stroke:this.diagram.config.stationLineColor,strokeWidth:this.diagram.config.stationLineWidth,listening:!1}}},{key:"labelRectConfig",get:function(){return{id:"station-label-".concat(this.station.id),x:this.diagram.config.stationLabelLeftMargin,y:this.diagram.getYByRelY(this.station.topRelY)-this.diagram.config.stationLabelFontSize,width:this.diagram.config.leftPaneWidth-this.diagram.config.stationLabelLeftMargin-this.diagram.config.stationLabelRightMargin,height:this.diagram.config.stationLabelFontSize}}},{key:"labelCharacters",get:function(){var t=this,e=this.diagram.config.leftPaneWidth-this.diagram.config.stationLabelLeftMargin-this.diagram.config.stationLabelRightMargin-this.diagram.config.stationLabelFontSize,i=this.station.name.length>1?e/(this.station.name.length-1):0;return Array.from(this.station.name).map((function(a,n){return{key:"station-label-".concat(t.station.id,"-").concat(n),x:t.station.name.length>1?t.diagram.config.stationLabelLeftMargin+n*i:t.diagram.config.stationLabelLeftMargin+.5*e,y:t.diagram.getYByRelY(t.station.topRelY)-t.diagram.config.stationLabelFontSize,height:t.diagram.config.stationLabelFontSize,text:a,fontSize:t.diagram.config.stationLabelFontSize,fontFamily:t.diagram.config.fontFamily,fill:t.diagram.config.stationLabelColor,align:"left",verticalAlign:"bottom"}}))}},{key:"isTopLineIntersectingPlotPane",get:function(){return this.diagram.getYByRelY(this.station.topRelY)>=this.diagram.config.topPaneHeight&&this.diagram.getYByRelY(this.station.topRelY)<this.viewState.viewHeight}},{key:"isBottomLineIntersectingPlotPane",get:function(){return this.diagram.getYByRelY(this.station.bottomRelY)>=this.diagram.config.topPaneHeight&&this.diagram.getYByRelY(this.station.bottomRelY)<this.viewState.viewHeight}},{key:"onStationLabelClick",value:function(){var t;!this.viewConfig.editMode||this.viewState.busy||null!==(t=this.dragState)&&void 0!==t&&t.dragging||(this.viewState.stationNameInputTarget=this.station,this.$emit("stationNameInputStart"))}},{key:"onStationLabelMouseDown",value:function(t){this.viewConfig.editMode&&!this.viewState.inputEnabled&&(this.dragState={sy0:t.evt.screenY,mileage0:this.station.mileage,dragging:!1},window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp))}},{key:"onWindowMouseMove",value:function(t){this.dragState&&(Math.abs(t.screenY-this.dragState.sy0)>1&&(this.dragState.dragging=!0),this.dragState.dragging&&(this.station.mileage=this.dragState.mileage0+(t.screenY-this.dragState.sy0)/this.diagram.config.yScale,this.diagram.updateY()))}},{key:"onWindowMouseUp",value:function(t){var e=this;if(this.dragState){if(window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp),this.onWindowMouseMove(t),this.dragState.dragging){var i=this.dragState.mileage0,a=this.station.mileage;this.historyManager.push({this:this,undo:function(){e.station.mileage=i},redo:function(){e.station.mileage=a}})}this.dragState=null}}}]),i}(m["g"]);Object(f["a"])([Object(m["c"])()],G.prototype,"viewConfig",void 0),Object(f["a"])([Object(m["c"])()],G.prototype,"viewState",void 0),Object(f["a"])([Object(m["c"])()],G.prototype,"diagram",void 0),Object(f["a"])([Object(m["b"])()],G.prototype,"historyManager",void 0),Object(f["a"])([Object(m["d"])()],G.prototype,"station",void 0),G=Object(f["a"])([Object(m["a"])({components:{TrackGroup:U}})],G);var A=G,K=A,V=Object(X["a"])(K,_,I,!1,null,"3a6a4ac5",null),q=V.exports,Q=function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(d["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"timeGridLines",get:function(){var t=[],e=this.diagram.config.scrollX/this.diagram.config.xScale,i=Math.ceil(e/this.diagram.config.minorMinutelyGridLineSpan)*this.diagram.config.minorMinutelyGridLineSpan,a=i*this.diagram.config.xScale-this.diagram.config.scrollX+this.diagram.config.leftPaneWidth;while(a<this.viewState.viewWidth)t.push({key:"time-grid-line-".concat(t.length),lineConfig:{points:[a,this.diagram.config.topPaneHeight,a,this.viewState.viewHeight],stroke:i%3600==0?this.diagram.config.hourlyGridLineColor:i%this.diagram.config.majorMinutelyGridLineSpan==0?this.diagram.config.majorMinutelyGridLineColor:this.diagram.config.minorMinutelyGridLineColor,strokeWidth:i%3600==0?this.diagram.config.hourlyGridLineWidth:i%this.diagram.config.majorMinutelyGridLineSpan==0?this.diagram.config.majorMinutelyGridLineWidth:this.diagram.config.minorMinutelyGridLineWidth,listening:!1},labelConfig:i%3600!=0?null:{x:a-this.diagram.config.hourlyLabelFontSize,y:this.diagram.config.topPaneHeight-this.diagram.config.hourlyLabelBottomMargin-this.diagram.config.hourlyLabelFontSize,width:2*this.diagram.config.hourlyLabelFontSize,height:this.diagram.config.hourlyLabelFontSize,text:"".concat(i/3600%24),fontSize:this.diagram.config.hourlyLabelFontSize,fontFamily:this.diagram.config.fontFamily,fill:this.diagram.config.hourlyLabelColor,align:"center",verticalAlign:"bottom"}}),i+=this.diagram.config.minorMinutelyGridLineSpan,a=i*this.diagram.config.xScale-this.diagram.config.scrollX+this.diagram.config.leftPaneWidth;return t}}]),i}(m["g"]);Object(f["a"])([Object(m["c"])()],Q.prototype,"viewState",void 0),Object(f["a"])([Object(m["c"])()],Q.prototype,"diagram",void 0),Q=Object(f["a"])([Object(m["a"])({components:{StationGroup:q}})],Q);var Z=Q,tt=Z,et=Object(X["a"])(tt,B,W,!1,null,"654ee79b",null),it=et.exports,at=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.pointerEnabled?i("v-group",[i("v-rect",{attrs:{config:t.rectConfig}}),i("v-text",{attrs:{config:t.labelConfig}})],1):t._e()},nt=[];i("4d90");function rt(t,e){var i="".concat(Math.floor(t/3600)),a="".concat(Math.floor(t/60)%60).padStart(2,"0"),n="".concat(t%60).padStart(2,"0");return t%60!=0||e?"".concat(i,":").concat(a,":").concat(n):"".concat(i,":").concat(a)}var ot=function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(d["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"pointerEnabled",get:function(){return this.viewState.pointerTargetLine&&!this.viewState.pointerTargetTrainPath&&!this.viewState.trainPathDragState&&!this.viewState.drawingState}},{key:"rectConfig",get:function(){var t=this.viewState.drawingState?this.viewConfig.selectedTrainPathMarkerWidth:this.viewConfig.pointerWidth;return{x:this.diagram.getXByTime(this.viewState.pointerTime)-.5*t,y:this.viewState.pointerY-.5*t,width:t,height:t,fill:this.viewConfig.pointerColor,listening:!1}}},{key:"labelConfig",get:function(){var t=this.viewState.pointerTime>=0?this.viewState.pointerTime:this.viewState.pointerTime+3600*Math.ceil(-this.viewState.pointerTime/3600);return{x:this.diagram.getXByTime(this.viewState.pointerTime),y:this.viewState.pointerY-this.viewConfig.pointerLabelFontSize,height:this.viewConfig.pointerLabelFontSize,text:rt(t,null!=this.viewState.pointerPreciseState),fontSize:this.viewConfig.pointerLabelFontSize,fontFamily:this.diagram.config.fontFamily,fill:this.viewConfig.pointerColor,align:"left",verticalAlign:"bottom",listening:!1}}}]),i}(m["g"]);Object(f["a"])([Object(m["c"])()],ot.prototype,"viewConfig",void 0),Object(f["a"])([Object(m["c"])()],ot.prototype,"viewState",void 0),Object(f["a"])([Object(m["c"])()],ot.prototype,"diagram",void 0),ot=Object(f["a"])([m["a"]],ot);var st=ot,ct=st,lt=Object(X["a"])(ct,at,nt,!1,null,"3766b4d0",null),ht=lt.exports,dt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-layer",{ref:"trainPathLayer",attrs:{id:"train-path-layer",config:t.layerConfig}},[t._l(Object.values(t.diagram.trains).filter((function(e){return!t.viewState.trainSelections[e.id]})),(function(t){return i("train-path-group",{key:"train-"+t.id,attrs:{train:t}})})),t._l(Object.values(t.diagram.trains).filter((function(e){return t.viewState.trainSelections[e.id]})),(function(t){return i("train-path-group",{key:"train-"+t.id,attrs:{train:t}})}))],2)},gt=[],ut=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-group",[i("v-line",{attrs:{config:t.regularTrainPathConfig},on:{click:t.onTrainPathClick,mousemove:t.onTrainPathMouseMove,tap:t.onTrainPathTap}}),t.selectedTrainPathEnabled?[i("v-line",{attrs:{config:t.selectedTrainPathConfig},on:{click:t.onSelectedTrainPathClick,dblclick:t.onSelectedTrainPathDoubleClick,mousedown:t.onSelectedTrainPathMouseDown,mousemove:t.onSelectedTrainPathMouseMove}}),t._l(t.selectedTrainPathNodes,(function(e){return i("train-path-marker",{key:"marker-"+t.train.id+"-"+e.stev.privateId+"-"+e.phase,attrs:{trainPathNode:e},on:{click:t.onMarkerClick,mousedown:t.onMarkerMouseDown}})}))]:t._e()],2)},vt=[],ft=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-group",[i("v-rect",{attrs:{config:t.rectConfig},on:{click:function(e){return t.$emit("click",e,t.trainPathNode)},mousemove:t.onRectMouseMove,mousedown:function(e){return t.$emit("mousedown",e,t.trainPathNode)},dblclick:t.onRectDoubleClick}}),t.labelEnabled?i("v-text",{attrs:{config:t.labelConfig}}):t._e()],1)},mt=[],pt=function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(d["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"rectConfig",get:function(){return{x:this.diagram.getXByTime(this.trainPathNode.time)-.5*this.viewConfig.selectedTrainPathMarkerWidth,y:this.diagram.getYByRelY(this.trainPathNode.relY)-.5*this.viewConfig.selectedTrainPathMarkerWidth,width:this.viewConfig.selectedTrainPathMarkerWidth,height:this.viewConfig.selectedTrainPathMarkerWidth,fill:this.viewConfig.selectedTrainPathMarkerColor}}},{key:"labelEnabled",get:function(){return"track"==this.trainPathNode.phase}},{key:"labelConfig",get:function(){var t=this.getLabelPosition();return{x:this.diagram.getXByTime(this.trainPathNode.time)+t.x-8*this.viewConfig.markerLabelFontSize,y:this.diagram.getYByRelY(this.trainPathNode.relY)+t.y-this.viewConfig.markerLabelLineHeight,width:8*this.viewConfig.markerLabelFontSize,height:this.viewConfig.markerLabelLineHeight,text:rt(this.trainPathNode.time,null!=this.viewState.pointerPreciseState),fontSize:this.viewConfig.pointerLabelFontSize,fontFamily:this.diagram.config.fontFamily,fill:this.viewConfig.markerLabelColor,align:"right",verticalAlign:"bottom",listening:!1}}},{key:"getLabelPosition",value:function(){var t=this.trainPathNode.stev,e=t.prev,i=t.next;if(e&&e.track!=t.track&&(!i||i.track==t.track)){var a=e.station.mileage<t.station.mileage?t.station.topRelY:t.station.bottomRelY,n=e.station.mileage<t.station.mileage?e.station.bottomRelY:e.station.topRelY,r=a==n?0:-this.viewConfig.markerLabelLineHeight*((t.time-e.time)*this.diagram.config.xScale)/Math.abs(a-n);return{x:Math.max(r,-this.viewConfig.markerLabelMaxDistance),y:e.station.mileage<t.station.mileage?0:this.viewConfig.markerLabelLineHeight}}return{x:0,y:i&&i.station.mileage<t.station.mileage||e&&e.station.mileage>t.station.mileage?0:this.viewConfig.markerLabelLineHeight}}},{key:"onRectMouseMove",value:function(){this.viewState.pointerTargetTrainPath={train:this.trainPathNode.stev.train,stevRange:{from:this.trainPathNode.stev,to:this.trainPathNode.stev}}}},{key:"onRectDoubleClick",value:function(){if(this.viewConfig.editMode)if(this.viewState.drawingState)this.viewState.drawingState=null,this.viewState.trainSelections={};else{var t=this.trainPathNode;t.stev.prev?t.stev.next||(this.viewState.drawingState={train:t.stev.train,lastStev:t.stev,direction:1,stableEnd:t.stev,floating:null},this.viewState.trainSelections[t.stev.train.id].stevRange=null):(this.viewState.drawingState={train:t.stev.train,lastStev:t.stev,direction:-1,stableEnd:t.stev,floating:null},this.viewState.trainSelections[t.stev.train.id].stevRange=null)}}}]),i}(m["g"]);Object(f["a"])([Object(m["c"])()],pt.prototype,"viewConfig",void 0),Object(f["a"])([Object(m["c"])()],pt.prototype,"viewState",void 0),Object(f["a"])([Object(m["c"])()],pt.prototype,"diagram",void 0),Object(f["a"])([Object(m["d"])()],pt.prototype,"trainPathNode",void 0),pt=Object(f["a"])([m["a"]],pt);var bt=pt,St=bt,yt=Object(X["a"])(St,ft,mt,!1,null,"40df1b93",null),wt=yt.exports,kt=function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){var t;return Object(d["a"])(this,i),t=e.apply(this,arguments),t.dragState=null,t}return Object(g["a"])(i,[{key:"regularTrainPathConfig",get:function(){var t=this;return{points:this.regularTrainPathNodes.flatMap((function(e){return[t.diagram.getXByTime(e.time),t.diagram.getYByRelY(e.relY)]})),stroke:this.diagram.config.trainPathColor,opacity:Object.keys(this.viewState.trainSelections).length>0?this.viewConfig.unselectedTrainPathOpacity:1,strokeWidth:this.diagram.config.trainPathWidth,hitStrokeWidth:Math.max(this.diagram.config.trainPathWidth,2*this.viewConfig.minHitWidth)}}},{key:"regularTrainPathNodes",get:function(){return this.getTrainPathNodes("regular")}},{key:"selectedTrainPathEnabled",get:function(){return null!=this.viewState.trainSelections[this.train.id]}},{key:"selectedTrainPathConfig",get:function(){var t=this;return{points:this.selectedTrainPathNodes.flatMap((function(e){return[t.diagram.getXByTime(e.time),t.diagram.getYByRelY(e.relY)]})),stroke:this.viewConfig.selectedTrainPathColor,strokeWidth:this.diagram.config.trainPathWidth*this.viewConfig.selectedTrainPathWidthScale,hitStrokeWidth:Math.max(this.diagram.config.trainPathWidth*this.viewConfig.selectedTrainPathWidthScale,2*this.viewConfig.minHitWidth)}}},{key:"selectedTrainPathNodes",get:function(){return this.getTrainPathNodes("selected")}},{key:"getTrainPathNodes",value:function(t){var e,i,a,n,r,o,s=this.viewState.trainSelections[this.train.id],c="selected"==t&&null!=s.stevRange?this.train.getStopEventsInRange(s.stevRange):this.train.stevs,l=(null===(e=this.viewState.trainPathDragState)||void 0===e?void 0:e.targets[this.train.id])&&("selected"==t||!this.viewState.controlKeyPressed),h=null!==(i=null===(a=this.viewState.trainPathDragState)||void 0===a?void 0:a.timeShift)&&void 0!==i?i:0,d=null===(n=this.viewState.trainPathDragState)||void 0===n||null===(r=n.targets[this.train.id])||void 0===r?void 0:r.stevRange,g=l&&!d,u=[],v=Object(S["a"])(c);try{for(v.s();!(o=v.n()).done;){var f=o.value;l&&f==(null===d||void 0===d?void 0:d.from)&&(g=!0);var m=g?f.time+h:f.time;f.station.expanded&&f.prev&&f.prev.station!=f.station&&u.push({stev:f,phase:"arr",time:m,relY:f.prev.station.mileage<f.station.mileage?f.station.topRelY:f.station.bottomRelY}),u.push({stev:f,phase:"track",time:m,relY:f.track.relY}),f.station.expanded&&f.next&&f.next.station!=f.station&&u.push({stev:f,phase:"dep",time:m,relY:f.next.station.mileage<f.station.mileage?f.station.topRelY:f.station.bottomRelY}),l&&f==(null===d||void 0===d?void 0:d.to)&&(g=!1)}}catch(p){v.e(p)}finally{v.f()}return u}},{key:"onTrainPathMouseMove",value:function(){this.viewState.pointerTargetTrainPath=null}},{key:"onSelectedTrainPathMouseMove",value:function(t){this.viewState.pointerTargetTrainPath={train:this.train,stevRange:this.getPointedStevRange(t.evt.clientX,t.evt.clientY)}}},{key:"onTrainPathClick",value:function(t){var e=this.getPointedStevRange(t.evt.clientX,t.evt.clientY);this.changeTrainSelections(t,e,!1)}},{key:"onSelectedTrainPathClick",value:function(t){var e=this.getPointedStevRange(t.evt.clientX,t.evt.clientY);this.changeTrainSelections(t,e,!0)}},{key:"onMarkerClick",value:function(t,e){var i={from:e.stev,to:e.stev};this.changeTrainSelections(t,i,!0)}},{key:"changeTrainSelections",value:function(t,e,i){var a;if((null===(a=this.viewState.trainPathDragState)||void 0===a||!a.dragging)&&!this.viewState.drawingState){var n=this.viewState.trainSelections[this.train.id];if(t.evt.shiftKey||(this.viewState.trainSelections=n?Object(R["a"])({},this.train.id,n):{}),n){var r=n.stevRange;if(r)if(t.evt.shiftKey){var o,s=!1,c=!1,l=!1,h=Object(S["a"])(this.train.stevs);try{for(h.s();!(o=h.n()).done;){var d=o.value;s||d!=e.from||(r.from=e.from,l=!0),d==r.from&&(s=!0),d==r.to&&(c=!0),c&&d==e.to&&(r.to=e.to,l=!0)}}catch(g){h.e(g)}finally{h.f()}l||this.$delete(this.viewState.trainSelections,this.train.id)}else n.stevRange=i?e:null;else n.stevRange=e}else this.$set(this.viewState.trainSelections,this.train.id,{train:this.train,stevRange:null})}}},{key:"onTrainPathTap",value:function(){this.viewState.trainSelections=Object(R["a"])({},this.train.id,{train:this.train,stevRange:null})}},{key:"getPointedStevRange",value:function(t,e){if(this.train.stevs.length<=2)return{from:this.train.stevs[0],to:this.train.stevs[this.train.stevs.length-1]};for(var i=0;i<this.train.stevs.length-1;++i){var a=this.train.stevs[i],n=this.train.stevs[i+1],r=this.diagram.getXByTime(a.time)-this.viewConfig.minHitWidth,o=this.diagram.getXByTime(n.time)+this.viewConfig.minHitWidth,s=this.diagram.getYByRelY(Math.min(a.track.relY,n.track.relY))-this.viewConfig.minHitWidth,c=this.diagram.getYByRelY(Math.max(a.track.relY,n.track.relY))+this.viewConfig.minHitWidth;if(r<t&&t<o&&s<e&&e<c)return{from:a,to:n}}return{from:this.train.stevs[0],to:this.train.stevs[this.train.stevs.length-1]}}},{key:"onSelectedTrainPathDoubleClick",value:function(t){if(this.viewConfig.editMode&&!this.viewState.drawingState){var e,i,a=this.viewState.pointerTime,n=this.getNearestStation(t.evt.clientY),r=this.getNearestStopEvent(a);if(n!=r.station||(null===(e=r.prev)||void 0===e?void 0:e.track)!=r.track&&(null===(i=r.next)||void 0===i?void 0:i.track)!=r.track){var o=this.train.stevs.findIndex((function(t){return t.time>a})),s=this.train.addNewStopEvent(new O(this.train,n.tracks[0],a),o);this.viewState.trainSelections=Object(R["a"])({},this.train.id,{train:this.train,stevRange:{from:s,to:s}})}}}},{key:"getNearestStation",value:function(t){var e,i=this.diagram.getStationsInMileageOrder(),a=this.diagram.getRelYByY(t),n=i[0],r=Math.abs(a-n.bottomRelY),o=Object(S["a"])(i);try{for(o.s();!(e=o.n()).done;){var s=e.value;Math.abs(a-s.topRelY)<r&&(n=s,r=Math.abs(a-s.topRelY)),Math.abs(a-s.bottomRelY)<r&&(n=s,r=Math.abs(a-s.bottomRelY))}}catch(c){o.e(c)}finally{o.f()}return n}},{key:"getNearestStopEvent",value:function(t){var e,i=this.train.stevs[0],a=Math.abs(t-i.time),n=Object(S["a"])(this.train.stevs);try{for(n.s();!(e=n.n()).done;){var r=e.value;Math.abs(t-r.time)<a&&(i=r,a=Math.abs(t-r.time))}}catch(o){n.e(o)}finally{n.f()}return i}},{key:"onSelectedTrainPathMouseDown",value:function(t){if(this.viewConfig.editMode){for(var e=-86400,i=86400,a=0,n=Object.values(this.viewState.trainSelections);a<n.length;a++){var r=n[a],o=r.stevRange;o&&(o.from.prev&&(e=Math.max(e,o.from.prev.time-o.from.time)),o.to.next&&(i=Math.min(i,o.to.next.time-o.to.time)))}var s=this.getPointedStevRange(t.evt.clientX,t.evt.clientY),c=s.from==s.to?[s.from]:s.from.track==s.to.track?[s.from,s.to]:null,l=this.selectedTrainPathNodes[0];this.dragState={t0:l.time,y0:this.diagram.getYByRelY(l.relY),sx0:t.evt.screenX,sy0:t.evt.screenY,track0:c?c[0].track:null,minTimeShift:e,maxTimeShift:i,changeTimeTargets:null,changeTrackTargets:null!==c&&void 0!==c?c:null},this.viewState.trainPathDragState={dragging:!1,targets:this.viewState.trainSelections,timeShift:0},window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp)}}},{key:"onMarkerMouseDown",value:function(t,e){this.viewConfig.editMode&&(this.dragState={t0:e.time,y0:this.diagram.getYByRelY(e.relY),track0:e.stev.track,sx0:t.evt.screenX,sy0:t.evt.screenY,minTimeShift:e.stev.prev?e.stev.prev.time-e.time:-86400,maxTimeShift:e.stev.next?e.stev.next.time-e.time:86400,changeTimeTargets:[e.stev],changeTrackTargets:[e.stev]},this.viewState.trainPathDragState={dragging:!1,targets:Object(R["a"])({},e.stev.train.id,{train:e.stev.train,stevRange:{from:e.stev,to:e.stev}}),timeShift:0},window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp))}},{key:"onWindowMouseMove",value:function(t){var e=this;if(this.dragState&&this.viewState.trainPathDragState&&(!this.viewState.trainPathDragState.dragging&&Math.hypot(t.clientX-this.dragState.sx0,t.clientY-this.dragState.sy0)>1&&(this.viewState.trainPathDragState.dragging=!0,this.viewState.pointerY=this.dragState.y0),this.viewState.trainPathDragState.dragging&&(this.viewState.pointerPreciseState||(this.viewState.pointerTime=this.dragState.t0+60*Math.floor((t.screenX-this.dragState.sx0)/this.diagram.config.xScale/60)),this.viewState.trainPathDragState.timeShift=this.viewState.controlKeyPressed?this.viewState.pointerTime-this.dragState.t0:Math.min(this.dragState.maxTimeShift,Math.max(this.dragState.minTimeShift,this.viewState.pointerTime-this.dragState.t0)),this.dragState.changeTrackTargets))){var i=this.diagram.getRelYByY(t.clientY),a=this.dragState.changeTrackTargets[0].station,n=a.tracks.find((function(t){return Math.abs(t.relY-i)<e.viewConfig.minHitWidth}));if(n){var r,o=Object(S["a"])(this.dragState.changeTrackTargets);try{for(o.s();!(r=o.n()).done;){var s=r.value;s.track=n}}catch(c){o.e(c)}finally{o.f()}}}}},{key:"onWindowMouseUp",value:function(){var t=this;if(this.dragState&&this.viewState.trainPathDragState){if(window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp),this.viewState.trainPathDragState.dragging){if(this.dragState.changeTrackTargets&&this.dragState.track0){var e=this.dragState.changeTrackTargets,i=this.dragState.track0,a=this.dragState.changeTrackTargets[0].track;i!=a&&this.historyManager.push({this:this,undo:function(){e.forEach((function(t){return t.track=i}))},redo:function(){e.forEach((function(t){return t.track=a}))}})}var n=this.viewState.trainPathDragState.timeShift;if(0!=n)if(this.viewState.controlKeyPressed){var r=Object.values(this.viewState.trainSelections).map((function(e){var i,a=e.train,r=e.stevRange?a.getStopEventsInRange(e.stevRange):a.stevs,o=t.diagram.addNewTrain(new j(t.diagram.genId(),"")),s=Object(S["a"])(r);try{for(s.s();!(i=s.n()).done;){var c=i.value;o.addNewStopEvent(new O(o,c.track,c.time+n))}}catch(l){s.e(l)}finally{s.f()}return t.$delete(t.viewState.trainSelections,e.train.id),t.$set(t.viewState.trainSelections,o.id,{train:o,stevRange:null}),o}));this.historyManager.push({this:this,undo:function(){r.forEach((function(e){return t.diagram.removeTrain(e)}))},redo:function(){r.forEach((function(e){return t.diagram.addNewTrain(e)}))}})}else{var o,s=null!==(o=this.dragState.changeTimeTargets)&&void 0!==o?o:Object.values(this.viewState.trainSelections).flatMap((function(t){return t.stevRange?t.train.getStopEventsInRange(t.stevRange):t.train.stevs}));s.forEach((function(t){return t.time+=n})),this.historyManager.push({this:this,undo:function(){s.forEach((function(t){return t.time-=n}))},redo:function(){s.forEach((function(t){return t.time+=n}))}})}}this.viewState.trainPathDragState=null,this.dragState=null}}}]),i}(m["g"]);Object(f["a"])([Object(m["c"])()],kt.prototype,"viewConfig",void 0),Object(f["a"])([Object(m["c"])()],kt.prototype,"viewState",void 0),Object(f["a"])([Object(m["c"])()],kt.prototype,"diagram",void 0),Object(f["a"])([Object(m["b"])()],kt.prototype,"historyManager",void 0),Object(f["a"])([Object(m["d"])()],kt.prototype,"train",void 0),kt=Object(f["a"])([Object(m["a"])({components:{TrainPathMarker:wt}})],kt);var Ot=kt,jt=Ot,Tt=Object(X["a"])(jt,ut,vt,!1,null,"95e22cf8",null),Mt=Tt.exports,Pt=function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(d["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"layerConfig",get:function(){return{clip:{x:this.diagram.config.leftPaneWidth,y:this.diagram.config.topPaneHeight,width:this.viewState.viewWidth-this.diagram.config.leftPaneWidth,height:this.viewState.viewHeight-this.diagram.config.topPaneHeight}}}}]),i}(m["g"]);Object(f["a"])([Object(m["c"])()],Pt.prototype,"viewState",void 0),Object(f["a"])([Object(m["c"])()],Pt.prototype,"diagram",void 0),Pt=Object(f["a"])([Object(m["a"])({components:{TrainPathGroup:Mt}})],Pt);var Yt=Pt,Lt=Yt,Ct=Object(X["a"])(Lt,dt,gt,!1,null,"2f6cdf07",null),xt=Ct.exports,Rt=function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){var t;return Object(d["a"])(this,i),t=e.apply(this,arguments),t.stageDragState=null,t.pinchState=null,t}return Object(g["a"])(i,[{key:"stageConfig",get:function(){return{width:this.viewState.viewWidth,height:this.viewState.viewHeight}}},{key:"stationsInMileageOrder",get:function(){return this.diagram.getStationsInMileageOrder()}},{key:"mounted",value:function(){window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp);var t=new E.a(this.$el);t.get("pan").set({direction:E.a.DIRECTION_ALL}),t.get("pinch").set({enable:!0}),t.on("panstart",this.onPanStart),t.on("panmove",this.onPanMove),t.on("panend",this.onPanEnd),t.on("pinchstart",this.onPinchStart),t.on("pinchmove",this.onPinchMove),t.on("pinchend",this.onPinchEnd)}},{key:"unmounted",value:function(){window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp)}},{key:"onStageMouseMove",value:function(t){var e,i=t.evt;if(this.viewState.pointerScreenX=i.screenX,this.viewState.pointerPreciseState){var a=Math.round((i.screenX-this.viewState.pointerPreciseState.sx0)/this.viewConfig.pointerPrecisePixelPerTimeUnit);this.viewState.pointerTime=a*this.diagram.config.minimumTimeUnit+this.viewState.pointerPreciseState.t0}else if(null===(e=this.viewState.trainPathDragState)||void 0===e||!e.dragging)if(this.viewState.pointerTime=60*Math.round(this.diagram.getTimeByX(i.clientX)/60),i.clientX>=this.diagram.config.leftPaneWidth){var n=this.findPointerTargetLine(i.clientY);n?(this.viewState.pointerTargetLine=null!==n&&void 0!==n?n:null,this.viewState.pointerY=this.diagram.getYByRelY(n.relY)):this.viewState.pointerTargetLine=null}else this.viewState.pointerTargetLine=null;t.target==t.currentTarget&&(this.viewState.pointerTargetTrainPath=null);var r=this.viewState.drawingState;if(r){r.direction>0?this.viewState.pointerTime=Math.max(this.viewState.pointerTime,r.lastStev.time):r.direction<0&&(this.viewState.pointerTime=Math.min(this.viewState.pointerTime,r.lastStev.time)),r.floating&&(r.train.removeStopEvent(r.floating),r.floating=null);var o=i.clientX>=this.diagram.config.leftPaneWidth?this.findPointerTargetLine(i.clientY):void 0;if(o){var s,c=null!==(s=o.track)&&void 0!==s?s:o.station.tracks[0],l=r.train.addNewStopEvent(new O(r.train,c,this.viewState.pointerTime),r.direction>0||0==r.direction&&this.viewState.pointerTime>=r.lastStev.time?void 0:0);r.floating=l}}}},{key:"findPointerTargetLine",value:function(t){var e=this,i=this.stationsInMileageOrder.find((function(i){return Math.abs(e.diagram.getYByRelY(i.topRelY)-t)<Math.max(.5*e.diagram.config.stationLineWidth,e.viewConfig.minHitWidth)}));if(i)return{station:i,track:null,relY:i.topRelY};var a=this.stationsInMileageOrder.find((function(i){return Math.abs(e.diagram.getYByRelY(i.bottomRelY)-t)<Math.max(.5*e.diagram.config.stationLineWidth,e.viewConfig.minHitWidth)}));if(a)return{station:a,track:null,relY:a.bottomRelY};var n=this.stationsInMileageOrder.find((function(i){return e.diagram.getYByRelY(i.topRelY)+e.diagram.config.trackLineSpan-Math.max(.5*e.diagram.config.trackLineWidth,e.viewConfig.minHitWidth)<t&&e.diagram.getYByRelY(i.bottomRelY)-e.diagram.config.trackLineSpan+Math.max(.5*e.diagram.config.trackLineWidth,e.viewConfig.minHitWidth)>t}));if(n){var r=n.tracks.find((function(i){return Math.abs(e.diagram.getYByRelY(i.relY)-t)<Math.max(.5*e.diagram.config.trackLineWidth,e.viewConfig.minHitWidth)}));if(r)return{station:n,track:r,relY:r.relY}}}},{key:"onStageClick",value:function(t){var e,i,a=this.viewState.drawingState;if(a){if(0==t.evt.button&&this.viewState.pointerTargetLine&&(0==a.direction&&(a.direction=Math.sign(this.viewState.pointerTime-a.lastStev.time)),a.floating)){var n,r,o=a.floating.track==a.lastStev.track&&(a.direction>0&&a.lastStev.track==(null===(n=a.lastStev.prev)||void 0===n?void 0:n.track)||a.direction<0&&a.lastStev.track==(null===(r=a.lastStev.next)||void 0===r?void 0:r.track));o?(a.lastStev.time=this.viewState.pointerTime,a.train.removeStopEvent(a.floating)):a.lastStev=a.floating,a.floating=null}if(2==t.evt.button)if(a.lastStev==a.stableEnd)a.floating&&a.train.removeStopEvent(a.floating),this.viewState.drawingState=null;else{var s=a.direction>0?a.lastStev.prev:a.lastStev.next;s?(a.train.removeStopEvent(a.lastStev),a.lastStev=s):(this.$delete(this.diagram.trains,a.train.id),this.viewState.drawingState=null)}}t.target!=t.currentTarget||t.evt.ctrlKey||t.evt.shiftKey||null!==(e=this.stageDragState)&&void 0!==e&&e.dragging||null!==(i=this.viewState.trainPathDragState)&&void 0!==i&&i.dragging||this.viewState.drawingState||(this.viewState.trainSelections={})}},{key:"onTouchEnd",value:function(t){var e;t.target!=t.currentTarget||null!==(e=this.stageDragState)&&void 0!==e&&e.dragging||(this.viewState.trainSelections={}),this.stageDragState&&(this.stageDragState=null)}},{key:"onStageDoubleClick",value:function(t){var e=this;if(t.target==t.currentTarget&&this.viewState.drawingState){var i=this.viewState.drawingState;if(i.floating&&i.train.removeStopEvent(i.floating),i.train.stevs.length<=1)this.$delete(this.diagram.trains,i.train.id);else{var a=i.stableEnd;if(a){var n=i.train.stevs.indexOf(a),r=i.direction>0?i.train.stevs.filter((function(t,e){return e>n})):i.train.stevs.filter((function(t,e){return e<n}));i.direction>0?this.historyManager.push({this:this,undo:function(){i.train.stevs.splice(n+1)},redo:function(){r.forEach((function(t){return i.train.stevs.push(t)}))}}):this.historyManager.push({this:this,undo:function(){i.train.stevs.splice(0,n)},redo:function(){i.train.stevs=r.concat(i.train.stevs)}})}else this.historyManager.push({this:this,undo:function(){e.$delete(e.diagram.trains,i.train.id)},redo:function(){e.$set(e.diagram.trains,i.train.id,i.train)}})}this.viewState.drawingState=null,this.viewState.trainSelections={}}else if(t.target==t.currentTarget&&this.viewConfig.editMode)if(t.evt.clientX>=this.diagram.config.leftPaneWidth){var o=this.viewState.pointerTargetLine;if(o&&(o.track||!o.station.expanded)){var s,c=null!==(s=o.track)&&void 0!==s?s:o.station.tracks[0],l=this.diagram.addNewTrain(new j(this.diagram.genId(),""));l.addNewStopEvent(new O(l,c,this.viewState.pointerTime)),this.viewState.trainSelections=Object(R["a"])({},l.id,{train:l,stevRange:null}),this.viewState.drawingState={train:this.diagram.trains[l.id],lastStev:this.diagram.trains[l.id].stevs[0],direction:0,stableEnd:null,floating:null}}}else{var h=this.diagram.getRelYByY(t.evt.clientY),d=this.stationsInMileageOrder.reverse().find((function(t){return t.topRelY<h})),g=d?(h-d.bottomRelY)/this.diagram.config.yScale+d.mileage:h/this.diagram.config.yScale,u=k.fromJSON({id:this.diagram.genId(),name:"",mileage:g,tracks:[{id:this.diagram.genId(),name:""}]});this.$set(this.diagram.stations,u.id,u),this.diagram.updateY(),this.historyManager.push({this:this,undo:function(){e.$delete(e.diagram.stations,u.id),e.diagram.updateY()},redo:function(){e.$set(e.diagram.stations,u.id,u),e.diagram.updateY()}}),this.viewState.stationNameInputTarget=u,this.$emit("stationNameInputStart")}}},{key:"onStageMouseDown",value:function(t){t.target==t.currentTarget&&this.startDrag(t.evt.screenX,t.evt.screenY)}},{key:"onWindowMouseMove",value:function(t){this.moveDrag(t.screenX,t.screenY)}},{key:"onWindowMouseUp",value:function(t){this.stageDragState&&(this.moveDrag(t.screenX,t.screenY),this.stageDragState=null)}},{key:"onPanStart",value:function(t){"mouse"!=t.pointerType&&this.startDrag(t.center.x,t.center.y)}},{key:"onPanMove",value:function(t){"mouse"!=t.pointerType&&this.moveDrag(t.center.x,t.center.y)}},{key:"onPanEnd",value:function(t){"mouse"!=t.pointerType&&this.stageDragState&&this.moveDrag(t.center.x,t.center.y)}},{key:"startDrag",value:function(t,e){this.viewState.pointerPreciseState||(this.stageDragState={scrollX0:this.diagram.config.scrollX,scrollY0:this.diagram.config.scrollY,x0:t,y0:e,dragging:!1})}},{key:"moveDrag",value:function(t,e){this.stageDragState&&(Math.hypot(t-this.stageDragState.x0,e-this.stageDragState.y0)>1&&(this.stageDragState.dragging=!0),this.stageDragState.dragging&&(this.diagram.config.scrollX=Math.max(this.diagram.config.minPlotTime*this.diagram.config.xScale-this.diagram.config.plotPanePadding,Math.min(this.diagram.config.maxPlotTime*this.diagram.config.xScale-(this.viewState.viewWidth-this.diagram.config.leftPaneWidth-this.diagram.config.plotPanePadding),this.stageDragState.scrollX0-(t-this.stageDragState.x0))),this.diagram.config.scrollY=Math.max(0,Math.min(this.diagram.getYByRelY(this.diagram.maxRelY),this.stageDragState.scrollY0-(e-this.stageDragState.y0)))))}},{key:"onStageMouseWheel",value:function(t){var e=Math.pow(2,-Math.sign(t.evt.deltaY)*this.viewConfig.wheelScale);this.diagram.config.scrollX+=(e-1)*(t.evt.clientX-this.diagram.config.leftPaneWidth+this.diagram.config.scrollX),this.diagram.config.scrollY=Math.max(0,Math.min(this.diagram.maxRelY+this.diagram.config.topPaneHeight-this.viewState.viewHeight,this.diagram.config.scrollY+(e-1)*(t.evt.clientY-this.diagram.config.topPaneHeight+this.diagram.config.scrollY))),this.diagram.config.xScale*=e,this.diagram.config.yScale*=e,this.diagram.updateY(),t.evt.preventDefault()}},{key:"onPinchStart",value:function(t){this.pinchState={lastScale:t.scale}}},{key:"onPinchMove",value:function(t){this.pinchState&&(this.diagram.config.scrollX+=(t.scale/this.pinchState.lastScale-1)*(t.center.x-this.diagram.config.leftPaneWidth+this.diagram.config.scrollX),this.diagram.config.scrollY=Math.max(0,Math.min(this.diagram.maxRelY+this.diagram.config.topPaneHeight-this.viewState.viewHeight,this.diagram.config.scrollY+(t.scale/this.pinchState.lastScale-1)*(t.center.y-this.diagram.config.topPaneHeight+this.diagram.config.scrollY))),this.diagram.config.xScale*=t.scale/this.pinchState.lastScale,this.diagram.config.yScale*=t.scale/this.pinchState.lastScale,this.pinchState.lastScale=t.scale,this.diagram.updateY())}},{key:"onPinchEnd",value:function(t){this.pinchState&&(this.onPinchMove(t),this.pinchState=null)}},{key:"onKeyDown",value:function(t){var e=this;if(!t.repeat&&("Alt"==t.key&&(this.viewState.pointerPreciseState={sx0:this.viewState.pointerScreenX,t0:this.viewState.pointerTime}),"Control"==t.key&&(this.viewState.controlKeyPressed=!0),"Delete"==t.key&&this.viewConfig.editMode&&!this.viewState.busy)){for(var i=[],a=[],n=0,r=Object.values(this.viewState.trainSelections);n<r.length;n++){var o=r[n];if(o.stevRange){var s=o.train.stevs.indexOf(o.stevRange.from),c=o.train.stevs.indexOf(o.stevRange.to),l=c-s+1;if(l>=o.train.stevs.length-1)i.push(o.train);else for(var h=s;h<=c;++h)a.push({stev:o.train.stevs[h],index:h})}else i.push(o.train)}i.forEach((function(t){return e.$delete(e.diagram.trains,t.id)})),a.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)})),this.historyManager.push({this:this,undo:function(){a.forEach((function(t){return t.stev.train.addNewStopEvent(t.stev,t.index)})),i.forEach((function(t){return e.$set(e.diagram.trains,t.id,t)}))},redo:function(){i.forEach((function(t){return e.$delete(e.diagram.trains,t.id)})),a.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)}))}}),this.viewState.trainSelections={}}}},{key:"onKeyUp",value:function(t){"Alt"==t.key&&(this.viewState.pointerPreciseState=null),"Control"==t.key&&(this.viewState.controlKeyPressed=!1)}},{key:"onContextMenu",value:function(t){return t.evt.preventDefault(),!1}}]),i}(m["g"]);Object(f["a"])([Object(m["c"])()],Rt.prototype,"viewConfig",void 0),Object(f["a"])([Object(m["c"])()],Rt.prototype,"viewState",void 0),Object(f["a"])([Object(m["c"])()],Rt.prototype,"diagram",void 0),Object(f["a"])([Object(m["b"])()],Rt.prototype,"historyManager",void 0),Rt=Object(f["a"])([Object(m["a"])({components:{BackLayer:it,Pointer:ht,TrainPathLayer:xt}})],Rt);var Nt=Rt,Et=Nt,Bt=Object(X["a"])(Et,C,x,!1,null,"1db9ad3a",null),Wt=Bt.exports,_t=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.viewConfig.editMode&&t.station.expanded&&t.isBottomLineIntersectingPlotPane?i("b-icon",{style:t.style,attrs:{icon:"plus",size:"is-small"},nativeOn:{click:function(e){return t.onClick(e)}}}):t._e()},It=[],$t=function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(d["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"style",get:function(){return{left:"".concat(this.diagram.config.leftPaneWidth-this.diagram.config.stationLabelRightMargin,"px"),top:"".concat(this.diagram.getYByRelY(this.station.bottomRelY)-this.diagram.config.trackLineSpan,"px"),height:"".concat(this.diagram.config.trackLineSpan,"px")}}},{key:"isBottomLineIntersectingPlotPane",get:function(){return this.diagram.getYByRelY(this.station.bottomRelY)>=this.diagram.config.topPaneHeight&&this.diagram.getYByRelY(this.station.bottomRelY)<this.viewState.viewHeight}},{key:"onClick",value:function(){var t=this;if(!this.viewState.inputEnabled){var e=this.station.addNewTrack(new w(this.station,this.diagram.genId(),""));this.diagram.updateY(),this.historyManager.push({this:this,undo:function(){t.station.removeTrack(e),t.diagram.updateY()},redo:function(){t.station.addNewTrack(e),t.diagram.updateY()}}),this.viewState.trackNameInputTarget=e,this.$emit("trackNameInputStart")}}}]),i}(m["g"]);Object(f["a"])([Object(m["c"])()],$t.prototype,"viewConfig",void 0),Object(f["a"])([Object(m["c"])()],$t.prototype,"viewState",void 0),Object(f["a"])([Object(m["c"])()],$t.prototype,"diagram",void 0),Object(f["a"])([Object(m["b"])()],$t.prototype,"historyManager",void 0),Object(f["a"])([Object(m["d"])()],$t.prototype,"station",void 0),$t=Object(f["a"])([m["a"]],$t);var Dt=$t,Ht=Dt,zt=Object(X["a"])(Ht,_t,It,!1,null,"597ad551",null),Ft=zt.exports,Xt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.isBottomLineIntersectingPlotPane?i("b-icon",{style:t.style,attrs:{icon:t.icon,size:"is-small"},nativeOn:{click:function(e){return t.onClick(e)}}}):t._e()},Jt=[],Ut=function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(d["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"icon",get:function(){return this.station.expanded?"chevron-up":"chevron-down"}},{key:"style",get:function(){return{left:"".concat(this.diagram.config.stationLabelLeftMargin,"px"),top:"".concat(this.diagram.getYByRelY(this.station.bottomRelY),"px"),height:"".concat(this.diagram.config.trackLineSpan,"px")}}},{key:"isBottomLineIntersectingPlotPane",get:function(){return this.diagram.getYByRelY(this.station.bottomRelY)>=this.diagram.config.topPaneHeight&&this.diagram.getYByRelY(this.station.bottomRelY)<this.viewState.viewHeight}},{key:"onClick",value:function(){this.viewState.inputEnabled||(this.station.expanded=!this.station.expanded,this.diagram.updateY())}}]),i}(m["g"]);Object(f["a"])([Object(m["c"])()],Ut.prototype,"viewState",void 0),Object(f["a"])([Object(m["c"])()],Ut.prototype,"diagram",void 0),Object(f["a"])([Object(m["d"])()],Ut.prototype,"station",void 0),Ut=Object(f["a"])([m["a"]],Ut);var Gt=Ut,At=Gt,Kt=Object(X["a"])(At,Xt,Jt,!1,null,"5be17e4a",null),Vt=Kt.exports,qt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("input",{directives:[{name:"show",rawName:"v-show",value:t.viewState.stationNameInputTarget,expression:"viewState.stationNameInputTarget"}],style:t.style,domProps:{value:t.targetStation.name},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onComplete(e)},blur:t.onComplete}})},Qt=[],Zt=function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(d["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"targetStation",get:function(){var t;return null!==(t=this.viewState.stationNameInputTarget)&&void 0!==t?t:{}}},{key:"style",get:function(){return{left:"".concat(this.diagram.config.stationLabelLeftMargin,"px"),top:"".concat(this.diagram.getYByRelY(this.targetStation.topRelY)-this.diagram.config.stationLabelFontSize-4,"px"),width:"".concat(this.diagram.config.leftPaneWidth-this.diagram.config.stationLabelLeftMargin-this.diagram.config.stationLabelRightMargin,"px"),height:"".concat(this.diagram.config.stationLabelFontSize+4,"px"),paddingTop:"2px",lineHeight:"".concat(this.diagram.config.stationLabelFontSize,"px"),border:"none",fontSize:"".concat(this.diagram.config.stationLabelFontSize,"px")}}},{key:"onComplete",value:function(){var t=this.targetStation,e=this.targetStation.name,i=this.$el.value;e!=i&&(t.name=i,this.historyManager.push({this:this,undo:function(){t.name=e},redo:function(){t.name=i}})),this.viewState.stationNameInputTarget=null}}]),i}(m["g"]);Object(f["a"])([Object(m["c"])()],Zt.prototype,"viewState",void 0),Object(f["a"])([Object(m["c"])()],Zt.prototype,"diagram",void 0),Object(f["a"])([Object(m["b"])()],Zt.prototype,"historyManager",void 0),Zt=Object(f["a"])([m["a"]],Zt);var te=Zt,ee=te,ie=Object(X["a"])(ee,qt,Qt,!1,null,"37eb2912",null),ae=ie.exports,ne=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.viewConfig.editMode&&t.isTopLineIntersectingPlotPane?i("b-icon",{style:t.style,attrs:{icon:"close",size:"is-small"},nativeOn:{click:function(e){return t.onClick(e)}}}):t._e()},re=[],oe=function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(d["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"style",get:function(){return{left:"".concat(this.diagram.config.leftPaneWidth-this.diagram.config.stationLabelRightMargin,"px"),top:"".concat(this.diagram.getYByRelY(this.station.topRelY)-this.diagram.config.trackLineSpan,"px"),height:"".concat(this.diagram.config.trackLineSpan,"px")}}},{key:"isTopLineIntersectingPlotPane",get:function(){return this.diagram.getYByRelY(this.station.topRelY)>=this.diagram.config.topPaneHeight&&this.diagram.getYByRelY(this.station.topRelY)<this.viewState.viewHeight}},{key:"onClick",value:function(){var t=this;if(!this.viewState.busy){for(var e=[],i=[],a=0,n=Object.values(this.diagram.trains);a<n.length;a++)for(var r=n[a],o=0;o<r.stevs.length;++o){var s=r.stevs[o];s.station==this.station&&(i.push({stev:s,index:o}),r.stevs.length<=1&&e.push(r))}i.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)})),e.forEach((function(e){return t.diagram.removeTrain(e)})),this.$delete(this.diagram.stations,this.station.id),this.diagram.updateY(),this.historyManager.push({this:this,undo:function(){t.$set(t.diagram.stations,t.station.id,t.station),e.forEach((function(e){return t.diagram.addNewTrain(e)})),i.forEach((function(t){return t.stev.train.addNewStopEvent(t.stev,t.index)})),t.diagram.updateY()},redo:function(){i.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)})),e.forEach((function(e){return t.diagram.removeTrain(e)})),t.$delete(t.diagram.stations,t.station.id),t.diagram.updateY()}})}}}]),i}(m["g"]);Object(f["a"])([Object(m["c"])()],oe.prototype,"viewConfig",void 0),Object(f["a"])([Object(m["c"])()],oe.prototype,"viewState",void 0),Object(f["a"])([Object(m["c"])()],oe.prototype,"diagram",void 0),Object(f["a"])([Object(m["b"])()],oe.prototype,"historyManager",void 0),Object(f["a"])([Object(m["d"])()],oe.prototype,"station",void 0),oe=Object(f["a"])([m["a"]],oe);var se=oe,ce=se,le=Object(X["a"])(ce,ne,re,!1,null,"72979f3e",null),he=le.exports,de=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.viewConfig.editMode&&t.station.expanded&&Object.values(t.station.tracks).length>1&&t.isLineIntersectingPlotPane?i("b-icon",{style:t.style,attrs:{icon:"close",size:"is-small"},nativeOn:{click:function(e){return t.onClick(e)}}}):t._e()},ge=[],ue=function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(d["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"style",get:function(){return{left:"".concat(this.diagram.config.leftPaneWidth-this.diagram.config.stationLabelRightMargin,"px"),top:"".concat(this.diagram.getYByRelY(this.track.relY)-this.diagram.config.trackLineSpan,"px"),height:"".concat(this.diagram.config.trackLineSpan,"px")}}},{key:"isLineIntersectingPlotPane",get:function(){return this.diagram.getYByRelY(this.track.relY)>=this.diagram.config.topPaneHeight&&this.diagram.getYByRelY(this.track.relY)<this.viewState.viewHeight}},{key:"onClick",value:function(){var t=this;if(!this.viewState.busy){for(var e=[],i=[],a=0,n=Object.values(this.diagram.trains);a<n.length;a++)for(var r=n[a],o=0;o<r.stevs.length;++o){var s=r.stevs[o];s.track==this.track&&(i.push({stev:s,index:o}),r.stevs.length<=1&&e.push(r))}var c=this.station.tracks.indexOf(this.track);i.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)})),e.forEach((function(e){return t.diagram.removeTrain(e)})),this.station.removeTrack(this.track),this.diagram.updateY(),this.historyManager.push({this:this,undo:function(){t.station.addNewTrack(t.track,c),e.forEach((function(e){return t.diagram.addNewTrain(e)})),i.forEach((function(t){return t.stev.train.addNewStopEvent(t.stev,t.index)})),t.diagram.updateY()},redo:function(){i.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)})),e.forEach((function(e){return t.diagram.removeTrain(e)})),t.station.removeTrack(t.track),t.diagram.updateY()}})}}}]),i}(m["g"]);Object(f["a"])([Object(m["c"])()],ue.prototype,"viewConfig",void 0),Object(f["a"])([Object(m["c"])()],ue.prototype,"viewState",void 0),Object(f["a"])([Object(m["c"])()],ue.prototype,"diagram",void 0),Object(f["a"])([Object(m["b"])()],ue.prototype,"historyManager",void 0),Object(f["a"])([Object(m["d"])()],ue.prototype,"station",void 0),Object(f["a"])([Object(m["d"])()],ue.prototype,"track",void 0),ue=Object(f["a"])([m["a"]],ue);var ve=ue,fe=ve,me=Object(X["a"])(fe,de,ge,!1,null,"4ff8e214",null),pe=me.exports,be=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("input",{directives:[{name:"show",rawName:"v-show",value:t.viewState.trackNameInputTarget,expression:"viewState.trackNameInputTarget"}],style:t.style,domProps:{value:t.targetTrack.name},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onComplete(e)},blur:t.onComplete}})},Se=[],ye=function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(d["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"targetTrack",get:function(){var t;return null!==(t=this.viewState.trackNameInputTarget)&&void 0!==t?t:{}}},{key:"style",get:function(){return this.viewState.trackNameInputTarget?{left:"".concat(this.diagram.config.stationLabelLeftMargin+this.diagram.config.trackLabelLeftMargin,"px"),top:"".concat(this.diagram.getYByRelY(this.targetTrack.relY)-this.diagram.config.stationLabelFontSize-4,"px"),width:"".concat(this.diagram.config.leftPaneWidth-this.diagram.config.stationLabelLeftMargin-this.diagram.config.trackLabelLeftMargin-this.diagram.config.stationLabelRightMargin,"px"),height:"".concat(this.diagram.config.stationLabelFontSize+4,"px"),paddingTop:"2px",lineHeight:"".concat(this.diagram.config.stationLabelFontSize,"px"),border:"none",fontSize:"".concat(this.diagram.config.stationLabelFontSize,"px")}:{}}},{key:"onComplete",value:function(){var t=this.targetTrack,e=t.name,i=this.$el.value;e!=i&&(t.name=i,this.historyManager.push({this:this,undo:function(){t.name=e},redo:function(){t.name=i}})),this.viewState.trackNameInputTarget=null}}]),i}(m["g"]);Object(f["a"])([Object(m["c"])()],ye.prototype,"viewState",void 0),Object(f["a"])([Object(m["c"])()],ye.prototype,"diagram",void 0),Object(f["a"])([Object(m["b"])()],ye.prototype,"historyManager",void 0),ye=Object(f["a"])([m["a"]],ye);var we=ye,ke=we,Oe=Object(X["a"])(ke,be,Se,!1,null,"c5f560d4",null),je=Oe.exports,Te=function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){var t;return Object(d["a"])(this,i),t=e.apply(this,arguments),t.viewState=new L,t}return Object(g["a"])(i,[{key:"mounted",value:function(){var t=new ResizeObserver(this.updateViewSize);t.observe(this.$el)}},{key:"onStationNameInputStart",value:function(){var t=this;this.$nextTick((function(){return t.$refs.stationNameInput.$el.focus()}))}},{key:"onTrackNameInputStart",value:function(){var t=this;this.$nextTick((function(){return t.$refs.trackNameInput.$el.focus()}))}},{key:"updateViewSize",value:function(){this.$el&&(this.viewState.viewWidth=this.$el.clientWidth,this.viewState.viewHeight=this.$el.clientHeight,this.diagram.config.scrollX=Math.max(this.diagram.config.minPlotTime*this.diagram.config.xScale-this.diagram.config.plotPanePadding,Math.min(this.diagram.config.maxPlotTime*this.diagram.config.xScale-(this.viewState.viewWidth-this.diagram.config.leftPaneWidth-this.diagram.config.plotPanePadding),this.diagram.config.scrollX)),this.diagram.config.scrollY=Math.max(0,Math.min(this.diagram.getYByRelY(this.diagram.maxRelY),this.diagram.config.scrollY)))}}]),i}(m["g"]);Object(f["a"])([Object(m["d"])({default:function(){return T.fromJSON({stations:[],trains:[]})}}),Object(m["f"])()],Te.prototype,"diagram",void 0),Object(f["a"])([Object(m["d"])({default:new M}),Object(m["f"])()],Te.prototype,"viewConfig",void 0),Object(f["a"])([Object(m["d"])(),Object(m["e"])()],Te.prototype,"historyManager",void 0),Object(f["a"])([Object(m["f"])()],Te.prototype,"viewState",void 0),Te=Object(f["a"])([Object(m["a"])({components:{Stage:Wt,StationAddTrackButton:Ft,StationExpandButton:Vt,StationNameInput:ae,StationRemoveButton:he,StationRemoveTrackButton:pe,TrackNameInput:je}})],Te);var Me=Te,Pe=Me,Ye=(i("ff76"),Object(X["a"])(Pe,P,Y,!1,null,"fee8a654",null)),Le=Ye.exports,Ce=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-carousel",{attrs:{autoplay:!1,"indicator-inside":!1}},[a("b-carousel-item",[a("div",{staticClass:"help-item"},[a("div",{staticClass:"help-image"},[a("img",{attrs:{src:i("c98c")}})]),a("div",{staticClass:"help-desc content"},[a("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.addNewStationTitle"))}}),a("p",{domProps:{innerHTML:t._s(t.$t("message.help.addNewStationBody"))}})])])]),a("b-carousel-item",[a("div",{staticClass:"help-item"},[a("div",{staticClass:"help-image"},[a("img",{attrs:{src:i("bfd4")}})]),a("div",{staticClass:"help-desc content"},[a("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.addNewTrainTitle"))}}),a("p",{domProps:{innerHTML:t._s(t.$t("message.help.addNewTrainBody"))}})])])]),a("b-carousel-item",[a("div",{staticClass:"help-item"},[a("div",{staticClass:"help-image"},[a("img",{attrs:{src:i("41d8")}})]),a("div",{staticClass:"help-desc content"},[a("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.selectTrainTitle"))}}),a("p",{domProps:{innerHTML:t._s(t.$t("message.help.selectTrainBody"))}})])])]),a("b-carousel-item",[a("div",{staticClass:"help-item"},[a("div",{staticClass:"help-image"},[a("img",{attrs:{src:i("07f5")}})]),a("div",{staticClass:"help-desc content"},[a("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.editTrainTitle"))}}),a("p",{domProps:{innerHTML:t._s(t.$t("message.help.editTrainBody"))}})])])]),a("b-carousel-item",[a("div",{staticClass:"help-item"},[a("div",{staticClass:"help-image"},[a("img",{attrs:{src:i("965e")}})]),a("div",{staticClass:"help-desc content"},[a("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.editTimeTitle"))}}),a("p",{domProps:{innerHTML:t._s(t.$t("message.help.editTimeBody"))}})])])]),a("b-carousel-item",[a("div",{staticClass:"help-item"},[a("img",{attrs:{src:i("60b1")}}),a("div",{staticClass:"help-desc content"},[a("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.tipsTitle"))}}),a("p",{domProps:{innerHTML:t._s(t.$t("message.help.tipsBody"))}})])])]),a("b-carousel-item",[a("div",{staticClass:"help-item"},[a("div",{staticClass:"help-desc content"},[a("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.contactTitle"))}}),a("p",{domProps:{innerHTML:t._s(t.$t("message.help.contactBody"))}})])])])],1)},xe=[],Re=function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(d["a"])(this,i),e.apply(this,arguments)}return i}(m["g"]);Re=Object(f["a"])([m["a"]],Re);var Ne=Re,Ee=Ne,Be=(i("d8a1"),Object(X["a"])(Ee,Ce,xe,!1,null,"ec83cbc6",null)),We=Be.exports,_e=function(t){Object(u["a"])(i,t);var e=Object(v["a"])(i);function i(){var t;return Object(d["a"])(this,i),t=e.apply(this,arguments),t.diagramFileName="diagram.json",t.diagram=T.fromJSON({stations:[],trains:[]}),t.viewConfig=new M,t.historyManager=new p(100),t.enableSwitchEditMode=window.screen.width>=640,t.subView="none",t}return Object(g["a"])(i,[{key:"mounted",value:function(){var t=this;this.viewConfig.editMode=this.enableSwitchEditMode,fetch("sample-diagram.json").then(function(){var e=Object(h["a"])(regeneratorRuntime.mark((function e(i){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i.json();case 2:a=e.sent,t.diagram=T.fromJSON(a),t.diagramFileName="sample-diagram.json";case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"onEditButtonClick",value:function(){this.viewConfig.editMode=!this.viewConfig.editMode}},{key:"onUndoButtonClick",value:function(){this.historyManager.undo()}},{key:"onRedoButtonClick",value:function(){this.historyManager.redo()}},{key:"onVanishButtonClick",value:function(){var t=this;if(Object.keys(this.diagram.trains).length>0){var e=this.diagram.trains;this.historyManager.push({this:this,undo:function(){t.diagram.trains=e},redo:function(){t.diagram.trains={}}}),this.diagram.trains={}}else{var i=this.diagram;this.historyManager.push({this:this,undo:function(){t.diagram=i},redo:function(){t.diagram=T.fromJSON({stations:{},trains:{}})}}),this.diagram=T.fromJSON({stations:{},trains:{}})}}},{key:"onUploadButtonClick",value:function(){var t=this,e=document.createElement("input");e.type="file",e.accept=".json, application/json",e.onchange=function(){var i=new FileReader;if(e.files&&e.files.length>0){var a=e.files[0];i.readAsText(a),i.onload=function(){if("string"==typeof i.result)try{var e=JSON.parse(i.result);t.diagram=T.fromJSON(e),t.diagramFileName=a.name,t.historyManager.clear()}catch(n){t.$buefy.notification.open({type:"is-danger",message:"".concat(t.$t("message.failedToLoadJSON").toString(),"<br>").concat(a.name)})}}}},e.click()}},{key:"onDownloadButtonClick",value:function(){var t=JSON.stringify(this.diagram),e=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(e),a=document.createElement("a");a.href=i,a.download=this.diagramFileName,a.click()}},{key:"onHelpButtonClick",value:function(){this.subView="help"==this.subView?"none":"help"}}]),i}(m["g"]);_e=Object(f["a"])([Object(m["a"])({components:{DiagramView:Le,HelpView:We}})],_e);var Ie=_e,$e=Ie,De=(i("5c0b"),Object(X["a"])($e,c,l,!1,null,null,null)),He=De.exports,ze={ja:{message:{failedToLoadJSON:"",editButtonTooltip:"",undoButtonTooltip:"",redoButtonTooltip:"",vanishTrainsButtonTooltip:"",vanishStationsButtonTooltip:"",uploadButtonTooltip:"",downloadButtonTooltip:"",helpButtonTooltip:"",help:{addNewStationTitle:"",addNewStationBody:"<p></p><ul><li><li><li><i class='mdi mdi-close'></i></ul>",addNewTrainTitle:"",addNewTrainBody:"<p></p><ul><li><li>Alt<li></ul>",selectTrainTitle:"",selectTrainBody:"<p></p><ul><li>Shift<li><br>Shift</ul>",editTrainTitle:"",editTrainBody:"<p></p><ul><li><li><li>Delete</ul>",editTimeTitle:"",editTimeBody:"<p></p><ul><li>Alt<li><li>Ctrl<br></ul>",tipsTitle:"",tipsBody:"<ul><li><i class='mdi mdi-undo'></i><i class='mdi mdi-redo'></i><li><i class='mdi mdi-vanish'></i><li><i class='mdi mdi-upload'></i><i class='mdi mdi-download'></i></ul>",contactTitle:"",contactBody:"<p><a href='https://twitter.com/nosrithe'>@nosrithe</a> </p><ul><li><li> <a href='https://github.com/nosrith/diafreaks/issues'>GitHub </a> <br></ul>"}}}};a["default"].config.productionTip=!1,a["default"].use(n["a"],{defaultNotificationDuration:5e3,defaultNotificationPosition:"is-bottom-right"}),a["default"].use(r["a"]),a["default"].use(s.a);var Fe=new r["a"]({locale:"ja",messages:ze});new a["default"]({render:function(t){return t(He)},i18n:Fe}).$mount("#app")},d8a1:function(t,e,i){"use strict";i("09ec")},ff76:function(t,e,i){"use strict";i("b6b6")}});
//# sourceMappingURL=app.eea20361.js.map