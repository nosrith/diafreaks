(function(t){function e(e){for(var n,r,s=e[0],c=e[1],l=e[2],u=0,g=[];u<s.length;u++)r=s[u],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&g.push(a[r][0]),a[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);h&&h(e);while(g.length)g.shift()();return o.push.apply(o,l||[]),i()}function i(){for(var t,e=0;e<o.length;e++){for(var i=o[e],n=!0,s=1;s<i.length;s++){var c=i[s];0!==a[c]&&(n=!1)}n&&(o.splice(e--,1),t=r(r.s=i[0]))}return t}var n={},a={app:0},o=[];function r(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=n,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var h=c;o.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("cd49")},"07f5":function(t,e,i){t.exports=i.p+"img/help_edit_train.67395182.png"},"09ec":function(t,e,i){},3009:function(t,e,i){},"41d8":function(t,e,i){t.exports=i.p+"img/help_select_train.6cd1d819.png"},"4bc9":function(t,e,i){"use strict";i("84ab")},"5c0b":function(t,e,i){"use strict";i("9c0c")},"60b1":function(t,e,i){t.exports=i.p+"img/help_tips.12f4142e.png"},"84ab":function(t,e,i){},"8a96":function(t,e,i){"use strict";i("3009")},"965e":function(t,e,i){t.exports=i.p+"img/help_edit_time.25aa545d.png"},"9c0c":function(t,e,i){},a8d2:function(t,e,i){t.exports=i.p+"img/diafreaks_logo.8b0abdc8.png"},bfd4:function(t,e,i){t.exports=i.p+"img/help_add_new_train.0fab88c8.png"},c98c:function(t,e,i){t.exports=i.p+"img/help_add_new_station.d55b6e32.png"},cd49:function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var n=i("2b0e"),a=i("289d"),o=(i("5abe"),i("a925")),r=i("7591"),s=i.n(r),c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("diagram-view",{attrs:{id:"diagram-view",context:t.context}}),"help"==t.subView?i("help-view",{attrs:{id:"help-pane"}}):t._e(),i("div",{attrs:{id:"nav-pane"}},[t._m(0),i("span",{attrs:{id:"nav-pane-buttons"}},[i("span",{attrs:{id:"nav-pane-buttons-left"}},[t.enableSwitchEditMode?i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.editButtonTooltip"),type:"is-light"}},[i("b-button",{class:t.context.state.editMode?"is-selected":"",attrs:{"icon-left":"pencil-outline",size:"medium"},on:{click:t.onEditButtonClick}})],1)],1):t._e(),t.context.state.editMode?i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.undoButtonTooltip"),type:"is-light"}},[i("b-button",{attrs:{"icon-left":"undo",size:"medium",disabled:!t.context.history.undoable},on:{click:t.onUndoButtonClick}})],1)],1):t._e(),t.context.state.editMode?i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.redoButtonTooltip"),type:"is-light"}},[i("b-button",{attrs:{"icon-left":"redo",size:"medium",disabled:!t.context.history.redoable},on:{click:t.onRedoButtonClick}})],1)],1):t._e(),t.context.state.editMode?i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:Object.keys(t.context.diagram.trains).length>0?t.$t("message.vanishTrainsButtonTooltip"):t.$t("message.vanishStationsButtonTooltip"),type:"is-light"}},[i("b-button",{attrs:{"icon-left":"vanish",size:"medium"},on:{click:t.onVanishButtonClick}})],1)],1):t._e(),i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.uploadButtonTooltip"),type:"is-light"}},[i("b-button",{attrs:{"icon-left":"upload",size:"medium"},on:{click:t.onUploadButtonClick}})],1)],1),i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.downloadButtonTooltip"),type:"is-light"}},[i("b-button",{attrs:{"icon-left":"download",size:"medium"},on:{click:t.onDownloadButtonClick}})],1)],1)]),i("span",{attrs:{id:"nav-pane-buttons-spacer"}}),i("span",{attrs:{id:"nav-pane-buttons-right"}},[t.enableSwitchEditMode?i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.helpButtonTooltip"),type:"is-light"}},[i("b-button",{class:"help"==t.subView?"is-selected":"",attrs:{"icon-left":"help",size:"medium"},on:{click:t.onHelpButtonClick}})],1)],1):t._e()])])])],1)},l=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"nav-pane-item",attrs:{id:"nav-pane-logo"}},[n("img",{staticStyle:{height:"32px"},attrs:{src:i("a8d2")}})])}],h=i("1da1"),u=i("d4ec"),g=i("bee2"),d=i("262e"),v=i("2caf"),f=(i("96cf"),i("d3b7"),i("b64b"),i("b0c0"),i("99af"),i("25f0"),i("3ca3"),i("ddb0"),i("2b3d"),i("9ab4")),m=i("1b40"),p=(i("a434"),function(){function t(e){Object(u["a"])(this,t),this.capacity=e,this.undos=[],this.redos=[]}return Object(g["a"])(t,[{key:"undoable",get:function(){return this.undos.length>0}},{key:"redoable",get:function(){return this.redos.length>0}},{key:"push",value:function(t){this.undos.length>=this.capacity&&this.undos.splice(0,this.undos.length-this.capacity+1),this.undos.push(t),this.redos.splice(0)}},{key:"clear",value:function(){this.undos.splice(0),this.redos.splice(0)}},{key:"undo",value:function(){var t=this.undos.pop();t&&(this.redos.push(t),t.undo.apply(t.this))}},{key:"redo",value:function(){var t=this.redos.pop();t&&(this.undos.push(t),t.redo.apply(t.this))}}]),t}()),S=i("53ca"),b=i("b85c"),w=(i("07ac"),i("159b"),i("c1f9"),i("d81d"),i("4de4"),function(){function t(){Object(u["a"])(this,t),this.minimumTimeUnit=5,this.minPlotTime=0,this.maxPlotTime=108e3,this.leftPaneWidth=160,this.trackLineSpan=12,this.scrollX=1728,this.scrollY=0,this.xScale=.1,this.yScale=12}return Object(g["a"])(t,null,[{key:"fromJSON",value:function(e){if(!e||"object"!=Object(S["a"])(e))throw"Invalid JSON";var i=new t;return Object.assign(i,Object.fromEntries(Object.keys(i).filter((function(t){return void 0!==e[t]})).map((function(t){return[t,e[t]]})))),i}}]),t}()),y=function(){function t(e,i,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(u["a"])(this,t),this.station=e,this.id=i,this.name=n,this.relY=a}return Object(g["a"])(t,[{key:"toJSON",value:function(){return{id:this.id,name:this.name}}}],[{key:"fromJSON",value:function(e,i){if(!e||"object"!=Object(S["a"])(e)||null==e.id)throw"Invalid JSON @ Track";return new t(i,e.id,e.name,e.relY)}}]),t}(),k=function(){function t(e,i,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;Object(u["a"])(this,t),this.id=e,this.name=i,this.mileage=n,this.expanded=a,this.topRelY=o,this.bottomRelY=r,this.tracks=[]}return Object(g["a"])(t,[{key:"addNewTrack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.tracks.length;return this.tracks.splice(e,0,t),this.tracks[e]}},{key:"removeTrack",value:function(t){var e=this.tracks.indexOf(t);e>=0&&this.tracks.splice(e,1)}},{key:"toJSON",value:function(){return{id:this.id,name:this.name,mileage:this.mileage,tracks:this.tracks,expanded:this.expanded}}}],[{key:"fromJSON",value:function(e){if(!e||"object"!=Object(S["a"])(e)||null==e.id||null==e.name||null==e.mileage||!Array.isArray(e.tracks))throw"Invalid JSON @ Station";var i=new t(e.id,e.name,e.mileage,!!e.expanded);return e.tracks.map((function(t){return y.fromJSON(t,i)})).forEach((function(t){return i.tracks.push(t)})),i}}]),t}(),x=(i("5db7"),i("73d9"),i("7db0"),function(){function t(e,i,n){Object(u["a"])(this,t),this.train=e,this.track=i,this.time=n,this.privateId=++t.maxPrivateId}return Object(g["a"])(t,[{key:"station",get:function(){return this.track.station}},{key:"next",get:function(){var t=this.train.stevs.indexOf(this);return t>=0?this.train.stevs[t+1]:void 0}},{key:"prev",get:function(){var t=this.train.stevs.indexOf(this);return t>=0?this.train.stevs[t-1]:void 0}}],[{key:"fromJSONStop",value:function(e,i,n){if(!e||"object"!=Object(S["a"])(e)||null==e.stationId||null==e.trackId||null==e.arrTime||null==e.depTime)throw"Invalid JSON @ Stop";var a=n[e.stationId],o=a&&a.tracks.find((function(t){return t.id==e.trackId}));if(!a||!o)throw"Invalid data @ Stop";return e.arrTime==e.depTime?[new t(i,o,e.arrTime)]:[new t(i,o,e.arrTime),new t(i,o,e.depTime)]}}]),t}());x.maxPrivateId=0;var C=function(){function t(e,i){Object(u["a"])(this,t),this.id=e,this.name=i,this.stevs=[]}return Object(g["a"])(t,[{key:"addNewStopEvent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.stevs.length;return this.stevs.splice(e,0,t),this.stevs[e]}},{key:"removeStopEvent",value:function(t){var e=this.stevs.indexOf(t);e>=0&&this.stevs.splice(e,1)}},{key:"getStopEventsInRange",value:function(t){var e,i=[],n=!1,a=Object(b["a"])(this.stevs);try{for(a.s();!(e=a.n()).done;){var o=e.value;o==t.from&&(n=!0),n&&i.push(o),o==t.to&&(n=!1)}}catch(r){a.e(r)}finally{a.f()}return i}},{key:"getTrainPathNodes",value:function(){var t,e=[],i=Object(b["a"])(this.stevs);try{for(i.s();!(t=i.n()).done;){var n=t.value;n.station.expanded&&n.prev&&n.prev.station!=n.station&&e.push({stev:n,phase:"arr",time:n.time,relY:n.prev.station.mileage<n.station.mileage?n.station.topRelY:n.station.bottomRelY}),e.push({stev:n,phase:"track",time:n.time,relY:n.track.relY}),n.station.expanded&&n.next&&n.next.station!=n.station&&e.push({stev:n,phase:"dep",time:n.time,relY:n.next.station.mileage<n.station.mileage?n.station.topRelY:n.station.bottomRelY})}}catch(a){i.e(a)}finally{i.f()}return e}},{key:"toJSON",value:function(){var t,e=[],i=Object(b["a"])(this.stevs);try{for(i.s();!(t=i.n()).done;){var n=t.value,a=e[e.length-1];a&&a.trackId==n.track.id&&a.arrTime==a.depTime?a.depTime=n.time:e.push({stationId:n.station.id,trackId:n.track.id,arrTime:n.time,depTime:n.time})}}catch(o){i.e(o)}finally{i.f()}return{id:this.id,name:this.name,stops:e}}}],[{key:"fromJSON",value:function(e,i){if(!e||"object"!=Object(S["a"])(e)||null==e.id||null==e.name||!Array.isArray(e.stops))throw"Invalid JSON @ Train";var n=new t(e.id,e.name);return e.stops.flatMap((function(t){return x.fromJSONStop(t,n,i)})).forEach((function(t){return n.stevs.push(t)})),n}}]),t}(),T=function(){function t(e,i,n){Object(u["a"])(this,t),this.config=e,this.stations=i,this.trains=n,this.maxId=0,this.maxRelY=0}return Object(g["a"])(t,[{key:"getStationsInMileageOrder",value:function(){return Object.values(this.stations).sort((function(t,e){return t.mileage-e.mileage}))}},{key:"genId",value:function(){return++this.maxId}},{key:"releaseId",value:function(t){t==this.maxId&&--this.maxId}},{key:"addNewStation",value:function(t){return n["default"].set(this.stations,t.id,t)}},{key:"removeStation",value:function(t){n["default"].delete(this.stations,t.id)}},{key:"addNewTrain",value:function(t){return n["default"].set(this.trains,t.id,t)}},{key:"removeTrain",value:function(t){n["default"].delete(this.trains,t.id)}},{key:"updateY",value:function(){var t=this;if(0!=Object.keys(this.stations).length){var e,i=this.getStationsInMileageOrder(),n=i[0].mileage,a=Object(b["a"])(i);try{for(a.s();!(e=a.n()).done;){var o=e.value;o.mileage=o.mileage-n}}catch(u){a.e(u)}finally{a.f()}var r,s=0,c=0,l=Object(b["a"])(i);try{for(l.s();!(r=l.n()).done;){var h=r.value;s+=(h.mileage-c)*this.config.yScale,h.topRelY=s,h.expanded?(h.tracks.forEach((function(e,i){e.relY=s+(i+1)*t.config.trackLineSpan})),h.bottomRelY=s+(h.tracks.length+1)*this.config.trackLineSpan,s+=(h.tracks.length+1)*this.config.trackLineSpan):(Object.values(h.tracks).forEach((function(t){return t.relY=s})),h.bottomRelY=s),c=h.mileage}}catch(u){l.e(u)}finally{l.f()}this.maxRelY=i[i.length-1].bottomRelY}else this.maxRelY=0}},{key:"toJSON",value:function(){return{config:this.config,stations:this.stations,trains:this.trains}}}],[{key:"fromJSON",value:function(e){if(!e||"object"!=Object(S["a"])(e)||"object"!=Object(S["a"])(e.stations)||"object"!=Object(S["a"])(e.trains))throw"Invalid JSON";for(var i=w.fromJSON(e.config||{}),n=Object.fromEntries(Object.values(e.stations).map((function(t){return[t.id,k.fromJSON(t)]}))),a=Object.fromEntries(Object.values(e.trains).map((function(t){return[t.id,C.fromJSON(t,n)]}))),o=new t(i,n,a),r=e.maxId?Math.max(e.maxId,0):0,s=0,c=Object.values(n);s<c.length;s++){var l=c[s];r=Math.max(l.id,r);var h,u=Object(b["a"])(l.tracks);try{for(u.s();!(h=u.n()).done;){var g=h.value;r=Math.max(g.id,r)}}catch(m){u.e(m)}finally{u.f()}}for(var d=0,v=Object.values(a);d<v.length;d++){var f=v[d];r=Math.max(f.id,r)}return o.maxId=r,o.updateY(),o}}]),t}(),O=function t(){Object(u["a"])(this,t),this.fontFamily="Verdana, sans-serif",this.topPaneHeight=30,this.hourlyLabelBottomMargin=4,this.hourlyLabelFontSize=14,this.hourlyLabelColor="rgb(128, 192, 128)",this.hourlyGridLineWidth=2.25,this.hourlyGridLineColor="rgb(128, 192, 128)",this.majorMinutelyGridLineSpan=600,this.majorMinutelyGridLineWidth=1.5,this.majorMinutelyGridLineColor="rgb(128, 192, 128)",this.minorMinutelyGridLineSpan=120,this.minorMinutelyGridLineWidth=.75,this.minorMinutelyGridLineColor="rgb(128, 192, 128)",this.stationLabelLeftMargin=14,this.stationLabelRightMargin=14,this.stationLabelFontSize=14,this.stationLabelColor="rgb(128, 192, 128)",this.stationLineWidth=1,this.stationLineColor="rgb(128, 192, 128)",this.plotPanePadding=4,this.trackLabelLeftMargin=10,this.trackLabelFontSize=11,this.trackLabelColor="rgb(128, 192, 128)",this.trackLineWidth=.75,this.trackLineColor="rgb(128, 192, 128)",this.trainPathWidth=1,this.trainPathColor="rgb(0, 0, 0)",this.trainNameLabelLineHeight=14,this.trainNameLabelFontSize=12,this.minHitWidth=3,this.pointerWidth=3,this.pointerColor="rgb(0, 0, 0)",this.pointerLabelFontSize=12,this.pointerPrecisePixelPerTimeUnit=5,this.selectedTrackLabelColor="rgb(255, 0, 0)",this.selectedTrackLineColor="rgb(255, 0, 0)",this.selectedTrainPathColor="rgb(255, 0, 0)",this.selectedTrainPathWidthScale=1.5,this.selectedTrainPathMarkerWidth=5,this.selectedTrainPathMarkerColor="rgb(255, 0, 0)",this.unselectedTrainPathOpacity=.5,this.markerLabelMaxDistance=20,this.markerLabelColor="rgb(255, 0, 0)",this.markerLabelFontSize=12,this.markerLabelLineHeight=16,this.wheelScale=.1},j=function(){function t(){Object(u["a"])(this,t),this.editMode=!0,this.viewWidth=0,this.viewHeight=0,this.trainSelections={},this.pointerScreenX=0,this.pointerTime=0,this.pointerY=0,this.pointerTargetTrainPath=null,this.pointerTargetLine=null,this.pointerPreciseState=null,this.drawingState=null,this.trainPathDragState=null,this.stationNameInputTarget=null,this.trackNameInputTarget=null,this.trainInfoEditorTarget=null,this.controlKeyPressed=!1}return Object(g["a"])(t,[{key:"busy",get:function(){return null!=this.drawingState||null!=this.trainPathDragState||this.inputEnabled}},{key:"inputEnabled",get:function(){return null!=this.stationNameInputTarget||null!=this.trackNameInputTarget}}]),t}(),L=function(){function t(){Object(u["a"])(this,t),this.config=new O,this.state=new j,this.diagram=T.fromJSON({stations:[],trains:[]}),this.history=new p(100)}return Object(g["a"])(t,[{key:"getYByRelY",value:function(t){return t+this.config.plotPanePadding+this.config.topPaneHeight-this.diagram.config.scrollY}},{key:"getRelYByY",value:function(t){return t-this.config.plotPanePadding-this.config.topPaneHeight+this.diagram.config.scrollY}},{key:"getXByTime",value:function(t){return t*this.diagram.config.xScale+this.diagram.config.leftPaneWidth-this.diagram.config.scrollX}},{key:"getTimeByX",value:function(t){return(t-this.diagram.config.leftPaneWidth+this.diagram.config.scrollX)/this.diagram.config.xScale}}]),t}(),P=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"diagram-view"},[i("stage",{staticClass:"diagram-view-stage",on:{stationNameInputStart:t.onStationNameInputStart,trackNameInputStart:t.onTrackNameInputStart,trainInfoEditStart:t.onTrainInfoEditStart,trainInfoEditEnd:t.onTrainInfoEditEnd}}),i("div",{staticClass:"diagram-view-ui"},[i("station-name-input",{ref:"stationNameInput"}),i("track-name-input",{ref:"trackNameInput"}),i("train-info-editor",{ref:"trainInfoEditor"}),t._l(Object.values(t.diagram.stations),(function(e){return i("station-expand-button",{key:"station-expand-button-"+e.id,attrs:{station:e},on:{trackNameInputStart:t.onTrackNameInputStart}})})),t._l(Object.values(t.diagram.stations),(function(t){return i("station-remove-button",{key:"station-remove-button-"+t.id,attrs:{station:t}})})),t._l(Object.values(t.diagram.stations),(function(e){return i("station-add-track-button",{key:"station-add-track-button-"+e.id,attrs:{station:e},on:{trackNameInputStart:t.onTrackNameInputStart}})})),t._l(Object.values(t.diagram.stations),(function(e){return t._l(e.tracks,(function(t){return i("station-remove-track-button",{key:"station-remove-track-button-"+e.id+"-"+t.id,attrs:{station:e,track:t}})}))}))],2)],1)},M=[],Y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.diagram?i("v-stage",{attrs:{config:t.stageConfig},on:{mousedown:t.onStageMouseDown,mousemove:t.onStageMouseMove,click:t.onStageClick,dblclick:t.onStageDoubleClick,wheel:t.onStageMouseWheel,contextmenu:t.onContextMenu,touchend:t.onTouchEnd}},[i("back-layer",t._g({},t.$listeners)),i("train-path-layer",t._g({},t.$listeners)),i("v-layer",[i("pointer")],1)],1):t._e()},N=[],R=i("ade3"),E=(i("2ca0"),i("4057"),i("2af1"),i("38cf"),i("c8b5")),I=i.n(E),B=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-layer",{attrs:{id:"back-layer"}},[t._l(t.timeGridLines,(function(e){return i("v-group",{key:e.key},[i("v-line",{attrs:{config:e.lineConfig}}),e.labelConfig?i("v-text",{attrs:{config:e.labelConfig}}):t._e()],1)})),t._l(Object.values(t.diagram.stations),(function(e){return i("station-group",t._g({key:"station-"+e.id,attrs:{station:e}},t.$listeners))}))],2)},W=[],_=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-group",[t.isTopLineIntersectingPlotPane?i("v-group",[i("v-line",{attrs:{config:t.topLineConfig}}),t._l(t.labelCharacters,(function(t){return i("v-text",{key:t.key,attrs:{config:t}})})),i("v-rect",{attrs:{config:t.labelRectConfig},on:{click:t.onStationLabelClick,mousedown:t.onStationLabelMouseDown}})],2):t._e(),t.station.expanded&&t.isBottomLineIntersectingPlotPane?i("v-line",{attrs:{config:t.bottomLineConfig}}):t._e(),t.station.expanded?t._l(t.station.tracks,(function(e){return i("track-group",t._g({key:"track-"+t.station.id+"-"+e.id,attrs:{station:t.station,track:e}},t.$listeners))})):t._e()],2)},$=[],H=(i("a630"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.isLineIntersectingPlotPane?i("v-group",[i("v-line",{attrs:{config:t.lineConfig}}),i("v-text",{attrs:{config:t.labelConfig},on:{click:t.onLabelClick,mousedown:t.onLabelMouseDown}})],1):t._e()}),D=[],z=(i("c740"),function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){var t;return Object(u["a"])(this,i),t=e.apply(this,arguments),t.dragState=null,t}return Object(g["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"lineConfig",get:function(){return{points:[this.viewConfig.stationLabelLeftMargin+this.viewConfig.trackLabelLeftMargin,this.context.getYByRelY(this.track.relY),this.viewState.viewWidth,this.context.getYByRelY(this.track.relY)],stroke:this.viewConfig.trackLineColor,strokeWidth:this.viewConfig.trackLineWidth,listening:!1}}},{key:"labelConfig",get:function(){return{id:"track-label-".concat(this.station.id,"-").concat(this.track.id),x:this.viewConfig.stationLabelLeftMargin+this.viewConfig.trackLabelLeftMargin,y:this.context.getYByRelY(this.track.relY)-this.viewConfig.trackLabelFontSize,width:this.diagram.config.leftPaneWidth-this.viewConfig.stationLabelLeftMargin-this.viewConfig.trackLabelLeftMargin-this.viewConfig.stationLabelRightMargin,height:this.viewConfig.trackLabelFontSize,text:this.track.name,fontSize:this.viewConfig.trackLabelFontSize,fontFamily:this.viewConfig.fontFamily,fill:this.viewConfig.trackLabelColor,align:"left",verticalAlign:"bottom"}}},{key:"isLineIntersectingPlotPane",get:function(){return this.context.getYByRelY(this.track.relY)>=this.viewConfig.topPaneHeight&&this.context.getYByRelY(this.track.relY)<this.viewState.viewHeight}},{key:"onLabelClick",value:function(){var t;!this.viewState.editMode||this.viewState.busy||null!==(t=this.dragState)&&void 0!==t&&t.dragging||(this.viewState.trackNameInputTarget=this.track,this.$emit("trackNameInputStart"))}},{key:"onLabelMouseDown",value:function(t){this.viewState.editMode&&(this.dragState={sy0:t.evt.screenY,index0:this.station.tracks.indexOf(this.track),dragging:!1},window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp))}},{key:"onWindowMouseMove",value:function(t){if(this.dragState&&(Math.abs(t.screenY-this.dragState.sy0)>1&&(this.dragState.dragging=!0),this.dragState.dragging)){this.station.removeTrack(this.track);var e=this.context.getRelYByY(t.clientY),i=this.station.tracks.findIndex((function(t){return e<t.relY}));i<0?this.station.tracks.push(this.track):this.station.tracks.splice(i,0,this.track),this.diagram.updateY()}}},{key:"onWindowMouseUp",value:function(t){var e=this;if(this.dragState){window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp),this.onWindowMouseMove(t);var i=this.dragState.index0,n=this.station.tracks.indexOf(this.track);i!=n&&this.context.history.push({this:this,undo:function(){e.station.removeTrack(e.track),e.station.addNewTrack(e.track,i)},redo:function(){e.station.removeTrack(e.track),e.station.addNewTrack(e.track,n)}}),this.dragState=null}}}]),i}(m["e"]));Object(f["a"])([Object(m["b"])()],z.prototype,"context",void 0),Object(f["a"])([Object(m["c"])()],z.prototype,"station",void 0),Object(f["a"])([Object(m["c"])()],z.prototype,"track",void 0),z=Object(f["a"])([m["a"]],z);var F=z,X=F,J=i("2877"),U=Object(J["a"])(X,H,D,!1,null,"02a069c5",null),G=U.exports,A=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){var t;return Object(u["a"])(this,i),t=e.apply(this,arguments),t.dragState=null,t}return Object(g["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"topLineConfig",get:function(){return{points:[0,this.context.getYByRelY(this.station.topRelY),this.viewState.viewWidth,this.context.getYByRelY(this.station.topRelY)],stroke:this.viewConfig.stationLineColor,strokeWidth:this.viewConfig.stationLineWidth,listening:!1}}},{key:"bottomLineConfig",get:function(){return{points:[0,this.context.getYByRelY(this.station.bottomRelY),this.viewState.viewWidth,this.context.getYByRelY(this.station.bottomRelY)],stroke:this.viewConfig.stationLineColor,strokeWidth:this.viewConfig.stationLineWidth,listening:!1}}},{key:"labelRectConfig",get:function(){return{id:"station-label-".concat(this.station.id),x:this.viewConfig.stationLabelLeftMargin,y:this.context.getYByRelY(this.station.topRelY)-this.viewConfig.stationLabelFontSize,width:this.diagram.config.leftPaneWidth-this.viewConfig.stationLabelLeftMargin-this.viewConfig.stationLabelRightMargin,height:this.viewConfig.stationLabelFontSize}}},{key:"labelCharacters",get:function(){var t=this,e=this.diagram.config.leftPaneWidth-this.viewConfig.stationLabelLeftMargin-this.viewConfig.stationLabelRightMargin-this.viewConfig.stationLabelFontSize,i=this.station.name.length>1?e/(this.station.name.length-1):0;return Array.from(this.station.name).map((function(n,a){return{key:"station-label-".concat(t.station.id,"-").concat(a),x:t.station.name.length>1?t.viewConfig.stationLabelLeftMargin+a*i:t.viewConfig.stationLabelLeftMargin+.5*e,y:t.context.getYByRelY(t.station.topRelY)-t.viewConfig.stationLabelFontSize,height:t.viewConfig.stationLabelFontSize,text:n,fontSize:t.viewConfig.stationLabelFontSize,fontFamily:t.viewConfig.fontFamily,fill:t.viewConfig.stationLabelColor,align:"left",verticalAlign:"bottom"}}))}},{key:"isTopLineIntersectingPlotPane",get:function(){return this.context.getYByRelY(this.station.topRelY)>=this.viewConfig.topPaneHeight&&this.context.getYByRelY(this.station.topRelY)<this.viewState.viewHeight}},{key:"isBottomLineIntersectingPlotPane",get:function(){return this.context.getYByRelY(this.station.bottomRelY)>=this.viewConfig.topPaneHeight&&this.context.getYByRelY(this.station.bottomRelY)<this.viewState.viewHeight}},{key:"onStationLabelClick",value:function(){var t;!this.viewState.editMode||this.viewState.busy||null!==(t=this.dragState)&&void 0!==t&&t.dragging||(this.viewState.stationNameInputTarget=this.station,this.$emit("stationNameInputStart"))}},{key:"onStationLabelMouseDown",value:function(t){this.viewState.editMode&&!this.viewState.inputEnabled&&(this.dragState={sy0:t.evt.screenY,mileage0:this.station.mileage,dragging:!1},window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp))}},{key:"onWindowMouseMove",value:function(t){this.dragState&&(Math.abs(t.screenY-this.dragState.sy0)>1&&(this.dragState.dragging=!0),this.dragState.dragging&&(this.station.mileage=this.dragState.mileage0+(t.screenY-this.dragState.sy0)/this.diagram.config.yScale,this.diagram.updateY()))}},{key:"onWindowMouseUp",value:function(t){var e=this;if(this.dragState){if(window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp),this.onWindowMouseMove(t),this.dragState.dragging){var i=this.dragState.mileage0,n=this.station.mileage;this.context.history.push({this:this,undo:function(){e.station.mileage=i},redo:function(){e.station.mileage=n}})}this.dragState=null}}}]),i}(m["e"]);Object(f["a"])([Object(m["b"])()],A.prototype,"context",void 0),Object(f["a"])([Object(m["c"])()],A.prototype,"station",void 0),A=Object(f["a"])([Object(m["a"])({components:{TrackGroup:G}})],A);var K=A,V=K,q=Object(J["a"])(V,_,$,!1,null,"4dbd1818",null),Q=q.exports,Z=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"timeGridLines",get:function(){var t=[],e=this.diagram.config.scrollX/this.diagram.config.xScale,i=Math.ceil(e/this.viewConfig.minorMinutelyGridLineSpan)*this.viewConfig.minorMinutelyGridLineSpan,n=this.context.getXByTime(i);while(n<this.viewState.viewWidth)t.push({key:"time-grid-line-".concat(t.length),lineConfig:{points:[n,this.viewConfig.topPaneHeight,n,this.viewState.viewHeight],stroke:i%3600==0?this.viewConfig.hourlyGridLineColor:i%this.viewConfig.majorMinutelyGridLineSpan==0?this.viewConfig.majorMinutelyGridLineColor:this.viewConfig.minorMinutelyGridLineColor,strokeWidth:i%3600==0?this.viewConfig.hourlyGridLineWidth:i%this.viewConfig.majorMinutelyGridLineSpan==0?this.viewConfig.majorMinutelyGridLineWidth:this.viewConfig.minorMinutelyGridLineWidth,listening:!1},labelConfig:i%3600!=0?null:{x:n-this.viewConfig.hourlyLabelFontSize,y:this.viewConfig.topPaneHeight-this.viewConfig.hourlyLabelBottomMargin-this.viewConfig.hourlyLabelFontSize,width:2*this.viewConfig.hourlyLabelFontSize,height:this.viewConfig.hourlyLabelFontSize,text:"".concat(i/3600%24),fontSize:this.viewConfig.hourlyLabelFontSize,fontFamily:this.viewConfig.fontFamily,fill:this.viewConfig.hourlyLabelColor,align:"center",verticalAlign:"bottom"}}),i+=this.viewConfig.minorMinutelyGridLineSpan,n=this.context.getXByTime(i);return t}}]),i}(m["e"]);Object(f["a"])([Object(m["b"])()],Z.prototype,"context",void 0),Z=Object(f["a"])([Object(m["a"])({components:{StationGroup:Q}})],Z);var tt=Z,et=tt,it=Object(J["a"])(et,B,W,!1,null,"c5c3815c",null),nt=it.exports,at=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.pointerEnabled?i("v-group",[i("v-rect",{attrs:{config:t.rectConfig}}),i("v-text",{attrs:{config:t.labelConfig}})],1):t._e()},ot=[];i("4d90");function rt(t,e){var i="".concat(Math.floor(t/3600)),n="".concat(Math.floor(t/60)%60).padStart(2,"0"),a="".concat(t%60).padStart(2,"0");return t%60!=0||e?"".concat(i,":").concat(n,":").concat(a):"".concat(i,":").concat(n)}var st=document.createElement("canvas"),ct=st.getContext("2d");function lt(t,e,i){return ct?(ct.font="".concat(i,"px ").concat(e),ct.measureText(t).width):0}var ht=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"pointerEnabled",get:function(){return this.viewState.pointerTargetLine&&!this.viewState.pointerTargetTrainPath&&!this.viewState.trainPathDragState&&!this.viewState.drawingState}},{key:"rectConfig",get:function(){var t=this.viewState.drawingState?this.viewConfig.selectedTrainPathMarkerWidth:this.viewConfig.pointerWidth;return{x:this.context.getXByTime(this.viewState.pointerTime)-.5*t,y:this.viewState.pointerY-.5*t,width:t,height:t,fill:this.viewConfig.pointerColor,listening:!1}}},{key:"labelConfig",get:function(){var t=this.viewState.pointerTime>=0?this.viewState.pointerTime:this.viewState.pointerTime+3600*Math.ceil(-this.viewState.pointerTime/3600);return{x:this.context.getXByTime(this.viewState.pointerTime),y:this.viewState.pointerY-this.viewConfig.pointerLabelFontSize,height:this.viewConfig.pointerLabelFontSize,text:rt(t,null!=this.viewState.pointerPreciseState),fontSize:this.viewConfig.pointerLabelFontSize,fontFamily:this.viewConfig.fontFamily,fill:this.viewConfig.pointerColor,align:"left",verticalAlign:"bottom",listening:!1}}}]),i}(m["e"]);Object(f["a"])([Object(m["b"])()],ht.prototype,"context",void 0),ht=Object(f["a"])([m["a"]],ht);var ut=ht,gt=ut,dt=Object(J["a"])(gt,at,ot,!1,null,"15f49962",null),vt=dt.exports,ft=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-layer",{ref:"trainPathLayer",attrs:{id:"train-path-layer",config:t.layerConfig}},[t._l(Object.values(t.diagram.trains).filter((function(e){return!t.viewState.trainSelections[e.id]})),(function(e){return i("train-path-group",t._g({key:"train-"+e.id,attrs:{train:e}},t.$listeners))})),t._l(Object.values(t.diagram.trains).filter((function(e){return t.viewState.trainSelections[e.id]})),(function(e){return i("train-path-group",t._g({key:"train-"+e.id,attrs:{train:e}},t.$listeners))}))],2)},mt=[],pt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-group",[i("v-text",{ref:"trainNameLabel",attrs:{config:t.trainNameLabelConfig},on:{click:t.onTrainNameLabelClick}}),i("v-line",{attrs:{config:t.regularTrainPathConfig},on:{click:t.onTrainPathClick,mousemove:t.onTrainPathMouseMove,tap:t.onTrainPathTap}}),t.selectedTrainPathEnabled?[i("v-line",{attrs:{config:t.selectedTrainPathConfig},on:{click:t.onSelectedTrainPathClick,dblclick:t.onSelectedTrainPathDoubleClick,mousedown:t.onSelectedTrainPathMouseDown,mousemove:t.onSelectedTrainPathMouseMove}}),t._l(t.selectedTrainPathNodes,(function(e){return i("train-path-marker",{key:"marker-"+t.train.id+"-"+e.stev.privateId+"-"+e.phase,attrs:{trainPathNode:e},on:{click:t.onMarkerClick,mousedown:t.onMarkerMouseDown}})}))]:t._e()],2)},St=[],bt=i("5530"),wt=(i("fb6a"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-group",[i("v-rect",{attrs:{config:t.rectConfig},on:{click:function(e){return t.$emit("click",e,t.trainPathNode)},mousemove:t.onRectMouseMove,mousedown:function(e){return t.$emit("mousedown",e,t.trainPathNode)},dblclick:t.onRectDoubleClick}}),t.labelEnabled?i("v-text",{attrs:{config:t.labelConfig}}):t._e()],1)}),yt=[],kt=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"rectConfig",get:function(){return{x:this.context.getXByTime(this.trainPathNode.time)-.5*this.viewConfig.selectedTrainPathMarkerWidth,y:this.context.getYByRelY(this.trainPathNode.relY)-.5*this.viewConfig.selectedTrainPathMarkerWidth,width:this.viewConfig.selectedTrainPathMarkerWidth,height:this.viewConfig.selectedTrainPathMarkerWidth,fill:this.viewConfig.selectedTrainPathMarkerColor}}},{key:"labelEnabled",get:function(){return"track"==this.trainPathNode.phase}},{key:"labelConfig",get:function(){var t=this.getLabelPosition();return{x:this.context.getXByTime(this.trainPathNode.time)+t.x-8*this.viewConfig.markerLabelFontSize,y:this.context.getYByRelY(this.trainPathNode.relY)+t.y-this.viewConfig.markerLabelLineHeight,width:8*this.viewConfig.markerLabelFontSize,height:this.viewConfig.markerLabelLineHeight,text:rt(this.trainPathNode.time,null!=this.viewState.pointerPreciseState),fontSize:this.viewConfig.pointerLabelFontSize,fontFamily:this.viewConfig.fontFamily,fill:this.viewConfig.markerLabelColor,align:"right",verticalAlign:"bottom",listening:!1}}},{key:"getLabelPosition",value:function(){var t=this.trainPathNode.stev,e=t.prev,i=t.next;if(e&&e.track!=t.track&&(!i||i.track==t.track)){var n=e.station.mileage<t.station.mileage?t.station.topRelY:t.station.bottomRelY,a=e.station.mileage<t.station.mileage?e.station.bottomRelY:e.station.topRelY,o=n==a?0:-this.viewConfig.markerLabelLineHeight*((t.time-e.time)*this.diagram.config.xScale)/Math.abs(n-a);return{x:Math.max(o,-this.viewConfig.markerLabelMaxDistance),y:e.station.mileage<t.station.mileage?0:this.viewConfig.markerLabelLineHeight}}return{x:0,y:i&&i.station.mileage<t.station.mileage||e&&e.station.mileage>t.station.mileage?0:this.viewConfig.markerLabelLineHeight}}},{key:"onRectMouseMove",value:function(){this.viewState.pointerTargetTrainPath={train:this.trainPathNode.stev.train,stevRange:{from:this.trainPathNode.stev,to:this.trainPathNode.stev}}}},{key:"onRectDoubleClick",value:function(){if(this.viewState.editMode)if(this.viewState.drawingState)this.viewState.drawingState=null,this.viewState.trainSelections={};else{var t=this.trainPathNode;t.stev.next&&t.stev.prev||(this.viewState.drawingState={train:t.stev.train,lastStev:t.stev,direction:t.stev.next||t.stev.prev?t.stev.next?-1:1:0,stableEnd:t.stev,floating:null},this.viewState.trainSelections[t.stev.train.id].stevRange=null)}}}]),i}(m["e"]);Object(f["a"])([Object(m["b"])()],kt.prototype,"context",void 0),Object(f["a"])([Object(m["c"])()],kt.prototype,"trainPathNode",void 0),kt=Object(f["a"])([m["a"]],kt);var xt=kt,Ct=xt,Tt=Object(J["a"])(Ct,wt,yt,!1,null,"44b2c434",null),Ot=Tt.exports,jt=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){var t;return Object(u["a"])(this,i),t=e.apply(this,arguments),t.dragState=null,t}return Object(g["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"trainNameLabelConfig",get:function(){var t=this.viewState.trainSelections[this.train.id];return Object(bt["a"])(Object(bt["a"])({ref:"train-name-label-".concat(this.train.id),visible:!this.viewState.trainInfoEditorTarget&&(0==Object.keys(this.viewState.trainSelections).length||!!t&&!this.viewState.controlKeyPressed),text:this.trainNameLabelText},this.trainNameLabelRect),{},{fontSize:this.viewConfig.trainNameLabelFontSize,fontFamily:this.viewConfig.fontFamily,fill:t&&!t.stevRange?this.viewConfig.selectedTrainPathColor:this.viewConfig.trainPathColor})}},{key:"trainNameLabelText",get:function(){return""!=this.train.name?this.train.name:"#".concat(this.train.id)}},{key:"trainNameLabelRect",get:function(){var t,e,i,n=this.trainNameLabelText,a=lt(n,this.viewConfig.fontFamily,this.viewConfig.trainNameLabelFontSize),o=null!==(t=this.viewState.trainPathDragState)&&void 0!==t&&t.targets[this.train.id]&&this.viewState.controlKeyPressed?this.selectedTrainPathNodes:this.regularTrainPathNodes,r=null!==(e=o.find((function(t,e){return e<o.length-1&&o[e+1].stev.station!=t.stev.station})))&&void 0!==e?e:o[0],s=NaN,c=Object(b["a"])(o.slice(o.indexOf(r)+1));try{for(c.s();!(i=c.n()).done;){var l=i.value,h=l.x-r.x,u=l.y-r.y,g=0!=h?u/h:Math.sign(u)*(1/0);if((isNaN(s)||Math.sign(g)==Math.sign(s)&&Math.abs(g)<Math.abs(s))&&(s=g),Math.hypot(h,u)>=a)break}}catch(S){c.e(S)}finally{c.f()}if(isNaN(s))return{x:r.x,y:r.y,rotation:0,width:a,height:this.viewConfig.trainNameLabelFontSize};var d=Math.sqrt(1/(1+s*s)),v=0!=d?d*s:1,f=s>=0?v*this.viewConfig.trainNameLabelFontSize+r.x:-v*(this.viewConfig.trainNameLabelLineHeight-this.viewConfig.trainNameLabelFontSize)+r.x,m=s>=0?-d*this.viewConfig.trainNameLabelFontSize+r.y:d*(this.viewConfig.trainNameLabelLineHeight-this.viewConfig.trainNameLabelFontSize)+r.y,p=Math.atan(s)/Math.PI*180;return{x:f,y:m,rotation:p,width:a,height:this.viewConfig.trainNameLabelFontSize}}},{key:"regularTrainPathConfig",get:function(){return{points:this.regularTrainPathNodes.flatMap((function(t){return[t.x,t.y]})),stroke:this.viewConfig.trainPathColor,opacity:Object.keys(this.viewState.trainSelections).length>0?this.viewConfig.unselectedTrainPathOpacity:1,strokeWidth:this.viewConfig.trainPathWidth,hitStrokeWidth:Math.max(this.viewConfig.trainPathWidth,2*this.viewConfig.minHitWidth)}}},{key:"regularTrainPathNodes",get:function(){var t=this.getTrainPathNodes(),e=this.viewState.trainPathDragState,i=null===e||void 0===e?void 0:e.targets[this.train.id];if(e&&i&&!this.viewState.controlKeyPressed){var n,a=!i.stevRange,o=Object(b["a"])(t);try{for(o.s();!(n=o.n()).done;){var r,s,c,l=n.value;l.stev!=(null===(r=i.stevRange)||void 0===r?void 0:r.from)&&l.stev!=(null===(s=i.stevRange)||void 0===s?void 0:s.to)||(a=!0),a&&(l.time+=e.timeShift,l.x=this.context.getXByTime(l.time)),l.stev==(null===(c=i.stevRange)||void 0===c?void 0:c.to)&&(a=!1)}}catch(h){o.e(h)}finally{o.f()}}return t}},{key:"selectedTrainPathEnabled",get:function(){return null!=this.viewState.trainSelections[this.train.id]}},{key:"selectedTrainPathConfig",get:function(){return{points:this.selectedTrainPathNodes.flatMap((function(t){return[t.x,t.y]})),stroke:this.viewConfig.selectedTrainPathColor,strokeWidth:this.viewConfig.trainPathWidth*this.viewConfig.selectedTrainPathWidthScale,hitStrokeWidth:Math.max(this.viewConfig.trainPathWidth*this.viewConfig.selectedTrainPathWidthScale,2*this.viewConfig.minHitWidth)}}},{key:"selectedTrainPathNodes",get:function(){var t,e,i,n=null!==(t=null===(e=this.viewState.trainPathDragState)||void 0===e||null===(i=e.targets[this.train.id])||void 0===i?void 0:i.stevRange)&&void 0!==t?t:this.viewState.trainSelections[this.train.id].stevRange,a=!n,o=this.getTrainPathNodes().filter((function(t){t.stev!=(null===n||void 0===n?void 0:n.from)&&t.stev!=(null===n||void 0===n?void 0:n.to)||(a=!0);var e=a;return t.stev==(null===n||void 0===n?void 0:n.to)&&(a=!1),e}));if(this.viewState.trainPathDragState){var r,s=Object(b["a"])(o);try{for(s.s();!(r=s.n()).done;){var c=r.value;c.time+=this.viewState.trainPathDragState.timeShift,c.x=this.context.getXByTime(c.time)}}catch(l){s.e(l)}finally{s.f()}}return o}},{key:"getTrainPathNodes",value:function(){var t=this;return this.train.getTrainPathNodes().map((function(e){return Object(bt["a"])(Object(bt["a"])({},e),{},{x:t.context.getXByTime(e.time),y:t.context.getYByRelY(e.relY)})}))}},{key:"onTrainNameLabelClick",value:function(t){t.target==t.currentTarget&&(this.viewState.editMode&&this.viewState.trainSelections[this.train.id]&&!this.viewState.trainSelections[this.train.id].stevRange?(this.viewState.trainInfoEditorTarget={train:this.train,x:this.trainNameLabelRect.x,y:this.trainNameLabelRect.y,verticalAlign:this.trainNameLabelRect.rotation>=0?"top":"bottom"},this.$emit("trainInfoEditStart")):(t.evt.shiftKey||(this.viewState.trainSelections={}),this.$set(this.viewState.trainSelections,this.train.id,{train:this.train,stevRange:null})))}},{key:"onTrainPathMouseMove",value:function(){this.viewState.pointerTargetTrainPath=null}},{key:"onSelectedTrainPathMouseMove",value:function(t){this.viewState.pointerTargetTrainPath={train:this.train,stevRange:this.getPointedStevRange(t.evt.clientX,t.evt.clientY)}}},{key:"onTrainPathClick",value:function(t){var e=this.getPointedStevRange(t.evt.clientX,t.evt.clientY);this.changeTrainSelections(t,e,!1)}},{key:"onSelectedTrainPathClick",value:function(t){var e=this.getPointedStevRange(t.evt.clientX,t.evt.clientY);this.changeTrainSelections(t,e,!0)}},{key:"onMarkerClick",value:function(t,e){var i={from:e.stev,to:e.stev};this.changeTrainSelections(t,i,!0)}},{key:"changeTrainSelections",value:function(t,e,i){var n;if((null===(n=this.viewState.trainPathDragState)||void 0===n||!n.dragging)&&!this.viewState.drawingState){var a=this.viewState.trainSelections[this.train.id];if(t.evt.shiftKey||(this.viewState.trainSelections=a?Object(R["a"])({},this.train.id,a):{}),a){var o=a.stevRange;if(o)if(t.evt.shiftKey){var r,s=!1,c=!1,l=!1,h=Object(b["a"])(this.train.stevs);try{for(h.s();!(r=h.n()).done;){var u=r.value;s||u!=e.from||(o.from=e.from,l=!0),u==o.from&&(s=!0),u==o.to&&(c=!0),c&&u==e.to&&(o.to=e.to,l=!0)}}catch(g){h.e(g)}finally{h.f()}l||this.$delete(this.viewState.trainSelections,this.train.id)}else a.stevRange=i?e:null;else a.stevRange=e}else this.$set(this.viewState.trainSelections,this.train.id,{train:this.train,stevRange:null})}}},{key:"onTrainPathTap",value:function(){this.viewState.trainSelections=Object(R["a"])({},this.train.id,{train:this.train,stevRange:null})}},{key:"getPointedStevRange",value:function(t,e){if(this.train.stevs.length<=2)return{from:this.train.stevs[0],to:this.train.stevs[this.train.stevs.length-1]};for(var i=0;i<this.train.stevs.length-1;++i){var n=this.train.stevs[i],a=this.train.stevs[i+1],o=this.context.getXByTime(n.time)-this.viewConfig.minHitWidth,r=this.context.getXByTime(a.time)+this.viewConfig.minHitWidth,s=this.context.getYByRelY(Math.min(n.track.relY,a.track.relY))-this.viewConfig.minHitWidth,c=this.context.getYByRelY(Math.max(n.track.relY,a.track.relY))+this.viewConfig.minHitWidth;if(o<t&&t<r&&s<e&&e<c)return{from:n,to:a}}return{from:this.train.stevs[0],to:this.train.stevs[this.train.stevs.length-1]}}},{key:"onSelectedTrainPathDoubleClick",value:function(t){if(this.viewState.editMode&&!this.viewState.drawingState){var e,i,n=this.viewState.pointerTime,a=this.getNearestStation(t.evt.clientY),o=this.getNearestStopEvent(n);if(a!=o.station||(null===(e=o.prev)||void 0===e?void 0:e.track)!=o.track&&(null===(i=o.next)||void 0===i?void 0:i.track)!=o.track){var r=this.train.stevs.findIndex((function(t){return t.time>n})),s=this.train.addNewStopEvent(new x(this.train,a.tracks[0],n),r);this.viewState.trainSelections=Object(R["a"])({},this.train.id,{train:this.train,stevRange:{from:s,to:s}})}}}},{key:"getNearestStation",value:function(t){var e,i=this.diagram.getStationsInMileageOrder(),n=this.context.getRelYByY(t),a=i[0],o=Math.abs(n-a.bottomRelY),r=Object(b["a"])(i);try{for(r.s();!(e=r.n()).done;){var s=e.value;Math.abs(n-s.topRelY)<o&&(a=s,o=Math.abs(n-s.topRelY)),Math.abs(n-s.bottomRelY)<o&&(a=s,o=Math.abs(n-s.bottomRelY))}}catch(c){r.e(c)}finally{r.f()}return a}},{key:"getNearestStopEvent",value:function(t){var e,i=this.train.stevs[0],n=Math.abs(t-i.time),a=Object(b["a"])(this.train.stevs);try{for(a.s();!(e=a.n()).done;){var o=e.value;Math.abs(t-o.time)<n&&(i=o,n=Math.abs(t-o.time))}}catch(r){a.e(r)}finally{a.f()}return i}},{key:"onSelectedTrainPathMouseDown",value:function(t){if(this.viewState.editMode){for(var e=-86400,i=86400,n=0,a=Object.values(this.viewState.trainSelections);n<a.length;n++){var o=a[n],r=o.stevRange;r&&(r.from.prev&&(e=Math.max(e,r.from.prev.time-r.from.time)),r.to.next&&(i=Math.min(i,r.to.next.time-r.to.time)))}var s=this.getPointedStevRange(t.evt.clientX,t.evt.clientY),c=s.from==s.to?[s.from]:s.from.track==s.to.track?[s.from,s.to]:null,l=this.selectedTrainPathNodes[0];this.dragState={t0:l.time,y0:this.context.getYByRelY(l.relY),sx0:t.evt.screenX,sy0:t.evt.screenY,track0:c?c[0].track:null,minTimeShift:e,maxTimeShift:i,changeTimeTargets:null,changeTrackTargets:null!==c&&void 0!==c?c:null},this.viewState.trainPathDragState={dragging:!1,targets:this.viewState.trainSelections,timeShift:0},window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp)}}},{key:"onMarkerMouseDown",value:function(t,e){this.viewState.editMode&&(this.dragState={t0:e.time,y0:this.context.getYByRelY(e.relY),track0:e.stev.track,sx0:t.evt.screenX,sy0:t.evt.screenY,minTimeShift:e.stev.prev?e.stev.prev.time-e.time:-86400,maxTimeShift:e.stev.next?e.stev.next.time-e.time:86400,changeTimeTargets:[e.stev],changeTrackTargets:[e.stev]},this.viewState.trainPathDragState={dragging:!1,targets:Object(R["a"])({},e.stev.train.id,{train:e.stev.train,stevRange:{from:e.stev,to:e.stev}}),timeShift:0},window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp))}},{key:"onWindowMouseMove",value:function(t){var e=this;if(this.dragState&&this.viewState.trainPathDragState&&(!this.viewState.trainPathDragState.dragging&&Math.hypot(t.clientX-this.dragState.sx0,t.clientY-this.dragState.sy0)>1&&(this.viewState.trainPathDragState.dragging=!0,this.viewState.pointerY=this.dragState.y0),this.viewState.trainPathDragState.dragging&&(this.viewState.pointerPreciseState||(this.viewState.pointerTime=this.dragState.t0+60*Math.floor((t.screenX-this.dragState.sx0)/this.diagram.config.xScale/60)),this.viewState.trainPathDragState.timeShift=this.viewState.controlKeyPressed?this.viewState.pointerTime-this.dragState.t0:Math.min(this.dragState.maxTimeShift,Math.max(this.dragState.minTimeShift,this.viewState.pointerTime-this.dragState.t0)),this.dragState.changeTrackTargets))){var i=this.context.getRelYByY(t.clientY),n=this.dragState.changeTrackTargets[0].station,a=n.tracks.find((function(t){return Math.abs(t.relY-i)<e.viewConfig.minHitWidth}));if(a){var o,r=Object(b["a"])(this.dragState.changeTrackTargets);try{for(r.s();!(o=r.n()).done;){var s=o.value;s.track=a}}catch(c){r.e(c)}finally{r.f()}}}}},{key:"onWindowMouseUp",value:function(){var t=this;if(this.dragState&&this.viewState.trainPathDragState){if(window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp),this.viewState.trainPathDragState.dragging){if(this.dragState.changeTrackTargets&&this.dragState.track0){var e=this.dragState.changeTrackTargets,i=this.dragState.track0,n=this.dragState.changeTrackTargets[0].track;i!=n&&this.context.history.push({this:this,undo:function(){e.forEach((function(t){return t.track=i}))},redo:function(){e.forEach((function(t){return t.track=n}))}})}var a=this.viewState.trainPathDragState.timeShift;if(0!=a)if(this.viewState.controlKeyPressed){var o=Object.values(this.viewState.trainPathDragState.targets).map((function(e){var i,n=e.train,o=e.stevRange?n.getStopEventsInRange(e.stevRange):n.stevs,r=t.diagram.addNewTrain(new C(t.diagram.genId(),"")),s=Object(b["a"])(o);try{for(s.s();!(i=s.n()).done;){var c=i.value;r.addNewStopEvent(new x(r,c.track,c.time+a))}}catch(l){s.e(l)}finally{s.f()}return t.$delete(t.viewState.trainSelections,e.train.id),t.$set(t.viewState.trainSelections,r.id,{train:r,stevRange:null}),r}));this.context.history.push({this:this,undo:function(){o.forEach((function(e){return t.diagram.removeTrain(e)}))},redo:function(){o.forEach((function(e){return t.diagram.addNewTrain(e)}))}})}else{var r,s=null!==(r=this.dragState.changeTimeTargets)&&void 0!==r?r:Object.values(this.viewState.trainSelections).flatMap((function(t){return t.stevRange?t.train.getStopEventsInRange(t.stevRange):t.train.stevs}));s.forEach((function(t){return t.time+=a})),this.context.history.push({this:this,undo:function(){s.forEach((function(t){return t.time-=a}))},redo:function(){s.forEach((function(t){return t.time+=a}))}})}}this.viewState.trainPathDragState=null,this.dragState=null}}}]),i}(m["e"]);Object(f["a"])([Object(m["b"])()],jt.prototype,"context",void 0),Object(f["a"])([Object(m["c"])()],jt.prototype,"train",void 0),jt=Object(f["a"])([Object(m["a"])({components:{TrainPathMarker:Ot}})],jt);var Lt=jt,Pt=Lt,Mt=Object(J["a"])(Pt,pt,St,!1,null,"7a0c5cc7",null),Yt=Mt.exports,Nt=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"layerConfig",get:function(){return{clip:{x:this.diagram.config.leftPaneWidth,y:this.viewConfig.topPaneHeight,width:this.viewState.viewWidth-this.diagram.config.leftPaneWidth,height:this.viewState.viewHeight-this.viewConfig.topPaneHeight}}}}]),i}(m["e"]);Object(f["a"])([Object(m["b"])()],Nt.prototype,"context",void 0),Nt=Object(f["a"])([Object(m["a"])({components:{TrainPathGroup:Yt}})],Nt);var Rt=Nt,Et=Rt,It=Object(J["a"])(Et,ft,mt,!1,null,"7e6e656e",null),Bt=It.exports,Wt=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){var t;return Object(u["a"])(this,i),t=e.apply(this,arguments),t.stageDragState=null,t.pinchState=null,t}return Object(g["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"stageConfig",get:function(){return{width:this.viewState.viewWidth,height:this.viewState.viewHeight}}},{key:"stationsInMileageOrder",get:function(){return this.diagram.getStationsInMileageOrder()}},{key:"mounted",value:function(){window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp);var t=new I.a(this.$el);t.get("pan").set({direction:I.a.DIRECTION_ALL}),t.get("pinch").set({enable:!0}),t.on("panstart",this.onPanStart),t.on("panmove",this.onPanMove),t.on("panend",this.onPanEnd),t.on("pinchstart",this.onPinchStart),t.on("pinchmove",this.onPinchMove),t.on("pinchend",this.onPinchEnd)}},{key:"unmounted",value:function(){window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp)}},{key:"onStageMouseMove",value:function(t){var e,i=t.evt;if(this.viewState.pointerScreenX=i.screenX,this.viewState.pointerPreciseState){var n=Math.round((i.screenX-this.viewState.pointerPreciseState.sx0)/this.viewConfig.pointerPrecisePixelPerTimeUnit);this.viewState.pointerTime=n*this.diagram.config.minimumTimeUnit+this.viewState.pointerPreciseState.t0}else if(null===(e=this.viewState.trainPathDragState)||void 0===e||!e.dragging)if(this.viewState.pointerTime=60*Math.round(this.context.getTimeByX(i.clientX)/60),i.clientX>=this.diagram.config.leftPaneWidth){var a=this.findPointerTargetLine(i.clientY);a?(this.viewState.pointerTargetLine=null!==a&&void 0!==a?a:null,this.viewState.pointerY=this.context.getYByRelY(a.relY)):this.viewState.pointerTargetLine=null}else this.viewState.pointerTargetLine=null;t.target==t.currentTarget&&(this.viewState.pointerTargetTrainPath=null);var o=this.viewState.drawingState;if(o){o.direction>0?this.viewState.pointerTime=Math.max(this.viewState.pointerTime,o.lastStev.time):o.direction<0&&(this.viewState.pointerTime=Math.min(this.viewState.pointerTime,o.lastStev.time)),o.floating&&(o.train.removeStopEvent(o.floating),o.floating=null);var r=i.clientX>=this.diagram.config.leftPaneWidth?this.findPointerTargetLine(i.clientY):void 0;if(r){var s,c=null!==(s=r.track)&&void 0!==s?s:r.station.tracks[0],l=o.train.addNewStopEvent(new x(o.train,c,this.viewState.pointerTime),o.direction>0||0==o.direction&&this.viewState.pointerTime>=o.lastStev.time?void 0:0);o.floating=l}}}},{key:"findPointerTargetLine",value:function(t){var e=this,i=this.stationsInMileageOrder.find((function(i){return Math.abs(e.context.getYByRelY(i.topRelY)-t)<Math.max(.5*e.viewConfig.stationLineWidth,e.viewConfig.minHitWidth)}));if(i)return{station:i,track:null,relY:i.topRelY};var n=this.stationsInMileageOrder.find((function(i){return Math.abs(e.context.getYByRelY(i.bottomRelY)-t)<Math.max(.5*e.viewConfig.stationLineWidth,e.viewConfig.minHitWidth)}));if(n)return{station:n,track:null,relY:n.bottomRelY};var a=this.stationsInMileageOrder.find((function(i){return e.context.getYByRelY(i.topRelY)+e.diagram.config.trackLineSpan-Math.max(.5*e.viewConfig.trackLineWidth,e.viewConfig.minHitWidth)<t&&e.context.getYByRelY(i.bottomRelY)-e.diagram.config.trackLineSpan+Math.max(.5*e.viewConfig.trackLineWidth,e.viewConfig.minHitWidth)>t}));if(a){var o=a.tracks.find((function(i){return Math.abs(e.context.getYByRelY(i.relY)-t)<Math.max(.5*e.viewConfig.trackLineWidth,e.viewConfig.minHitWidth)}));if(o)return{station:a,track:o,relY:o.relY}}}},{key:"onStageClick",value:function(t){var e,i,n,a=this.viewState.drawingState;if(a){if(0==t.evt.button&&this.viewState.pointerTargetLine&&(0==a.direction&&(a.direction=this.viewState.pointerTime>=a.lastStev.time?1:-1),a.floating)){var o,r,s=a.floating.track==a.lastStev.track&&(a.direction>0&&a.lastStev.track==(null===(o=a.lastStev.prev)||void 0===o?void 0:o.track)||a.direction<0&&a.lastStev.track==(null===(r=a.lastStev.next)||void 0===r?void 0:r.track));s?(a.lastStev.time=this.viewState.pointerTime,a.train.removeStopEvent(a.floating)):a.lastStev=a.floating,a.floating=null}if(2==t.evt.button)if(a.lastStev==a.stableEnd)a.floating&&a.train.removeStopEvent(a.floating),this.viewState.drawingState=null;else{var c=a.direction>0?a.lastStev.prev:a.lastStev.next;c?(a.train.removeStopEvent(a.lastStev),a.lastStev=c):(this.$delete(this.diagram.trains,a.train.id),this.viewState.drawingState=null)}}t.target!=t.currentTarget||t.evt.ctrlKey||t.evt.shiftKey||null!==(e=this.stageDragState)&&void 0!==e&&e.dragging||null!==(i=this.viewState.trainPathDragState)&&void 0!==i&&i.dragging||this.viewState.drawingState||(this.viewState.trainSelections={}),!this.viewState.trainInfoEditorTarget||null!==(n=t.target.attrs.ref)&&void 0!==n&&n.startsWith("train-name-label")||this.$emit("trainInfoEditEnd")}},{key:"onTouchEnd",value:function(t){var e;t.target!=t.currentTarget||null!==(e=this.stageDragState)&&void 0!==e&&e.dragging||(this.viewState.trainSelections={}),this.stageDragState&&(this.stageDragState=null)}},{key:"onStageDoubleClick",value:function(t){var e=this;if(t.target==t.currentTarget&&this.viewState.drawingState){var i=this.viewState.drawingState;if(i.floating&&i.train.removeStopEvent(i.floating),i.train.stevs.length<=1)this.$delete(this.diagram.trains,i.train.id);else{var n=i.stableEnd;if(n){var a=i.train.stevs.indexOf(n),o=i.direction>0?i.train.stevs.filter((function(t,e){return e>a})):i.train.stevs.filter((function(t,e){return e<a}));i.direction>0?this.context.history.push({this:this,undo:function(){i.train.stevs.splice(a+1)},redo:function(){o.forEach((function(t){return i.train.stevs.push(t)}))}}):this.context.history.push({this:this,undo:function(){i.train.stevs.splice(0,a)},redo:function(){i.train.stevs=o.concat(i.train.stevs)}})}else this.context.history.push({this:this,undo:function(){e.$delete(e.diagram.trains,i.train.id)},redo:function(){e.$set(e.diagram.trains,i.train.id,i.train)}})}this.viewState.drawingState=null,this.viewState.trainSelections={}}else if(t.target==t.currentTarget&&this.viewState.editMode)if(t.evt.clientX>=this.diagram.config.leftPaneWidth){var r=this.viewState.pointerTargetLine;if(r&&(r.track||!r.station.expanded)){var s,c=null!==(s=r.track)&&void 0!==s?s:r.station.tracks[0],l=this.diagram.addNewTrain(new C(this.diagram.genId(),""));l.addNewStopEvent(new x(l,c,this.viewState.pointerTime)),this.viewState.trainSelections=Object(R["a"])({},l.id,{train:l,stevRange:null}),this.viewState.drawingState={train:this.diagram.trains[l.id],lastStev:this.diagram.trains[l.id].stevs[0],direction:0,stableEnd:null,floating:null}}}else{var h=this.context.getRelYByY(t.evt.clientY),u=this.stationsInMileageOrder.reverse().find((function(t){return t.topRelY<h})),g=u?(h-u.bottomRelY)/this.diagram.config.yScale+u.mileage:h/this.diagram.config.yScale,d=k.fromJSON({id:this.diagram.genId(),name:"",mileage:g,tracks:[{id:this.diagram.genId(),name:""}]});this.$set(this.diagram.stations,d.id,d),this.diagram.updateY(),this.context.history.push({this:this,undo:function(){e.$delete(e.diagram.stations,d.id),e.diagram.updateY()},redo:function(){e.$set(e.diagram.stations,d.id,d),e.diagram.updateY()}}),this.viewState.stationNameInputTarget=d,this.$emit("stationNameInputStart")}}},{key:"onStageMouseDown",value:function(t){t.target==t.currentTarget&&this.startDrag(t.evt.screenX,t.evt.screenY)}},{key:"onWindowMouseMove",value:function(t){this.moveDrag(t.screenX,t.screenY)}},{key:"onWindowMouseUp",value:function(t){this.stageDragState&&(this.moveDrag(t.screenX,t.screenY),this.stageDragState=null)}},{key:"onPanStart",value:function(t){"mouse"!=t.pointerType&&this.startDrag(t.center.x,t.center.y)}},{key:"onPanMove",value:function(t){"mouse"!=t.pointerType&&this.moveDrag(t.center.x,t.center.y)}},{key:"onPanEnd",value:function(t){"mouse"!=t.pointerType&&this.stageDragState&&this.moveDrag(t.center.x,t.center.y)}},{key:"startDrag",value:function(t,e){this.viewState.pointerPreciseState||(this.stageDragState={scrollX0:this.diagram.config.scrollX,scrollY0:this.diagram.config.scrollY,x0:t,y0:e,dragging:!1})}},{key:"moveDrag",value:function(t,e){this.stageDragState&&(Math.hypot(t-this.stageDragState.x0,e-this.stageDragState.y0)>1&&(this.stageDragState.dragging=!0),this.stageDragState.dragging&&(this.diagram.config.scrollX=Math.max(this.diagram.config.minPlotTime*this.diagram.config.xScale-this.viewConfig.plotPanePadding,Math.min(this.diagram.config.maxPlotTime*this.diagram.config.xScale-(this.viewState.viewWidth-this.diagram.config.leftPaneWidth-this.viewConfig.plotPanePadding),this.stageDragState.scrollX0-(t-this.stageDragState.x0))),this.diagram.config.scrollY=Math.max(0,Math.min(this.diagram.maxRelY-(this.viewState.viewHeight-this.viewConfig.plotPanePadding-this.viewConfig.topPaneHeight-this.diagram.config.trackLineSpan),this.stageDragState.scrollY0-(e-this.stageDragState.y0)))))}},{key:"onStageMouseWheel",value:function(t){var e=Math.pow(2,-Math.sign(t.evt.deltaY)*this.viewConfig.wheelScale);this.diagram.config.scrollX+=(e-1)*(t.evt.clientX-this.diagram.config.leftPaneWidth+this.diagram.config.scrollX),this.diagram.config.scrollY=Math.max(0,Math.min(this.diagram.maxRelY+this.viewConfig.topPaneHeight-this.viewState.viewHeight,this.diagram.config.scrollY+(e-1)*(t.evt.clientY-this.viewConfig.topPaneHeight+this.diagram.config.scrollY))),this.diagram.config.xScale*=e,this.diagram.config.yScale*=e,this.diagram.updateY(),t.evt.preventDefault()}},{key:"onPinchStart",value:function(t){this.pinchState={lastScale:t.scale}}},{key:"onPinchMove",value:function(t){this.pinchState&&(this.diagram.config.scrollX+=(t.scale/this.pinchState.lastScale-1)*(t.center.x-this.diagram.config.leftPaneWidth+this.diagram.config.scrollX),this.diagram.config.scrollY=Math.max(0,Math.min(this.diagram.maxRelY+this.viewConfig.topPaneHeight-this.viewState.viewHeight,this.diagram.config.scrollY+(t.scale/this.pinchState.lastScale-1)*(t.center.y-this.viewConfig.topPaneHeight+this.diagram.config.scrollY))),this.diagram.config.xScale*=t.scale/this.pinchState.lastScale,this.diagram.config.yScale*=t.scale/this.pinchState.lastScale,this.pinchState.lastScale=t.scale,this.diagram.updateY())}},{key:"onPinchEnd",value:function(t){this.pinchState&&(this.onPinchMove(t),this.pinchState=null)}},{key:"onKeyDown",value:function(t){var e=this;if(!t.repeat&&("Alt"==t.key&&(this.viewState.pointerPreciseState={sx0:this.viewState.pointerScreenX,t0:this.viewState.pointerTime}),"Control"==t.key&&(this.viewState.controlKeyPressed=!0),"Delete"==t.key&&this.viewState.editMode&&!this.viewState.busy)){for(var i=[],n=[],a=0,o=Object.values(this.viewState.trainSelections);a<o.length;a++){var r=o[a];if(r.stevRange){var s=r.train.stevs.indexOf(r.stevRange.from),c=r.train.stevs.indexOf(r.stevRange.to),l=c-s+1;if(l>=r.train.stevs.length-1)i.push(r.train);else for(var h=s;h<=c;++h)n.push({stev:r.train.stevs[h],index:h})}else i.push(r.train)}i.forEach((function(t){return e.$delete(e.diagram.trains,t.id)})),n.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)})),this.context.history.push({this:this,undo:function(){n.forEach((function(t){return t.stev.train.addNewStopEvent(t.stev,t.index)})),i.forEach((function(t){return e.$set(e.diagram.trains,t.id,t)}))},redo:function(){i.forEach((function(t){return e.$delete(e.diagram.trains,t.id)})),n.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)}))}}),this.viewState.trainSelections={}}}},{key:"onKeyUp",value:function(t){"Alt"==t.key&&(this.viewState.pointerPreciseState=null),"Control"==t.key&&(this.viewState.controlKeyPressed=!1)}},{key:"onContextMenu",value:function(t){return t.evt.preventDefault(),!1}}]),i}(m["e"]);Object(f["a"])([Object(m["b"])()],Wt.prototype,"context",void 0),Wt=Object(f["a"])([Object(m["a"])({components:{BackLayer:nt,Pointer:vt,TrainPathLayer:Bt}})],Wt);var _t=Wt,$t=_t,Ht=Object(J["a"])($t,Y,N,!1,null,"7b2a6077",null),Dt=Ht.exports,zt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.viewState.editMode&&t.station.expanded&&t.isBottomLineIntersectingPlotPane?i("b-icon",{style:t.style,attrs:{icon:"plus",size:"is-small"},nativeOn:{click:function(e){return t.onClick(e)}}}):t._e()},Ft=[],Xt=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"style",get:function(){return{left:"".concat(this.diagram.config.leftPaneWidth-this.viewConfig.stationLabelRightMargin,"px"),top:"".concat(this.context.getYByRelY(this.station.bottomRelY)-this.diagram.config.trackLineSpan,"px"),height:"".concat(this.diagram.config.trackLineSpan,"px")}}},{key:"isBottomLineIntersectingPlotPane",get:function(){return this.context.getYByRelY(this.station.bottomRelY)>=this.viewConfig.topPaneHeight&&this.context.getYByRelY(this.station.bottomRelY)<this.viewState.viewHeight}},{key:"onClick",value:function(){var t=this;if(!this.viewState.inputEnabled){var e=this.station.addNewTrack(new y(this.station,this.diagram.genId(),""));this.diagram.updateY(),this.context.history.push({this:this,undo:function(){t.station.removeTrack(e),t.diagram.updateY()},redo:function(){t.station.addNewTrack(e),t.diagram.updateY()}}),this.viewState.trackNameInputTarget=e,this.$emit("trackNameInputStart")}}}]),i}(m["e"]);Object(f["a"])([Object(m["b"])()],Xt.prototype,"context",void 0),Object(f["a"])([Object(m["c"])()],Xt.prototype,"station",void 0),Xt=Object(f["a"])([m["a"]],Xt);var Jt=Xt,Ut=Jt,Gt=Object(J["a"])(Ut,zt,Ft,!1,null,"73a8aefa",null),At=Gt.exports,Kt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.isBottomLineIntersectingPlotPane?i("b-icon",{style:t.style,attrs:{icon:t.icon,size:"is-small"},nativeOn:{click:function(e){return t.onClick(e)}}}):t._e()},Vt=[],qt=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"icon",get:function(){return this.station.expanded?"chevron-up":"chevron-down"}},{key:"style",get:function(){return{left:"".concat(this.viewConfig.stationLabelLeftMargin,"px"),top:"".concat(this.context.getYByRelY(this.station.bottomRelY),"px"),height:"".concat(this.diagram.config.trackLineSpan,"px")}}},{key:"isBottomLineIntersectingPlotPane",get:function(){return this.context.getYByRelY(this.station.bottomRelY)>=this.viewConfig.topPaneHeight&&this.context.getYByRelY(this.station.bottomRelY)<this.viewState.viewHeight}},{key:"onClick",value:function(){this.viewState.inputEnabled||(this.station.expanded=!this.station.expanded,this.diagram.updateY())}}]),i}(m["e"]);Object(f["a"])([Object(m["b"])()],qt.prototype,"context",void 0),Object(f["a"])([Object(m["c"])()],qt.prototype,"station",void 0),qt=Object(f["a"])([m["a"]],qt);var Qt=qt,Zt=Qt,te=Object(J["a"])(Zt,Kt,Vt,!1,null,"0c63bd4d",null),ee=te.exports,ie=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("input",{directives:[{name:"show",rawName:"v-show",value:t.viewState.stationNameInputTarget,expression:"viewState.stationNameInputTarget"}],style:t.style,domProps:{value:t.targetStation.name},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onComplete(e)},blur:t.onComplete}})},ne=[],ae=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"targetStation",get:function(){var t;return null!==(t=this.viewState.stationNameInputTarget)&&void 0!==t?t:{}}},{key:"style",get:function(){return{left:"".concat(this.viewConfig.stationLabelLeftMargin,"px"),top:"".concat(this.context.getYByRelY(this.targetStation.topRelY)-this.viewConfig.stationLabelFontSize-4,"px"),width:"".concat(this.diagram.config.leftPaneWidth-this.viewConfig.stationLabelLeftMargin-this.viewConfig.stationLabelRightMargin,"px"),height:"".concat(this.viewConfig.stationLabelFontSize+4,"px"),paddingTop:"2px",lineHeight:"".concat(this.viewConfig.stationLabelFontSize,"px"),border:"none",fontSize:"".concat(this.viewConfig.stationLabelFontSize,"px")}}},{key:"onComplete",value:function(){var t=this.targetStation,e=this.targetStation.name,i=this.$el.value;e!=i&&(t.name=i,this.context.history.push({this:this,undo:function(){t.name=e},redo:function(){t.name=i}})),this.viewState.stationNameInputTarget=null}}]),i}(m["e"]);Object(f["a"])([Object(m["b"])()],ae.prototype,"context",void 0),ae=Object(f["a"])([m["a"]],ae);var oe=ae,re=oe,se=Object(J["a"])(re,ie,ne,!1,null,"b1467f1a",null),ce=se.exports,le=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.viewState.editMode&&t.isTopLineIntersectingPlotPane?i("b-icon",{style:t.style,attrs:{icon:"close",size:"is-small"},nativeOn:{click:function(e){return t.onClick(e)}}}):t._e()},he=[],ue=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"style",get:function(){return{left:"".concat(this.diagram.config.leftPaneWidth-this.viewConfig.stationLabelRightMargin,"px"),top:"".concat(this.context.getYByRelY(this.station.topRelY)-this.diagram.config.trackLineSpan,"px"),height:"".concat(this.diagram.config.trackLineSpan,"px")}}},{key:"isTopLineIntersectingPlotPane",get:function(){return this.context.getYByRelY(this.station.topRelY)>=this.viewConfig.topPaneHeight&&this.context.getYByRelY(this.station.topRelY)<this.viewState.viewHeight}},{key:"onClick",value:function(){var t=this;if(!this.viewState.busy){for(var e=[],i=[],n=0,a=Object.values(this.diagram.trains);n<a.length;n++)for(var o=a[n],r=0;r<o.stevs.length;++r){var s=o.stevs[r];s.station==this.station&&(i.push({stev:s,index:r}),o.stevs.length<=1&&e.push(o))}i.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)})),e.forEach((function(e){return t.diagram.removeTrain(e)})),this.$delete(this.diagram.stations,this.station.id),this.diagram.updateY(),this.context.history.push({this:this,undo:function(){t.$set(t.diagram.stations,t.station.id,t.station),e.forEach((function(e){return t.diagram.addNewTrain(e)})),i.forEach((function(t){return t.stev.train.addNewStopEvent(t.stev,t.index)})),t.diagram.updateY()},redo:function(){i.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)})),e.forEach((function(e){return t.diagram.removeTrain(e)})),t.$delete(t.diagram.stations,t.station.id),t.diagram.updateY()}})}}}]),i}(m["e"]);Object(f["a"])([Object(m["b"])()],ue.prototype,"context",void 0),Object(f["a"])([Object(m["c"])()],ue.prototype,"station",void 0),ue=Object(f["a"])([m["a"]],ue);var ge=ue,de=ge,ve=Object(J["a"])(de,le,he,!1,null,"5477a2e8",null),fe=ve.exports,me=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.viewState.editMode&&t.station.expanded&&Object.values(t.station.tracks).length>1&&t.isLineIntersectingPlotPane?i("b-icon",{style:t.style,attrs:{icon:"close",size:"is-small"},nativeOn:{click:function(e){return t.onClick(e)}}}):t._e()},pe=[],Se=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"style",get:function(){return{left:"".concat(this.diagram.config.leftPaneWidth-this.viewConfig.stationLabelRightMargin,"px"),top:"".concat(this.context.getYByRelY(this.track.relY)-this.diagram.config.trackLineSpan,"px"),height:"".concat(this.diagram.config.trackLineSpan,"px")}}},{key:"isLineIntersectingPlotPane",get:function(){return this.context.getYByRelY(this.track.relY)>=this.viewConfig.topPaneHeight&&this.context.getYByRelY(this.track.relY)<this.viewState.viewHeight}},{key:"onClick",value:function(){var t=this;if(!this.viewState.busy){for(var e=[],i=[],n=0,a=Object.values(this.diagram.trains);n<a.length;n++)for(var o=a[n],r=0;r<o.stevs.length;++r){var s=o.stevs[r];s.track==this.track&&(i.push({stev:s,index:r}),o.stevs.length<=1&&e.push(o))}var c=this.station.tracks.indexOf(this.track);i.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)})),e.forEach((function(e){return t.diagram.removeTrain(e)})),this.station.removeTrack(this.track),this.diagram.updateY(),this.context.history.push({this:this,undo:function(){t.station.addNewTrack(t.track,c),e.forEach((function(e){return t.diagram.addNewTrain(e)})),i.forEach((function(t){return t.stev.train.addNewStopEvent(t.stev,t.index)})),t.diagram.updateY()},redo:function(){i.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)})),e.forEach((function(e){return t.diagram.removeTrain(e)})),t.station.removeTrack(t.track),t.diagram.updateY()}})}}}]),i}(m["e"]);Object(f["a"])([Object(m["b"])()],Se.prototype,"context",void 0),Object(f["a"])([Object(m["c"])()],Se.prototype,"station",void 0),Object(f["a"])([Object(m["c"])()],Se.prototype,"track",void 0),Se=Object(f["a"])([m["a"]],Se);var be=Se,we=be,ye=Object(J["a"])(we,me,pe,!1,null,"9d3a3506",null),ke=ye.exports,xe=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("input",{directives:[{name:"show",rawName:"v-show",value:t.viewState.trackNameInputTarget,expression:"viewState.trackNameInputTarget"}],style:t.style,domProps:{value:t.targetTrack.name},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onComplete(e)},blur:t.onComplete}})},Ce=[],Te=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"targetTrack",get:function(){var t;return null!==(t=this.viewState.trackNameInputTarget)&&void 0!==t?t:{}}},{key:"style",get:function(){return this.viewState.trackNameInputTarget?{left:"".concat(this.viewConfig.stationLabelLeftMargin+this.viewConfig.trackLabelLeftMargin,"px"),top:"".concat(this.context.getYByRelY(this.targetTrack.relY)-this.viewConfig.stationLabelFontSize-4,"px"),width:"".concat(this.diagram.config.leftPaneWidth-this.viewConfig.stationLabelLeftMargin-this.viewConfig.trackLabelLeftMargin-this.viewConfig.stationLabelRightMargin,"px"),height:"".concat(this.viewConfig.stationLabelFontSize+4,"px"),paddingTop:"2px",lineHeight:"".concat(this.viewConfig.stationLabelFontSize,"px"),border:"none",fontSize:"".concat(this.viewConfig.stationLabelFontSize,"px")}:{}}},{key:"onComplete",value:function(){var t=this.targetTrack,e=t.name,i=this.$el.value;e!=i&&(t.name=i,this.context.history.push({this:this,undo:function(){t.name=e},redo:function(){t.name=i}})),this.viewState.trackNameInputTarget=null}}]),i}(m["e"]);Object(f["a"])([Object(m["b"])()],Te.prototype,"context",void 0),Te=Object(f["a"])([m["a"]],Te);var Oe=Te,je=Oe,Le=Object(J["a"])(je,xe,Ce,!1,null,"5d75e51d",null),Pe=Le.exports,Me=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"train-info-editor-box box",style:t.groupStyle},[i("input",{ref:"trainNameInput",staticClass:"train-name-input",style:t.trainNameInputStyle,domProps:{value:t.targetTrain.name},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onComplete(e)}}})])},Ye=[],Ne=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"targetTrain",get:function(){var t,e;return null!==(t=null===(e=this.viewState.trainInfoEditorTarget)||void 0===e?void 0:e.train)&&void 0!==t?t:{}}},{key:"groupStyle",get:function(){var t,e,i=this.viewState.trainInfoEditorTarget;return i?{left:"".concat(i.x,"px"),top:"".concat(i.y+("bottom"==i.verticalAlign&&null!==(t=-(null===(e=this.$el)||void 0===e?void 0:e.clientHeight))&&void 0!==t?t:0),"px")}:{left:"0px",top:"".concat(this.viewState.viewHeight,"px")}}},{key:"trainNameInputStyle",get:function(){return this.viewState.trainInfoEditorTarget?{lineHeight:"".concat(this.viewConfig.stationLabelFontSize,"px"),fontSize:"".concat(this.viewConfig.stationLabelFontSize,"px")}:{}}},{key:"onComplete",value:function(){var t=this.targetTrain,e=t.name,i=this.$refs.trainNameInput.value;e!=i&&(t.name=i,this.context.history.push({this:this,undo:function(){t.name=e},redo:function(){t.name=i}})),this.viewState.trainInfoEditorTarget=null}}]),i}(m["e"]);Object(f["a"])([Object(m["b"])()],Ne.prototype,"context",void 0),Ne=Object(f["a"])([m["a"]],Ne);var Re=Ne,Ee=Re,Ie=(i("4bc9"),Object(J["a"])(Ee,Me,Ye,!1,null,"5b03e809",null)),Be=Ie.exports,We=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"mounted",value:function(){var t=new ResizeObserver(this.updateViewSize);t.observe(this.$el)}},{key:"onStationNameInputStart",value:function(){var t=this;this.$nextTick((function(){return t.$refs.stationNameInput.$el.focus()}))}},{key:"onTrackNameInputStart",value:function(){var t=this;this.$nextTick((function(){return t.$refs.trackNameInput.$el.focus()}))}},{key:"onTrainInfoEditStart",value:function(){var t=this;this.$nextTick((function(){return t.$refs.trainInfoEditor.$refs.trainNameInput.focus()}))}},{key:"onTrainInfoEditEnd",value:function(){this.$refs.trainInfoEditor.onComplete()}},{key:"updateViewSize",value:function(){this.$el&&(this.viewState.viewWidth=this.$el.clientWidth,this.viewState.viewHeight=this.$el.clientHeight,this.diagram.config.scrollX=Math.max(this.diagram.config.minPlotTime*this.diagram.config.xScale-this.viewConfig.plotPanePadding,Math.min(this.diagram.config.maxPlotTime*this.diagram.config.xScale-(this.viewState.viewWidth-this.diagram.config.leftPaneWidth-this.viewConfig.plotPanePadding),this.diagram.config.scrollX)),this.diagram.config.scrollY=Math.max(0,Math.min(this.context.getYByRelY(this.diagram.maxRelY),this.diagram.config.scrollY)))}}]),i}(m["e"]);Object(f["a"])([Object(m["c"])({default:new L}),Object(m["d"])()],We.prototype,"context",void 0),We=Object(f["a"])([Object(m["a"])({components:{Stage:Dt,StationAddTrackButton:At,StationExpandButton:ee,StationNameInput:ce,StationRemoveButton:fe,StationRemoveTrackButton:ke,TrackNameInput:Pe,TrainInfoEditor:Be}})],We);var _e=We,$e=_e,He=(i("8a96"),Object(J["a"])($e,P,M,!1,null,"4cefd6dc",null)),De=He.exports,ze=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-carousel",{attrs:{autoplay:!1,"indicator-inside":!1}},[n("b-carousel-item",[n("div",{staticClass:"help-item"},[n("div",{staticClass:"help-image"},[n("img",{attrs:{src:i("c98c")}})]),n("div",{staticClass:"help-desc content"},[n("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.addNewStationTitle"))}}),n("p",{domProps:{innerHTML:t._s(t.$t("message.help.addNewStationBody"))}})])])]),n("b-carousel-item",[n("div",{staticClass:"help-item"},[n("div",{staticClass:"help-image"},[n("img",{attrs:{src:i("bfd4")}})]),n("div",{staticClass:"help-desc content"},[n("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.addNewTrainTitle"))}}),n("p",{domProps:{innerHTML:t._s(t.$t("message.help.addNewTrainBody"))}})])])]),n("b-carousel-item",[n("div",{staticClass:"help-item"},[n("div",{staticClass:"help-image"},[n("img",{attrs:{src:i("41d8")}})]),n("div",{staticClass:"help-desc content"},[n("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.selectTrainTitle"))}}),n("p",{domProps:{innerHTML:t._s(t.$t("message.help.selectTrainBody"))}})])])]),n("b-carousel-item",[n("div",{staticClass:"help-item"},[n("div",{staticClass:"help-image"},[n("img",{attrs:{src:i("07f5")}})]),n("div",{staticClass:"help-desc content"},[n("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.editTrainTitle"))}}),n("p",{domProps:{innerHTML:t._s(t.$t("message.help.editTrainBody"))}})])])]),n("b-carousel-item",[n("div",{staticClass:"help-item"},[n("div",{staticClass:"help-image"},[n("img",{attrs:{src:i("965e")}})]),n("div",{staticClass:"help-desc content"},[n("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.editTimeTitle"))}}),n("p",{domProps:{innerHTML:t._s(t.$t("message.help.editTimeBody"))}})])])]),n("b-carousel-item",[n("div",{staticClass:"help-item"},[n("img",{attrs:{src:i("60b1")}}),n("div",{staticClass:"help-desc content"},[n("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.tipsTitle"))}}),n("p",{domProps:{innerHTML:t._s(t.$t("message.help.tipsBody"))}})])])]),n("b-carousel-item",[n("div",{staticClass:"help-item"},[n("div",{staticClass:"help-desc content"},[n("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.contactTitle"))}}),n("p",{domProps:{innerHTML:t._s(t.$t("message.help.contactBody"))}})])])])],1)},Fe=[],Xe=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return i}(m["e"]);Xe=Object(f["a"])([m["a"]],Xe);var Je=Xe,Ue=Je,Ge=(i("d8a1"),Object(J["a"])(Ue,ze,Fe,!1,null,"ec83cbc6",null)),Ae=Ge.exports,Ke=function(t){Object(d["a"])(i,t);var e=Object(v["a"])(i);function i(){var t;return Object(u["a"])(this,i),t=e.apply(this,arguments),t.context=new L,t.diagramFileName="diagram.json",t.enableSwitchEditMode=window.screen.width>=640,t.subView="none",t}return Object(g["a"])(i,[{key:"mounted",value:function(){var t=this;this.context.state.editMode=this.enableSwitchEditMode,fetch("sample-diagram.json").then(function(){var e=Object(h["a"])(regeneratorRuntime.mark((function e(i){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i.json();case 2:n=e.sent,t.context.diagram=T.fromJSON(n),t.diagramFileName="sample-diagram.json";case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"onEditButtonClick",value:function(){this.context.state.editMode=!this.context.state.editMode}},{key:"onUndoButtonClick",value:function(){this.context.history.undo()}},{key:"onRedoButtonClick",value:function(){this.context.history.redo()}},{key:"onVanishButtonClick",value:function(){var t=this;if(Object.keys(this.context.diagram.trains).length>0){var e=this.context.diagram.trains;this.context.history.push({this:this,undo:function(){t.context.diagram.trains=e},redo:function(){t.context.diagram.trains={}}}),this.context.diagram.trains={}}else{var i=this.context.diagram;this.context.history.push({this:this,undo:function(){t.context.diagram=i},redo:function(){t.context.diagram=T.fromJSON({stations:{},trains:{}})}}),this.context.diagram=T.fromJSON({stations:{},trains:{}})}}},{key:"onUploadButtonClick",value:function(){var t=this,e=document.createElement("input");e.type="file",e.accept=".json, application/json",e.onchange=function(){var i=new FileReader;if(e.files&&e.files.length>0){var n=e.files[0];i.readAsText(n),i.onload=function(){if("string"==typeof i.result)try{var e=JSON.parse(i.result);t.context.diagram=T.fromJSON(e),t.diagramFileName=n.name,t.context.history.clear()}catch(a){t.$buefy.notification.open({type:"is-danger",message:"".concat(t.$t("message.failedToLoadJSON").toString(),"<br>").concat(n.name)})}}}},e.click()}},{key:"onDownloadButtonClick",value:function(){var t=JSON.stringify(this.context.diagram),e=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(e),n=document.createElement("a");n.href=i,n.download=this.diagramFileName,n.click()}},{key:"onHelpButtonClick",value:function(){this.subView="help"==this.subView?"none":"help"}}]),i}(m["e"]);Ke=Object(f["a"])([Object(m["a"])({components:{DiagramView:De,HelpView:Ae}})],Ke);var Ve=Ke,qe=Ve,Qe=(i("5c0b"),Object(J["a"])(qe,c,l,!1,null,null,null)),Ze=Qe.exports,ti={ja:{message:{failedToLoadJSON:"ファイルの読み込みに失敗しました。",editButtonTooltip:"編集モード",undoButtonTooltip:"元に戻す",redoButtonTooltip:"やり直す",vanishTrainsButtonTooltip:"列車をクリア",vanishStationsButtonTooltip:"駅をクリア",uploadButtonTooltip:"ダイヤファイルを読み込む",downloadButtonTooltip:"ダイヤファイルを保存する",helpButtonTooltip:"操作方法",help:{addNewStationTitle:"駅を追加する",addNewStationBody:"<p>左側の駅名エリアをダブルクリックすると、新しい駅を追加できます。</p><ul><li>駅名をドラッグすると、駅線の位置を調整できます。<li>駅名をクリックすると、駅名を編集できます。<li>駅右側の<i class='mdi mdi-close'></i>アイコンをクリックすると、駅を削除できます。</ul>",addNewTrainTitle:"列車を追加する",addNewTrainBody:"<p>駅線の上でダブルクリックすると、新しい列車を追加できます。駅線を続けてクリックして、停車駅を順に追加できます。</p><ul><li>列車線の編集を終了するには、もう一度ダブルクリックします。<li>Altキーを押しながらカーソルを動かすと、秒単位で時刻を指定できます。<li>右クリックすると、追加した停車駅を順に削除します。</ul>",selectTrainTitle:"列車を選択する",selectTrainBody:"<p>列車線をクリックすると、列車を選択できます。</p><ul><li>Shiftキーを押しながら別の列車線をクリックすると、複数列車を選択できます。<li>列車を選択した状態でさらにクリックすると、特定の駅または駅間を選択できます。<br>Shiftキーを押しながらクリックすると、複数駅間を選択できます。</ul>",editTrainTitle:"列車を編集する",editTrainBody:"<p>列車を選択した状態では、さまざまな方法で列車を編集できます。</p><ul><li>列車線と駅線の交点をダブルクリックすると、停車駅を追加できます。<li>列車線の始端・終端をダブルクリックすると、列車線を延長できます。<li>Deleteキーを押すと、選択した区間の列車線を削除できます。</ul>",editTimeTitle:"着発時刻を変更する",editTimeBody:"<p>列車を選択した状態で列車線をドラッグすると、着発時刻を変更できます。</p><ul><li>Altキーを押しながらカーソルを動かすと、秒単位で時刻を指定できます。<li>番線線上の列車線をドラッグすると、着発番線を変更できます。<li>Ctrlキーを押しながらドラッグすると、着発時刻を変更する代わりに、<br>列車線をコピーして新しい列車を作成できます。</ul>",tipsTitle:"アイコンメニュー",tipsBody:"<ul><li><i class='mdi mdi-undo'></i><i class='mdi mdi-redo'></i>ボタンで、操作の取り消し・やり直しができます。<li><i class='mdi mdi-vanish'></i>ボタンで、列車・駅の一括削除ができます。<li><i class='mdi mdi-upload'></i><i class='mdi mdi-download'></i>ボタンで、データの読み込み・保存ができます。</ul>",contactTitle:"不明点・不具合などを見つけたら",contactBody:"<p>不明点・不具合などがありましたら、<a href='https://twitter.com/nosrithe'>@nosrithe</a> までお知らせください。</p><ul><li>お問い合わせの際は、操作の目的や再現手順を具体的にお伝えください。<li>不具合などの修正は <a href='https://github.com/nosrith/diafreaks/issues'>GitHub プロジェクト</a> で管理しています。<br>既知の不具合についてはこちらをご確認ください。</ul>"}}}};n["default"].config.productionTip=!1,n["default"].use(a["a"],{defaultNotificationDuration:5e3,defaultNotificationPosition:"is-bottom-right"}),n["default"].use(o["a"]),n["default"].use(s.a);var ei=new o["a"]({locale:"ja",messages:ti});new n["default"]({render:function(t){return t(Ze)},i18n:ei}).$mount("#app")},d8a1:function(t,e,i){"use strict";i("09ec")}});
//# sourceMappingURL=app.af5a8ced.js.map