(function(t){function e(e){for(var n,r,s=e[0],c=e[1],l=e[2],u=0,d=[];u<s.length;u++)r=s[u],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&d.push(a[r][0]),a[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);h&&h(e);while(d.length)d.shift()();return o.push.apply(o,l||[]),i()}function i(){for(var t,e=0;e<o.length;e++){for(var i=o[e],n=!0,s=1;s<i.length;s++){var c=i[s];0!==a[c]&&(n=!1)}n&&(o.splice(e--,1),t=r(r.s=i[0]))}return t}var n={},a={app:0},o=[];function r(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=n,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var h=c;o.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("cd49")},"07f5":function(t,e,i){t.exports=i.p+"img/help_edit_train.67395182.png"},"0c06":function(t,e,i){},"146d":function(t,e,i){"use strict";i("33ef")},"26ce":function(t,e,i){},"33ef":function(t,e,i){},"41d8":function(t,e,i){t.exports=i.p+"img/help_select_train.6cd1d819.png"},"509f":function(t,e,i){"use strict";i("0c06")},"5c0b":function(t,e,i){"use strict";i("9c0c")},"60b1":function(t,e,i){t.exports=i.p+"img/help_tips.12f4142e.png"},"6a20":function(t,e,i){"use strict";i("26ce")},"965e":function(t,e,i){t.exports=i.p+"img/help_edit_time.25aa545d.png"},"9c0c":function(t,e,i){},a8d2:function(t,e,i){t.exports=i.p+"img/diafreaks_logo.8b0abdc8.png"},bfd4:function(t,e,i){t.exports=i.p+"img/help_add_new_train.0fab88c8.png"},c98c:function(t,e,i){t.exports=i.p+"img/help_add_new_station.d55b6e32.png"},cd49:function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var n=i("2b0e"),a=i("289d"),o=(i("5abe"),i("a925")),r=i("7591"),s=i.n(r),c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("diagram-view",{attrs:{id:"diagram-view",context:t.context}}),"help"==t.subView?i("help-view",{attrs:{id:"help-pane"}}):t._e(),i("div",{attrs:{id:"nav-pane"}},[t._m(0),i("span",{attrs:{id:"nav-pane-buttons"}},[i("span",{attrs:{id:"nav-pane-buttons-left"}},[t.enableSwitchEditMode?i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.editButtonTooltip"),type:"is-light"}},[i("b-button",{class:t.context.state.editMode?"is-selected":"",attrs:{"icon-left":"pencil-outline",size:"medium"},on:{click:t.onEditButtonClick}})],1)],1):t._e(),t.context.state.editMode?i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.undoButtonTooltip"),type:"is-light"}},[i("b-button",{attrs:{"icon-left":"undo",size:"medium",disabled:!t.context.history.undoable},on:{click:t.onUndoButtonClick}})],1)],1):t._e(),t.context.state.editMode?i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.redoButtonTooltip"),type:"is-light"}},[i("b-button",{attrs:{"icon-left":"redo",size:"medium",disabled:!t.context.history.redoable},on:{click:t.onRedoButtonClick}})],1)],1):t._e(),t.context.state.editMode?i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:Object.keys(t.context.diagram.trains).length>0?t.$t("message.vanishTrainsButtonTooltip"):t.$t("message.vanishStationsButtonTooltip"),type:"is-light"}},[i("b-button",{attrs:{"icon-left":"vanish",size:"medium"},on:{click:t.onVanishButtonClick}})],1)],1):t._e(),i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.uploadButtonTooltip"),type:"is-light"}},[i("b-button",{attrs:{"icon-left":"upload",size:"medium"},on:{click:t.onUploadButtonClick}})],1)],1),i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.downloadButtonTooltip"),type:"is-light"}},[i("b-button",{attrs:{"icon-left":"download",size:"medium"},on:{click:t.onDownloadButtonClick}})],1)],1)]),i("span",{attrs:{id:"nav-pane-buttons-spacer"}}),i("span",{attrs:{id:"nav-pane-buttons-right"}},[t.enableSwitchEditMode?i("span",{staticClass:"nav-pane-item"},[i("b-tooltip",{attrs:{label:t.$t("message.helpButtonTooltip"),type:"is-light"}},[i("b-button",{class:"help"==t.subView?"is-selected":"",attrs:{"icon-left":"help",size:"medium"},on:{click:t.onHelpButtonClick}})],1)],1):t._e()])])])],1)},l=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"nav-pane-item",attrs:{id:"nav-pane-logo"}},[n("img",{staticStyle:{height:"32px"},attrs:{src:i("a8d2")}})])}],h=i("1da1"),u=i("d4ec"),d=i("bee2"),v=i("262e"),g=i("2caf"),f=(i("96cf"),i("d3b7"),i("b64b"),i("b0c0"),i("99af"),i("25f0"),i("3ca3"),i("ddb0"),i("2b3d"),i("9ab4")),p=i("1b40"),m=i("b85c"),S=(i("159b"),i("07ac"),i("a434"),function(){function t(e){Object(u["a"])(this,t),this.capacity=e,this.undos=[],this.redos=[]}return Object(d["a"])(t,[{key:"undoable",get:function(){return this.undos.length>0}},{key:"redoable",get:function(){return this.redos.length>0}},{key:"push",value:function(t){this.undos.length>=this.capacity&&this.undos.splice(0,this.undos.length-this.capacity+1),this.undos.push(t),this.redos.splice(0)}},{key:"clear",value:function(){this.undos.splice(0),this.redos.splice(0)}},{key:"undo",value:function(){var t=this.undos.pop();t&&(this.redos.push(t),t.undo.apply(t.this))}},{key:"redo",value:function(){var t=this.redos.pop();t&&(this.undos.push(t),t.redo.apply(t.this))}}]),t}()),b=i("53ca"),y=i("2909"),w=(i("d81d"),i("c1f9"),i("4de4"),function(){function t(){Object(u["a"])(this,t),this.minimumTimeUnit=5,this.minPlotTime=0,this.maxPlotTime=108e3,this.leftPaneWidth=160,this.scrollTime=21600,this.scrollRelY=0,this.xScale=.1,this.yScale=12}return Object(d["a"])(t,null,[{key:"fromJSON",value:function(e){if(!e||"object"!=Object(b["a"])(e))throw"Invalid JSON";var i=new t;return Object.assign(i,Object.fromEntries(Object.keys(i).filter((function(t){return void 0!==e[t]})).map((function(t){return[t,e[t]]})))),i}}]),t}()),k=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(u["a"])(this,t),this.station=e,this.id=i,this.name=n,this.relY=a}return Object(d["a"])(t,[{key:"toJSON",value:function(){return{id:this.id,n:this.name||void 0}}}],[{key:"fromJSON",value:function(e,i){var n,a,o=null!==(n=null!==(a=e.name)&&void 0!==a?a:e.n)&&void 0!==n?n:"";if(!e||"object"!=Object(b["a"])(e)||null==e.id)throw"Invalid JSON @ Track";return new t(i,e.id,o)}}]),t}(),x=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;Object(u["a"])(this,t),this.id=e,this.name=i,this.mileage=n,this.expanded=a,this.topRelY=o,this.bottomRelY=r,this.tracks=[new k(this,1)]}return Object(d["a"])(t,[{key:"addNewTrack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.tracks.length;if(!t){var i=Math.max.apply(Math,[0].concat(Object(y["a"])(this.tracks.map((function(t){return t.id})))))+1;t=new k(this,i)}return this.tracks.splice(e,0,t),this.tracks[e]}},{key:"removeTrack",value:function(t){var e=this.tracks.indexOf(t);e>=0&&this.tracks.splice(e,1)}},{key:"toJSON",value:function(){return{id:this.id,n:this.name||void 0,m:this.mileage,t:this.tracks,e:this.expanded?1:void 0}}}],[{key:"fromJSON",value:function(e){var i,n,a,o,r,s,c=null!==(i=null!==(n=e.name)&&void 0!==n?n:e.n)&&void 0!==i?i:"",l=null!==(a=null!==(o=e.mileage)&&void 0!==o?o:e.m)&&void 0!==a?a:0,h=!!(null!==(r=e.expanded)&&void 0!==r?r:e.e),u=null!==(s=e.tracks)&&void 0!==s?s:e.t;if(!e||"object"!=Object(b["a"])(e)||null==e.id||!Array.isArray(u))throw"Invalid JSON @ Station";var d=new t(e.id,c,l,h);return d.tracks=u.map((function(t){return k.fromJSON(t,d)})),d}}]),t}(),C=(i("5db7"),i("73d9"),i("7db0"),function(){function t(e,i,n){Object(u["a"])(this,t),this.train=e,this.track=i,this.time=n,this.privateId=++t.maxPrivateId}return Object(d["a"])(t,[{key:"station",get:function(){return this.track.station}},{key:"next",get:function(){var t=this.train.stevs.indexOf(this);return t>=0?this.train.stevs[t+1]:void 0}},{key:"prev",get:function(){var t=this.train.stevs.indexOf(this);return t>=0?this.train.stevs[t-1]:void 0}}],[{key:"fromJSONStop",value:function(e,i,n){var a,o,r,s,c=null!==(a=e.stationId)&&void 0!==a?a:e.s,l=null!==(o=e.trackId)&&void 0!==o?o:e.t,h=null!==(r=e.arrTime)&&void 0!==r?r:e.a,u=null!==(s=e.depTime)&&void 0!==s?s:e.d;if(!e||"object"!=Object(b["a"])(e)||null==c||null==l||null==h||null==u)throw"Invalid JSON @ Stop";var d=n[c],v=d&&d.tracks.find((function(t){return t.id==l}));if(!d||!v)throw"Invalid data @ Stop";return h==u?[new t(i,v,h)]:[new t(i,v,h),new t(i,v,u)]}}]),t}());C.maxPrivateId=0;var T=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Object(u["a"])(this,t),this.id=e,this.name=i,this.color=n,this.lineWidth=a,this.stevs=[]}return Object(d["a"])(t,[{key:"addNewStopEvent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.stevs.length;return this.stevs.splice(e,0,t),this.stevs[e]}},{key:"removeStopEvent",value:function(t){var e=this.stevs.indexOf(t);e>=0&&this.stevs.splice(e,1)}},{key:"getStopEventsInRange",value:function(t){var e,i=[],n=!1,a=Object(m["a"])(this.stevs);try{for(a.s();!(e=a.n()).done;){var o=e.value;o==t.from&&(n=!0),n&&i.push(o),o==t.to&&(n=!1)}}catch(r){a.e(r)}finally{a.f()}return i}},{key:"getTrainPathNodes",value:function(){var t,e=[],i=Object(m["a"])(this.stevs);try{for(i.s();!(t=i.n()).done;){var n=t.value;n.station.expanded&&n.prev&&n.prev.station!=n.station&&e.push({stev:n,phase:"arr",time:n.time,relY:n.prev.station.mileage<n.station.mileage?n.station.topRelY:n.station.bottomRelY}),e.push({stev:n,phase:"track",time:n.time,relY:n.track.relY}),n.station.expanded&&n.next&&n.next.station!=n.station&&e.push({stev:n,phase:"dep",time:n.time,relY:n.next.station.mileage<n.station.mileage?n.station.topRelY:n.station.bottomRelY})}}catch(a){i.e(a)}finally{i.f()}return e}},{key:"toJSON",value:function(){var t,e,i,n=[],a=Object(m["a"])(this.stevs);try{for(a.s();!(i=a.n()).done;){var o=i.value,r=n[n.length-1];r&&r.t==o.track.id&&r.a==r.d?r.d=o.time:n.push({s:o.station.id,t:o.track.id,a:o.time,d:o.time})}}catch(s){a.e(s)}finally{a.f()}return{id:this.id,n:this.name||void 0,c:null!==(t=this.color)&&void 0!==t?t:void 0,w:null!==(e=this.lineWidth)&&void 0!==e?e:void 0,s:n}}}],[{key:"fromJSON",value:function(e,i){var n,a,o,r,s,c=null!==(n=null!==(a=e.name)&&void 0!==a?a:e.n)&&void 0!==n?n:"",l=null!==(o=e.color)&&void 0!==o?o:e.c,h=null!==(r=e.lineWidth)&&void 0!==r?r:e.w,u=null!==(s=e.stops)&&void 0!==s?s:e.s;if(!e||"object"!=Object(b["a"])(e)||null==e.id||!Array.isArray(u))throw"Invalid JSON @ Train";var d=new t(e.id,c,l,h);return u.flatMap((function(t){return C.fromJSONStop(t,d,i)})).forEach((function(t){return d.stevs.push(t)})),d}}]),t}(),O=function(){function t(e,i,n){Object(u["a"])(this,t),this.config=e,this.stations=i,this.trains=n}return Object(d["a"])(t,[{key:"getStationsInMileageOrder",value:function(){return Object.values(this.stations).sort((function(t,e){return t.mileage-e.mileage}))}},{key:"addNewStation",value:function(t){if(!t){var e=Math.max.apply(Math,[0].concat(Object(y["a"])(Object.values(this.stations).map((function(t){return t.id})))))+1;t=new x(e)}return n["default"].set(this.stations,t.id,t)}},{key:"removeStation",value:function(t){n["default"].delete(this.stations,t.id)}},{key:"addNewTrain",value:function(t){if(!t){var e=Math.max.apply(Math,[0].concat(Object(y["a"])(Object.values(this.trains).map((function(t){return t.id})))))+1;t=new T(e)}return n["default"].set(this.trains,t.id,t)}},{key:"removeTrain",value:function(t){n["default"].delete(this.trains,t.id)}},{key:"toJSON",value:function(){return{config:this.config,stations:Object.values(this.stations),trains:Object.values(this.trains)}}}],[{key:"fromJSON",value:function(e){if(!e||"object"!=Object(b["a"])(e)||"object"!=Object(b["a"])(e.stations)||"object"!=Object(b["a"])(e.trains))throw"Invalid JSON";var i=w.fromJSON(e.config||{}),n=Object.fromEntries(Object.values(e.stations).map((function(t){return[t.id,x.fromJSON(t)]}))),a=Object.fromEntries(Object.values(e.trains).map((function(t){return[t.id,T.fromJSON(t,n)]}))),o=new t(i,n,a);return o}}]),t}(),P=function t(){Object(u["a"])(this,t),this.fontFamily="Verdana, sans-serif",this.topPaneHeight=30,this.hourlyLabelBottomMargin=4,this.hourlyLabelFontSize=14,this.hourlyLabelColor="rgb(128, 192, 128)",this.hourlyGridLineWidth=2.25,this.hourlyGridLineColor="rgb(128, 192, 128)",this.majorMinutelyGridLineSpan=600,this.majorMinutelyGridLineWidth=1.5,this.majorMinutelyGridLineColor="rgb(128, 192, 128)",this.minorMinutelyGridLineSpan=120,this.minorMinutelyGridLineWidth=.75,this.minorMinutelyGridLineColor="rgb(128, 192, 128)",this.stationLabelLeftMargin=14,this.stationLabelRightMargin=14,this.stationLabelFontSize=14,this.stationLabelColor="rgb(128, 192, 128)",this.stationLineWidth=1,this.stationLineColor="rgb(128, 192, 128)",this.plotPanePadding=4,this.trackLabelLeftMargin=10,this.trackLabelFontSize=11,this.trackLabelColor="rgb(128, 192, 128)",this.trackLineSpan=12,this.trackLineWidth=.75,this.trackLineColor="rgb(128, 192, 128)",this.trainPathWidth=1,this.trainPathColor="rgb(0, 0, 0)",this.trainNameLabelLineHeight=14,this.trainNameLabelFontSize=12,this.minHitWidth=3,this.pointerWidth=3,this.pointerColor="rgb(0, 0, 0)",this.pointerLabelFontSize=12,this.pointerPrecisePixelPerTimeUnit=5,this.selectedTrackLabelColor="rgb(255, 0, 0)",this.selectedTrackLineColor="rgb(255, 0, 0)",this.selectedTrainPathColor="rgb(255, 0, 0)",this.selectedTrainPathWidthScale=1.5,this.selectedTrainPathMarkerWidth=5,this.selectedTrainPathMarkerColor="rgb(255, 0, 0)",this.unselectedTrainPathOpacity=.5,this.markerLabelMaxDistance=20,this.markerLabelColor="rgb(255, 0, 0)",this.markerLabelFontSize=12,this.markerLabelLineHeight=16,this.wheelScale=.1},j=function(){function t(){Object(u["a"])(this,t),this.editMode=!0,this.viewWidth=0,this.viewHeight=0,this.gScale=1,this.trainSelections={},this.pointerScreenX=0,this.pointerTime=0,this.pointerY=0,this.pointerTargetTrainPath=null,this.pointerTargetLine=null,this.pointerPreciseState=null,this.drawingState=null,this.trainPathDragState=null,this.stationNameInputTarget=null,this.trackNameInputTarget=null,this.trainInfoEditorTarget=null,this.controlKeyPressed=!1}return Object(d["a"])(t,[{key:"busy",get:function(){return null!=this.drawingState||null!=this.trainPathDragState||this.inputEnabled}},{key:"inputEnabled",get:function(){return null!=this.stationNameInputTarget||null!=this.trackNameInputTarget||null!=this.trainInfoEditorTarget}}]),t}(),L=function(){function t(){Object(u["a"])(this,t),this.config=new P,this.state=new j,this.diagram=O.fromJSON({stations:[],trains:[]}),this.history=new S(100),this.maxRelY=0}return Object(d["a"])(t,[{key:"xPhysScale",get:function(){return this.state.gScale*this.diagram.config.xScale}},{key:"yPhysScale",get:function(){return this.state.gScale*this.diagram.config.yScale}},{key:"subScale",get:function(){return Math.sqrt(this.state.gScale)}},{key:"getYByRelY",value:function(t){return t-this.diagram.config.scrollRelY+this.config.plotPanePadding+this.config.topPaneHeight*this.subScale}},{key:"getRelYByY",value:function(t){return t-this.config.plotPanePadding-this.config.topPaneHeight*this.subScale+this.diagram.config.scrollRelY}},{key:"getXByTime",value:function(t){return(t-this.diagram.config.scrollTime)*this.xPhysScale+this.diagram.config.leftPaneWidth*this.subScale}},{key:"getTimeByX",value:function(t){return(t-this.diagram.config.leftPaneWidth*this.subScale)/this.xPhysScale+this.diagram.config.scrollTime}},{key:"setDiagram",value:function(t){var e=this.state;this.state=new j,this.state.editMode=e.editMode,this.state.viewWidth=e.viewWidth,this.state.viewHeight=e.viewHeight,this.diagram=t,this.updateY()}},{key:"updateY",value:function(){var t=this;if(0!=Object.keys(this.diagram.stations).length){var e,i=this.diagram.getStationsInMileageOrder(),n=i[0].mileage,a=Object(m["a"])(i);try{for(a.s();!(e=a.n()).done;){var o=e.value;o.mileage=o.mileage-n}}catch(u){a.e(u)}finally{a.f()}var r,s=0,c=0,l=Object(m["a"])(i);try{for(l.s();!(r=l.n()).done;){var h=r.value;s+=(h.mileage-c)*this.yPhysScale,h.topRelY=s,h.expanded?(h.tracks.forEach((function(e,i){e.relY=s+(i+1)*t.config.trackLineSpan*t.subScale})),h.bottomRelY=s+(h.tracks.length+1)*this.config.trackLineSpan*this.subScale,s+=(h.tracks.length+1)*this.config.trackLineSpan*this.subScale):(Object.values(h.tracks).forEach((function(t){return t.relY=s})),h.bottomRelY=s),c=h.mileage}}catch(u){l.e(u)}finally{l.f()}this.maxRelY=i[i.length-1].bottomRelY}else this.maxRelY=0}},{key:"truncateScrollPosition",value:function(){this.diagram.config.scrollTime=Math.max(this.diagram.config.minPlotTime-this.config.plotPanePadding/this.xPhysScale,Math.min(this.diagram.config.maxPlotTime-(this.state.viewWidth-this.diagram.config.leftPaneWidth*this.subScale-this.config.plotPanePadding)/this.xPhysScale,this.diagram.config.scrollTime)),this.diagram.config.scrollRelY=Math.max(0,Math.min(this.maxRelY-(this.state.viewHeight-this.config.plotPanePadding-(this.config.topPaneHeight+this.config.trackLineSpan)*this.subScale),this.diagram.config.scrollRelY))}}]),t}(),M=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"diagram-view"},[i("stage",{staticClass:"diagram-view-stage",on:{stationNameInputStart:t.onStationNameInputStart,trackNameInputStart:t.onTrackNameInputStart,trainInfoEditStart:t.onTrainInfoEditStart,trainInfoEditEnd:t.onTrainInfoEditEnd}}),i("div",{staticClass:"diagram-view-ui"},[i("station-name-input",{ref:"stationNameInput"}),i("track-name-input",{ref:"trackNameInput"}),i("train-info-editor",{ref:"trainInfoEditor"}),t._l(Object.values(t.diagram.stations),(function(e){return i("station-expand-button",{key:"station-expand-button-"+e.id,attrs:{station:e},on:{trackNameInputStart:t.onTrackNameInputStart}})})),t._l(Object.values(t.diagram.stations),(function(t){return i("station-remove-button",{key:"station-remove-button-"+t.id,attrs:{station:t}})})),t._l(Object.values(t.diagram.stations),(function(e){return i("station-add-track-button",{key:"station-add-track-button-"+e.id,attrs:{station:e},on:{trackNameInputStart:t.onTrackNameInputStart}})})),t._l(Object.values(t.diagram.stations),(function(e){return t._l(e.tracks,(function(t){return i("station-remove-track-button",{key:"station-remove-track-button-"+e.id+"-"+t.id,attrs:{station:e,track:t}})}))}))],2)],1)},Y=[],R=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.diagram?i("v-stage",{attrs:{config:t.stageConfig},on:{mousedown:t.onStageMouseDown,mousemove:t.onStageMouseMove,click:t.onStageClick,dblclick:t.onStageDoubleClick,wheel:t.onStageMouseWheel,contextmenu:t.onContextMenu,touchend:t.onTouchEnd}},[i("back-layer",t._g({},t.$listeners)),i("train-path-layer",t._g({},t.$listeners)),i("v-layer",[i("pointer")],1)],1):t._e()},E=[],N=i("ade3"),B=(i("2ca0"),i("4057"),i("2af1"),i("38cf"),i("c8b5")),W=i.n(B),I=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-layer",{attrs:{id:"back-layer"}},[t._l(t.timeGridLines,(function(e){return i("v-group",{key:e.key},[i("v-line",{attrs:{config:e.lineConfig}}),e.labelConfig?i("v-text",{attrs:{config:e.labelConfig}}):t._e()],1)})),t._l(Object.values(t.diagram.stations),(function(e){return i("station-group",t._g({key:"station-"+e.id,attrs:{station:e}},t.$listeners))}))],2)},_=[],$=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-group",[t.isTopLineIntersectingPlotPane?i("v-group",[i("v-line",{attrs:{config:t.topLineConfig}}),t._l(t.labelCharacters,(function(t){return i("v-text",{key:t.key,attrs:{config:t}})})),i("v-rect",{attrs:{config:t.labelRectConfig},on:{click:t.onStationLabelClick,mousedown:t.onStationLabelMouseDown}})],2):t._e(),t.station.expanded&&t.isBottomLineIntersectingPlotPane?i("v-line",{attrs:{config:t.bottomLineConfig}}):t._e(),t.station.expanded?t._l(t.station.tracks,(function(e){return i("track-group",t._g({key:"track-"+t.station.id+"-"+e.id,attrs:{station:t.station,track:e}},t.$listeners))})):t._e()],2)},D=[],H=(i("a630"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.isLineIntersectingPlotPane?i("v-group",[i("v-line",{attrs:{config:t.lineConfig}}),i("v-text",{attrs:{config:t.labelConfig},on:{click:t.onLabelClick,mousedown:t.onLabelMouseDown}})],1):t._e()}),z=[],F=(i("c740"),function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){var t;return Object(u["a"])(this,i),t=e.apply(this,arguments),t.dragState=null,t}return Object(d["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"lineConfig",get:function(){return{points:[(this.viewConfig.stationLabelLeftMargin+this.viewConfig.trackLabelLeftMargin)*this.context.subScale,this.context.getYByRelY(this.track.relY),this.viewState.viewWidth,this.context.getYByRelY(this.track.relY)],stroke:this.viewConfig.trackLineColor,strokeWidth:this.viewConfig.trackLineWidth,listening:!1}}},{key:"labelConfig",get:function(){return{id:"track-label-".concat(this.station.id,"-").concat(this.track.id),x:(this.viewConfig.stationLabelLeftMargin+this.viewConfig.trackLabelLeftMargin)*this.context.subScale,y:this.context.getYByRelY(this.track.relY)-this.viewConfig.trackLabelFontSize*this.context.subScale,width:(this.diagram.config.leftPaneWidth-this.viewConfig.stationLabelLeftMargin-this.viewConfig.trackLabelLeftMargin-this.viewConfig.stationLabelRightMargin)*this.context.subScale,height:this.viewConfig.trackLabelFontSize*this.context.subScale,text:this.track.name,fontSize:this.viewConfig.trackLabelFontSize*this.context.subScale,fontFamily:this.viewConfig.fontFamily,fill:this.viewConfig.trackLabelColor,align:"left",verticalAlign:"bottom"}}},{key:"isLineIntersectingPlotPane",get:function(){return this.context.getYByRelY(this.track.relY)>=this.viewConfig.topPaneHeight*this.context.subScale&&this.context.getYByRelY(this.track.relY)<this.viewState.viewHeight}},{key:"onLabelClick",value:function(){var t;!this.viewState.editMode||this.viewState.busy||null!==(t=this.dragState)&&void 0!==t&&t.dragging||(this.viewState.trackNameInputTarget=this.track,this.$emit("trackNameInputStart"))}},{key:"onLabelMouseDown",value:function(t){this.viewState.editMode&&(this.dragState={sy0:t.evt.screenY,index0:this.station.tracks.indexOf(this.track),dragging:!1},window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp))}},{key:"onWindowMouseMove",value:function(t){if(this.dragState&&(Math.abs(t.screenY-this.dragState.sy0)>1&&(this.dragState.dragging=!0),this.dragState.dragging)){this.station.removeTrack(this.track);var e=this.context.getRelYByY(t.clientY),i=this.station.tracks.findIndex((function(t){return e<t.relY}));i<0?this.station.tracks.push(this.track):this.station.tracks.splice(i,0,this.track),this.context.updateY()}}},{key:"onWindowMouseUp",value:function(t){var e=this;if(this.dragState){window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp),this.onWindowMouseMove(t);var i=this.dragState.index0,n=this.station.tracks.indexOf(this.track);i!=n&&this.context.history.push({this:this,undo:function(){e.station.removeTrack(e.track),e.station.addNewTrack(e.track,i)},redo:function(){e.station.removeTrack(e.track),e.station.addNewTrack(e.track,n)}}),this.dragState=null}}}]),i}(p["e"]));Object(f["a"])([Object(p["b"])()],F.prototype,"context",void 0),Object(f["a"])([Object(p["c"])()],F.prototype,"station",void 0),Object(f["a"])([Object(p["c"])()],F.prototype,"track",void 0),F=Object(f["a"])([p["a"]],F);var X=F,J=X,G=i("2877"),U=Object(G["a"])(J,H,z,!1,null,"bf3961c6",null),A=U.exports,K=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){var t;return Object(u["a"])(this,i),t=e.apply(this,arguments),t.dragState=null,t}return Object(d["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"topLineConfig",get:function(){return{points:[0,this.context.getYByRelY(this.station.topRelY),this.viewState.viewWidth,this.context.getYByRelY(this.station.topRelY)],stroke:this.viewConfig.stationLineColor,strokeWidth:this.viewConfig.stationLineWidth,listening:!1}}},{key:"bottomLineConfig",get:function(){return{points:[0,this.context.getYByRelY(this.station.bottomRelY),this.viewState.viewWidth,this.context.getYByRelY(this.station.bottomRelY)],stroke:this.viewConfig.stationLineColor,strokeWidth:this.viewConfig.stationLineWidth,listening:!1}}},{key:"labelRectConfig",get:function(){return{id:"station-label-".concat(this.station.id),x:this.viewConfig.stationLabelLeftMargin*this.context.subScale,y:this.context.getYByRelY(this.station.topRelY)-this.viewConfig.stationLabelFontSize*this.context.subScale,width:(this.diagram.config.leftPaneWidth-this.viewConfig.stationLabelLeftMargin-this.viewConfig.stationLabelRightMargin)*this.context.subScale,height:this.viewConfig.stationLabelFontSize*this.context.subScale}}},{key:"labelCharacters",get:function(){var t=this,e=this.diagram.config.leftPaneWidth-this.viewConfig.stationLabelLeftMargin-this.viewConfig.stationLabelRightMargin-this.viewConfig.stationLabelFontSize,i=this.station.name,n=i.length>1?e/(i.length-1):0;return Array.from(i).map((function(a,o){return{key:"station-label-".concat(t.station.id,"-").concat(o),x:t.context.subScale*(i.length>1?t.viewConfig.stationLabelLeftMargin+o*n:t.viewConfig.stationLabelLeftMargin+.5*e),y:t.context.getYByRelY(t.station.topRelY)-t.viewConfig.stationLabelFontSize*t.context.subScale,height:t.viewConfig.stationLabelFontSize*t.context.subScale,text:a,fontSize:t.viewConfig.stationLabelFontSize*t.context.subScale,fontFamily:t.viewConfig.fontFamily,fill:t.viewConfig.stationLabelColor,align:"left",verticalAlign:"bottom"}}))}},{key:"isTopLineIntersectingPlotPane",get:function(){return this.context.getYByRelY(this.station.topRelY)>=this.viewConfig.topPaneHeight*this.context.subScale&&this.context.getYByRelY(this.station.topRelY)<this.viewState.viewHeight}},{key:"isBottomLineIntersectingPlotPane",get:function(){return this.context.getYByRelY(this.station.bottomRelY)>=this.viewConfig.topPaneHeight*this.context.subScale&&this.context.getYByRelY(this.station.bottomRelY)<this.viewState.viewHeight}},{key:"onStationLabelClick",value:function(){var t;!this.viewState.editMode||this.viewState.busy||null!==(t=this.dragState)&&void 0!==t&&t.dragging||(this.viewState.stationNameInputTarget=this.station,this.$emit("stationNameInputStart"))}},{key:"onStationLabelMouseDown",value:function(t){this.viewState.editMode&&!this.viewState.inputEnabled&&(this.dragState={sy0:t.evt.screenY,mileage0:this.station.mileage,dragging:!1},window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp))}},{key:"onWindowMouseMove",value:function(t){this.dragState&&(Math.abs(t.screenY-this.dragState.sy0)>1&&(this.dragState.dragging=!0),this.dragState.dragging&&(this.station.mileage=this.dragState.mileage0+(t.screenY-this.dragState.sy0)/this.context.yPhysScale,this.context.updateY()))}},{key:"onWindowMouseUp",value:function(t){var e=this;if(this.dragState){if(window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp),this.onWindowMouseMove(t),this.dragState.dragging){var i=this.dragState.mileage0,n=this.station.mileage;this.context.history.push({this:this,undo:function(){e.station.mileage=i},redo:function(){e.station.mileage=n}})}this.dragState=null}}}]),i}(p["e"]);Object(f["a"])([Object(p["b"])()],K.prototype,"context",void 0),Object(f["a"])([Object(p["c"])()],K.prototype,"station",void 0),K=Object(f["a"])([Object(p["a"])({components:{TrackGroup:A}})],K);var V=K,q=V,Q=Object(G["a"])(q,$,D,!1,null,"46478552",null),Z=Q.exports,tt=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(d["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"timeGridLines",get:function(){var t=[],e=this.diagram.config.scrollTime,i=Math.ceil(e/this.viewConfig.minorMinutelyGridLineSpan)*this.viewConfig.minorMinutelyGridLineSpan,n=this.context.getXByTime(i);while(n<this.viewState.viewWidth)t.push({key:"time-grid-line-".concat(t.length),lineConfig:{points:[n,this.viewConfig.topPaneHeight*this.context.subScale,n,this.viewState.viewHeight],stroke:i%3600==0?this.viewConfig.hourlyGridLineColor:i%this.viewConfig.majorMinutelyGridLineSpan==0?this.viewConfig.majorMinutelyGridLineColor:this.viewConfig.minorMinutelyGridLineColor,strokeWidth:i%3600==0?this.viewConfig.hourlyGridLineWidth:i%this.viewConfig.majorMinutelyGridLineSpan==0?this.viewConfig.majorMinutelyGridLineWidth:this.viewConfig.minorMinutelyGridLineWidth,listening:!1},labelConfig:i%3600!=0?null:{x:n-this.viewConfig.hourlyLabelFontSize*this.context.subScale,y:(this.viewConfig.topPaneHeight-this.viewConfig.hourlyLabelBottomMargin-this.viewConfig.hourlyLabelFontSize)*this.context.subScale,width:this.viewConfig.hourlyLabelFontSize*this.context.subScale*2,height:this.viewConfig.hourlyLabelFontSize*this.context.subScale,text:"".concat(i/3600%24),fontSize:this.viewConfig.hourlyLabelFontSize*this.context.subScale,fontFamily:this.viewConfig.fontFamily,fill:this.viewConfig.hourlyLabelColor,align:"center",verticalAlign:"bottom"}}),i+=this.viewConfig.minorMinutelyGridLineSpan,n=this.context.getXByTime(i);return t}}]),i}(p["e"]);Object(f["a"])([Object(p["b"])()],tt.prototype,"context",void 0),tt=Object(f["a"])([Object(p["a"])({components:{StationGroup:Z}})],tt);var et=tt,it=et,nt=Object(G["a"])(it,I,_,!1,null,"280e7eb1",null),at=nt.exports,ot=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.pointerEnabled?i("v-group",[i("v-rect",{attrs:{config:t.rectConfig}}),i("v-text",{attrs:{config:t.labelConfig}})],1):t._e()},rt=[];i("4d90");function st(t,e){var i="".concat(Math.floor(t/3600)),n="".concat(Math.floor(t/60)%60).padStart(2,"0"),a="".concat(t%60).padStart(2,"0");return t%60!=0||e?"".concat(i,":").concat(n,":").concat(a):"".concat(i,":").concat(n)}var ct=document.createElement("canvas"),lt=ct.getContext("2d");function ht(t,e,i){return lt?(lt.font="".concat(i,"px ").concat(e),lt.measureText(t).width):0}var ut=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(d["a"])(i,[{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"pointerEnabled",get:function(){return this.viewState.pointerTargetLine&&!this.viewState.pointerTargetTrainPath&&!this.viewState.trainPathDragState&&!this.viewState.drawingState}},{key:"rectConfig",get:function(){var t=this.context.subScale*(this.viewState.drawingState?this.viewConfig.selectedTrainPathMarkerWidth:this.viewConfig.pointerWidth);return{x:this.context.getXByTime(this.viewState.pointerTime)-.5*t,y:this.viewState.pointerY-.5*t,width:t,height:t,fill:this.viewConfig.pointerColor,listening:!1}}},{key:"labelConfig",get:function(){var t=this.viewState.pointerTime>=0?this.viewState.pointerTime:this.viewState.pointerTime+3600*Math.ceil(-this.viewState.pointerTime/3600);return{x:this.context.getXByTime(this.viewState.pointerTime),y:this.viewState.pointerY-this.viewConfig.pointerLabelFontSize*this.context.subScale,height:this.viewConfig.pointerLabelFontSize*this.context.subScale,text:st(t,null!=this.viewState.pointerPreciseState),fontSize:this.viewConfig.pointerLabelFontSize*this.context.subScale,fontFamily:this.viewConfig.fontFamily,fill:this.viewConfig.pointerColor,align:"left",verticalAlign:"bottom",listening:!1}}}]),i}(p["e"]);Object(f["a"])([Object(p["b"])()],ut.prototype,"context",void 0),ut=Object(f["a"])([p["a"]],ut);var dt=ut,vt=dt,gt=Object(G["a"])(vt,ot,rt,!1,null,"336837b2",null),ft=gt.exports,pt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-layer",{ref:"trainPathLayer",attrs:{id:"train-path-layer",config:t.layerConfig}},[t._l(Object.values(t.diagram.trains).filter((function(e){return!t.viewState.trainSelections[e.id]})),(function(e){return i("train-path-group",t._g({key:"train-"+e.id,attrs:{train:e}},t.$listeners))})),t._l(Object.values(t.diagram.trains).filter((function(e){return t.viewState.trainSelections[e.id]})),(function(e){return i("train-path-group",t._g({key:"train-"+e.id,attrs:{train:e}},t.$listeners))}))],2)},mt=[],St=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-group",[i("v-text",{ref:"trainNameLabel",attrs:{config:t.trainNameLabelConfig},on:{click:t.onTrainNameLabelClick}}),i("v-line",{attrs:{config:t.regularTrainPathConfig},on:{click:t.onTrainPathClick,mousemove:t.onTrainPathMouseMove,tap:t.onTrainPathTap}}),t.selectedTrainPathEnabled?[i("v-line",{attrs:{config:t.selectedTrainPathConfig},on:{click:t.onSelectedTrainPathClick,dblclick:t.onSelectedTrainPathDoubleClick,mousedown:t.onSelectedTrainPathMouseDown,mousemove:t.onSelectedTrainPathMouseMove}}),t._l(t.selectedTrainPathNodes,(function(e){return i("train-path-marker",{key:"marker-"+t.train.id+"-"+e.stev.privateId+"-"+e.phase,attrs:{trainPathNode:e},on:{click:t.onMarkerClick,mousedown:t.onMarkerMouseDown}})}))]:t._e()],2)},bt=[],yt=i("5530"),wt=(i("fb6a"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-group",[i("v-rect",{attrs:{config:t.rectConfig},on:{click:function(e){return t.$emit("click",e,t.trainPathNode)},mousemove:t.onRectMouseMove,mousedown:function(e){return t.$emit("mousedown",e,t.trainPathNode)},dblclick:t.onRectDoubleClick}}),t.labelEnabled?i("v-text",{attrs:{config:t.labelConfig}}):t._e()],1)}),kt=[],xt=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(d["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"rectConfig",get:function(){var t=this.viewConfig.selectedTrainPathMarkerWidth*this.context.subScale;return{x:this.context.getXByTime(this.trainPathNode.time)-.5*t,y:this.context.getYByRelY(this.trainPathNode.relY)-.5*t,width:t,height:t,fill:this.trainPathNode.stev.train.color||this.viewConfig.trainPathColor}}},{key:"labelEnabled",get:function(){var t=this.trainPathNode;return"track"!=t.phase||!(t.stev.station.expanded&&(t.stev.prev&&t.stev.prev.station!=t.stev.station||t.stev.next&&t.stev.next.station!=t.stev.station))}},{key:"labelConfig",get:function(){var t=this.getLabelPosition();return{x:this.context.getXByTime(this.trainPathNode.time)+t.x-this.viewConfig.markerLabelFontSize*this.context.subScale*8,y:this.context.getYByRelY(this.trainPathNode.relY)+t.y-this.viewConfig.markerLabelLineHeight*this.context.subScale,width:this.viewConfig.markerLabelFontSize*this.context.subScale*8,height:this.viewConfig.markerLabelLineHeight*this.context.subScale,text:st(this.trainPathNode.time,null!=this.viewState.pointerPreciseState),fontSize:this.viewConfig.pointerLabelFontSize*this.context.subScale,fontFamily:this.viewConfig.fontFamily,fill:this.trainPathNode.stev.train.color||this.viewConfig.trainPathColor,align:"right",verticalAlign:"bottom",listening:!1}}},{key:"getLabelPosition",value:function(){var t=this.trainPathNode.stev,e=t.prev,i=t.next;if(e&&e.track!=t.track&&("arr"==this.trainPathNode.phase||!i||i.track==t.track)){var n=e.station.mileage<t.station.mileage?t.station.topRelY:t.station.bottomRelY,a=e.station.mileage<t.station.mileage?e.station.bottomRelY:e.station.topRelY,o=n==a?0:-this.viewConfig.markerLabelLineHeight*((t.time-e.time)*this.context.xPhysScale)/Math.abs(n-a);return{x:Math.max(o,-this.viewConfig.markerLabelMaxDistance),y:e.station.mileage<t.station.mileage?0:this.viewConfig.markerLabelLineHeight*this.context.subScale}}return{x:0,y:i&&i.station.mileage<t.station.mileage||e&&e.station.mileage>t.station.mileage?0:this.viewConfig.markerLabelLineHeight*this.context.subScale}}},{key:"onRectMouseMove",value:function(){this.viewState.pointerTargetTrainPath={train:this.trainPathNode.stev.train,stevRange:{from:this.trainPathNode.stev,to:this.trainPathNode.stev}}}},{key:"onRectDoubleClick",value:function(){if(this.viewState.editMode)if(this.viewState.drawingState)this.viewState.drawingState=null,this.viewState.trainSelections={};else{var t=this.trainPathNode;t.stev.next&&t.stev.prev||(this.viewState.drawingState={train:t.stev.train,lastStev:t.stev,direction:t.stev.next||t.stev.prev?t.stev.next?-1:1:0,stableEnd:t.stev,floating:null},this.viewState.trainSelections[t.stev.train.id].stevRange=null)}}}]),i}(p["e"]);Object(f["a"])([Object(p["b"])()],xt.prototype,"context",void 0),Object(f["a"])([Object(p["c"])()],xt.prototype,"trainPathNode",void 0),xt=Object(f["a"])([p["a"]],xt);var Ct=xt,Tt=Ct,Ot=Object(G["a"])(Tt,wt,kt,!1,null,"20b90a54",null),Pt=Ot.exports,jt=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){var t;return Object(u["a"])(this,i),t=e.apply(this,arguments),t.dragState=null,t}return Object(d["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"trainNameLabelConfig",get:function(){var t=this.viewState.trainSelections[this.train.id];return Object(yt["a"])(Object(yt["a"])({ref:"train-name-label-".concat(this.train.id),visible:!this.viewState.trainInfoEditorTarget&&(0==Object.keys(this.viewState.trainSelections).length||!!t&&!this.viewState.controlKeyPressed),text:this.trainNameLabelText},this.trainNameLabelRect),{},{fontSize:this.viewConfig.trainNameLabelFontSize*this.context.subScale,fontFamily:this.viewConfig.fontFamily,fill:this.train.color||this.viewConfig.trainPathColor})}},{key:"trainNameLabelText",get:function(){return this.train.name||"#".concat(this.train.id)}},{key:"trainNameLabelRect",get:function(){var t,e,i,n=this.trainNameLabelText,a=this.viewConfig.trainNameLabelFontSize*this.context.subScale,o=this.viewConfig.trainNameLabelLineHeight*this.context.subScale,r=ht(n,this.viewConfig.fontFamily,a),s=null!==(t=this.viewState.trainPathDragState)&&void 0!==t&&t.targets[this.train.id]&&this.viewState.controlKeyPressed?this.selectedTrainPathNodes:this.regularTrainPathNodes,c=null!==(e=s.find((function(t,e){return e<s.length-1&&s[e+1].stev.station!=t.stev.station})))&&void 0!==e?e:s[0],l=NaN,h=Object(m["a"])(s.slice(s.indexOf(c)+1));try{for(h.s();!(i=h.n()).done;){var u=i.value,d=u.x-c.x,v=u.y-c.y,g=0!=d?v/d:Math.sign(v)*(1/0);if((isNaN(l)||Math.sign(g)==Math.sign(l)&&Math.abs(g)<Math.abs(l))&&(l=g),Math.hypot(d,v)>=r)break}}catch(w){h.e(w)}finally{h.f()}if(isNaN(l))return{x:c.x,y:c.y,rotation:0,width:r,height:a};var f=Math.sqrt(1/(1+l*l)),p=0!=f?f*l:1,S=l>=0?p*a+c.x:-p*(o-a)+c.x,b=l>=0?-f*a+c.y:f*(o-a)+c.y,y=Math.atan(l)/Math.PI*180;return{x:S,y:b,rotation:y,width:r,height:a}}},{key:"regularTrainPathConfig",get:function(){var t,e=null!==(t=this.train.lineWidth)&&void 0!==t?t:this.viewConfig.trainPathWidth;return{points:this.regularTrainPathNodes.flatMap((function(t){return[t.x,t.y]})),stroke:this.train.color||this.viewConfig.trainPathColor,opacity:Object.keys(this.viewState.trainSelections).length>0?this.viewConfig.unselectedTrainPathOpacity:1,strokeWidth:e,hitStrokeWidth:Math.max(e,2*this.viewConfig.minHitWidth)}}},{key:"regularTrainPathNodes",get:function(){var t=this.getTrainPathNodes(),e=this.viewState.trainPathDragState,i=null===e||void 0===e?void 0:e.targets[this.train.id];if(e&&i&&!this.viewState.controlKeyPressed){var n,a=!i.stevRange,o=Object(m["a"])(t);try{for(o.s();!(n=o.n()).done;){var r,s,c,l=n.value;l.stev!=(null===(r=i.stevRange)||void 0===r?void 0:r.from)&&l.stev!=(null===(s=i.stevRange)||void 0===s?void 0:s.to)||(a=!0),a&&(l.time+=e.timeShift,l.x=this.context.getXByTime(l.time)),l.stev==(null===(c=i.stevRange)||void 0===c?void 0:c.to)&&(a=!1)}}catch(h){o.e(h)}finally{o.f()}}return t}},{key:"selectedTrainPathEnabled",get:function(){return null!=this.viewState.trainSelections[this.train.id]}},{key:"selectedTrainPathConfig",get:function(){var t,e=(null!==(t=this.train.lineWidth)&&void 0!==t?t:this.viewConfig.trainPathWidth)+(this.viewConfig.selectedTrainPathWidthScale-1);return{points:this.selectedTrainPathNodes.flatMap((function(t){return[t.x,t.y]})),stroke:this.train.color||this.viewConfig.trainPathColor,strokeWidth:e,hitStrokeWidth:Math.max(e,2*this.viewConfig.minHitWidth)}}},{key:"selectedTrainPathNodes",get:function(){var t,e,i,n=null!==(t=null===(e=this.viewState.trainPathDragState)||void 0===e||null===(i=e.targets[this.train.id])||void 0===i?void 0:i.stevRange)&&void 0!==t?t:this.viewState.trainSelections[this.train.id].stevRange,a=!n,o=this.getTrainPathNodes().filter((function(t){t.stev!=(null===n||void 0===n?void 0:n.from)&&t.stev!=(null===n||void 0===n?void 0:n.to)||(a=!0);var e=a;return t.stev==(null===n||void 0===n?void 0:n.to)&&(a=!1),e}));if(this.viewState.trainPathDragState){var r,s=Object(m["a"])(o);try{for(s.s();!(r=s.n()).done;){var c=r.value;c.time+=this.viewState.trainPathDragState.timeShift,c.x=this.context.getXByTime(c.time)}}catch(l){s.e(l)}finally{s.f()}}return o}},{key:"getTrainPathNodes",value:function(){var t=this;return this.train.getTrainPathNodes().map((function(e){return Object(yt["a"])(Object(yt["a"])({},e),{},{x:t.context.getXByTime(e.time),y:t.context.getYByRelY(e.relY)})}))}},{key:"onTrainNameLabelClick",value:function(t){t.target==t.currentTarget&&(this.viewState.editMode&&this.viewState.trainSelections[this.train.id]&&!this.viewState.trainSelections[this.train.id].stevRange?(this.viewState.trainInfoEditorTarget={train:this.train,x:this.trainNameLabelRect.x,y:this.trainNameLabelRect.y,verticalAlign:this.trainNameLabelRect.rotation>=0?"top":"bottom"},this.$emit("trainInfoEditStart")):(t.evt.shiftKey||(this.viewState.trainSelections={}),this.$set(this.viewState.trainSelections,this.train.id,{train:this.train,stevRange:null})))}},{key:"onTrainPathMouseMove",value:function(){this.viewState.pointerTargetTrainPath=null}},{key:"onSelectedTrainPathMouseMove",value:function(t){this.viewState.pointerTargetTrainPath={train:this.train,stevRange:this.getPointedStevRange(t.evt.clientX,t.evt.clientY)}}},{key:"onTrainPathClick",value:function(t){var e=this.getPointedStevRange(t.evt.clientX,t.evt.clientY);this.changeTrainSelections(t,e,!1)}},{key:"onSelectedTrainPathClick",value:function(t){var e=this.getPointedStevRange(t.evt.clientX,t.evt.clientY);this.changeTrainSelections(t,e,!0)}},{key:"onMarkerClick",value:function(t,e){var i={from:e.stev,to:e.stev};this.changeTrainSelections(t,i,!0)}},{key:"changeTrainSelections",value:function(t,e,i){var n;if((null===(n=this.viewState.trainPathDragState)||void 0===n||!n.dragging)&&!this.viewState.drawingState){var a=this.viewState.trainSelections[this.train.id];if(t.evt.shiftKey||(this.viewState.trainSelections=a?Object(N["a"])({},this.train.id,a):{}),a){var o=a.stevRange;if(o)if(t.evt.shiftKey){var r,s=!1,c=!1,l=!1,h=Object(m["a"])(this.train.stevs);try{for(h.s();!(r=h.n()).done;){var u=r.value;s||u!=e.from||(o.from=e.from,l=!0),u==o.from&&(s=!0),u==o.to&&(c=!0),c&&u==e.to&&(o.to=e.to,l=!0)}}catch(d){h.e(d)}finally{h.f()}l||this.$delete(this.viewState.trainSelections,this.train.id)}else a.stevRange=i?e:null;else a.stevRange=e}else this.$set(this.viewState.trainSelections,this.train.id,{train:this.train,stevRange:null})}}},{key:"onTrainPathTap",value:function(){this.viewState.trainSelections=Object(N["a"])({},this.train.id,{train:this.train,stevRange:null})}},{key:"getPointedStevRange",value:function(t,e){if(this.train.stevs.length<=2)return{from:this.train.stevs[0],to:this.train.stevs[this.train.stevs.length-1]};for(var i=0;i<this.train.stevs.length-1;++i){var n=this.train.stevs[i],a=this.train.stevs[i+1],o=this.context.getXByTime(n.time)-this.viewConfig.minHitWidth,r=this.context.getXByTime(a.time)+this.viewConfig.minHitWidth,s=this.context.getYByRelY(Math.min(n.track.relY,a.track.relY))-this.viewConfig.minHitWidth,c=this.context.getYByRelY(Math.max(n.track.relY,a.track.relY))+this.viewConfig.minHitWidth;if(o<t&&t<r&&s<e&&e<c)return{from:n,to:a}}return{from:this.train.stevs[0],to:this.train.stevs[this.train.stevs.length-1]}}},{key:"onSelectedTrainPathDoubleClick",value:function(t){if(this.viewState.editMode&&!this.viewState.drawingState){var e,i,n=this.viewState.pointerTime,a=this.getNearestStation(t.evt.clientY),o=this.getNearestStopEvent(n);if(a!=o.station||(null===(e=o.prev)||void 0===e?void 0:e.track)!=o.track&&(null===(i=o.next)||void 0===i?void 0:i.track)!=o.track){var r=this.train.stevs.findIndex((function(t){return t.time>n})),s=this.train.addNewStopEvent(new C(this.train,a.tracks[0],n),r);this.viewState.trainSelections=Object(N["a"])({},this.train.id,{train:this.train,stevRange:{from:s,to:s}})}}}},{key:"getNearestStation",value:function(t){var e,i=this.diagram.getStationsInMileageOrder(),n=this.context.getRelYByY(t),a=i[0],o=Math.abs(n-a.bottomRelY),r=Object(m["a"])(i);try{for(r.s();!(e=r.n()).done;){var s=e.value;Math.abs(n-s.topRelY)<o&&(a=s,o=Math.abs(n-s.topRelY)),Math.abs(n-s.bottomRelY)<o&&(a=s,o=Math.abs(n-s.bottomRelY))}}catch(c){r.e(c)}finally{r.f()}return a}},{key:"getNearestStopEvent",value:function(t){var e,i=this.train.stevs[0],n=Math.abs(t-i.time),a=Object(m["a"])(this.train.stevs);try{for(a.s();!(e=a.n()).done;){var o=e.value;Math.abs(t-o.time)<n&&(i=o,n=Math.abs(t-o.time))}}catch(r){a.e(r)}finally{a.f()}return i}},{key:"onSelectedTrainPathMouseDown",value:function(t){if(this.viewState.editMode){for(var e=-86400,i=86400,n=0,a=Object.values(this.viewState.trainSelections);n<a.length;n++){var o=a[n],r=o.stevRange;r&&(r.from.prev&&(e=Math.max(e,r.from.prev.time-r.from.time)),r.to.next&&(i=Math.min(i,r.to.next.time-r.to.time)))}var s=this.getPointedStevRange(t.evt.clientX,t.evt.clientY),c=s.from==s.to?[s.from]:s.from.track==s.to.track?[s.from,s.to]:null,l=this.selectedTrainPathNodes[0];this.dragState={t0:l.time,y0:this.context.getYByRelY(l.relY),sx0:t.evt.screenX,sy0:t.evt.screenY,track0:c?c[0].track:null,minTimeShift:e,maxTimeShift:i,changeTimeTargets:null,changeTrackTargets:null!==c&&void 0!==c?c:null},this.viewState.trainPathDragState={dragging:!1,targets:this.viewState.trainSelections,timeShift:0},window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp)}}},{key:"onMarkerMouseDown",value:function(t,e){this.viewState.editMode&&(this.dragState={t0:e.time,y0:this.context.getYByRelY(e.relY),track0:e.stev.track,sx0:t.evt.screenX,sy0:t.evt.screenY,minTimeShift:e.stev.prev?e.stev.prev.time-e.time:-86400,maxTimeShift:e.stev.next?e.stev.next.time-e.time:86400,changeTimeTargets:[e.stev],changeTrackTargets:[e.stev]},this.viewState.trainPathDragState={dragging:!1,targets:Object(N["a"])({},e.stev.train.id,{train:e.stev.train,stevRange:{from:e.stev,to:e.stev}}),timeShift:0},window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp))}},{key:"onWindowMouseMove",value:function(t){var e=this;if(this.dragState&&this.viewState.trainPathDragState&&(!this.viewState.trainPathDragState.dragging&&Math.hypot(t.clientX-this.dragState.sx0,t.clientY-this.dragState.sy0)>1&&(this.viewState.trainPathDragState.dragging=!0,this.viewState.pointerY=this.dragState.y0),this.viewState.trainPathDragState.dragging&&(this.viewState.pointerPreciseState||(this.viewState.pointerTime=this.dragState.t0+60*Math.floor((t.screenX-this.dragState.sx0)/this.context.xPhysScale/60)),this.viewState.trainPathDragState.timeShift=this.viewState.controlKeyPressed?this.viewState.pointerTime-this.dragState.t0:Math.min(this.dragState.maxTimeShift,Math.max(this.dragState.minTimeShift,this.viewState.pointerTime-this.dragState.t0)),this.dragState.changeTrackTargets))){var i=this.context.getRelYByY(t.clientY),n=this.dragState.changeTrackTargets[0].station,a=n.tracks.find((function(t){return Math.abs(t.relY-i)<e.viewConfig.minHitWidth}));if(a){var o,r=Object(m["a"])(this.dragState.changeTrackTargets);try{for(r.s();!(o=r.n()).done;){var s=o.value;s.track=a}}catch(c){r.e(c)}finally{r.f()}}}}},{key:"onWindowMouseUp",value:function(){var t=this;if(this.dragState&&this.viewState.trainPathDragState){if(window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp),this.viewState.trainPathDragState.dragging){if(this.dragState.changeTrackTargets&&this.dragState.track0){var e=this.dragState.changeTrackTargets,i=this.dragState.track0,n=this.dragState.changeTrackTargets[0].track;i!=n&&this.context.history.push({this:this,undo:function(){e.forEach((function(t){return t.track=i}))},redo:function(){e.forEach((function(t){return t.track=n}))}})}var a=this.viewState.trainPathDragState.timeShift;if(0!=a)if(this.viewState.controlKeyPressed){var o=Object.values(this.viewState.trainPathDragState.targets).map((function(e){var i=e.train,n=e.stevRange?i.getStopEventsInRange(e.stevRange):i.stevs,o=t.diagram.addNewTrain();o.color=i.color,o.lineWidth=i.lineWidth;var r,s=Object(m["a"])(n);try{for(s.s();!(r=s.n()).done;){var c=r.value;o.addNewStopEvent(new C(o,c.track,c.time+a))}}catch(l){s.e(l)}finally{s.f()}return t.$delete(t.viewState.trainSelections,e.train.id),t.$set(t.viewState.trainSelections,o.id,{train:o,stevRange:null}),o}));this.context.history.push({this:this,undo:function(){o.forEach((function(e){return t.diagram.removeTrain(e)}))},redo:function(){o.forEach((function(e){return t.diagram.addNewTrain(e)}))}})}else{var r,s=null!==(r=this.dragState.changeTimeTargets)&&void 0!==r?r:Object.values(this.viewState.trainSelections).flatMap((function(t){return t.stevRange?t.train.getStopEventsInRange(t.stevRange):t.train.stevs}));s.forEach((function(t){return t.time+=a})),this.context.history.push({this:this,undo:function(){s.forEach((function(t){return t.time-=a}))},redo:function(){s.forEach((function(t){return t.time+=a}))}})}}this.viewState.trainPathDragState=null,this.dragState=null}}}]),i}(p["e"]);Object(f["a"])([Object(p["b"])()],jt.prototype,"context",void 0),Object(f["a"])([Object(p["c"])()],jt.prototype,"train",void 0),jt=Object(f["a"])([Object(p["a"])({components:{TrainPathMarker:Pt}})],jt);var Lt=jt,Mt=Lt,Yt=Object(G["a"])(Mt,St,bt,!1,null,"b058443a",null),Rt=Yt.exports,Et=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(d["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"layerConfig",get:function(){return{clip:{x:this.diagram.config.leftPaneWidth*this.context.subScale,y:this.viewConfig.topPaneHeight*this.context.subScale,width:this.viewState.viewWidth-this.diagram.config.leftPaneWidth*this.context.subScale,height:this.viewState.viewHeight-this.viewConfig.topPaneHeight*this.context.subScale}}}}]),i}(p["e"]);Object(f["a"])([Object(p["b"])()],Et.prototype,"context",void 0),Et=Object(f["a"])([Object(p["a"])({components:{TrainPathGroup:Rt}})],Et);var Nt=Et,Bt=Nt,Wt=Object(G["a"])(Bt,pt,mt,!1,null,"305d2457",null),It=Wt.exports,_t=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){var t;return Object(u["a"])(this,i),t=e.apply(this,arguments),t.stageDragState=null,t.pinchState=null,t}return Object(d["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"stageConfig",get:function(){return{width:this.viewState.viewWidth,height:this.viewState.viewHeight}}},{key:"stationsInMileageOrder",get:function(){return this.diagram.getStationsInMileageOrder()}},{key:"mounted",value:function(){window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp);var t=new W.a(this.$el);t.get("pan").set({direction:W.a.DIRECTION_ALL}),t.get("pinch").set({enable:!0}),t.on("panstart",this.onPanStart),t.on("panmove",this.onPanMove),t.on("panend",this.onPanEnd),t.on("pinchstart",this.onPinchStart),t.on("pinchmove",this.onPinchMove),t.on("pinchend",this.onPinchEnd)}},{key:"unmounted",value:function(){window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp)}},{key:"onStageMouseMove",value:function(t){var e,i=t.evt;if(this.viewState.pointerScreenX=i.screenX,this.viewState.pointerPreciseState){var n=Math.round((i.screenX-this.viewState.pointerPreciseState.sx0)/this.viewConfig.pointerPrecisePixelPerTimeUnit);this.viewState.pointerTime=n*this.diagram.config.minimumTimeUnit+this.viewState.pointerPreciseState.t0}else if(null===(e=this.viewState.trainPathDragState)||void 0===e||!e.dragging)if(this.viewState.pointerTime=60*Math.round(this.context.getTimeByX(i.clientX)/60),i.clientX>=this.diagram.config.leftPaneWidth*this.context.subScale){var a=this.findPointerTargetLine(i.clientY);a?(this.viewState.pointerTargetLine=null!==a&&void 0!==a?a:null,this.viewState.pointerY=this.context.getYByRelY(a.relY)):this.viewState.pointerTargetLine=null}else this.viewState.pointerTargetLine=null;t.target==t.currentTarget&&(this.viewState.pointerTargetTrainPath=null);var o=this.viewState.drawingState;if(o){o.direction>0?this.viewState.pointerTime=Math.max(this.viewState.pointerTime,o.lastStev.time):o.direction<0&&(this.viewState.pointerTime=Math.min(this.viewState.pointerTime,o.lastStev.time)),o.floating&&(o.train.removeStopEvent(o.floating),o.floating=null);var r=i.clientX>=this.diagram.config.leftPaneWidth*this.context.subScale?this.findPointerTargetLine(i.clientY):void 0;if(r){var s,c=null!==(s=r.track)&&void 0!==s?s:r.station.tracks[0],l=o.train.addNewStopEvent(new C(o.train,c,this.viewState.pointerTime),o.direction>0||0==o.direction&&this.viewState.pointerTime>=o.lastStev.time?void 0:0);o.floating=l}}}},{key:"findPointerTargetLine",value:function(t){var e=this,i=this.stationsInMileageOrder.find((function(i){return Math.abs(e.context.getYByRelY(i.topRelY)-t)<Math.max(.5*e.viewConfig.stationLineWidth,e.viewConfig.minHitWidth)}));if(i)return{station:i,track:null,relY:i.topRelY};var n=this.stationsInMileageOrder.find((function(i){return Math.abs(e.context.getYByRelY(i.bottomRelY)-t)<Math.max(.5*e.viewConfig.stationLineWidth,e.viewConfig.minHitWidth)}));if(n)return{station:n,track:null,relY:n.bottomRelY};var a=this.stationsInMileageOrder.find((function(i){return e.context.getYByRelY(i.topRelY)+e.viewConfig.trackLineSpan-Math.max(.5*e.viewConfig.trackLineWidth,e.viewConfig.minHitWidth)<t&&e.context.getYByRelY(i.bottomRelY)-e.viewConfig.trackLineSpan+Math.max(.5*e.viewConfig.trackLineWidth,e.viewConfig.minHitWidth)>t}));if(a){var o=a.tracks.find((function(i){return Math.abs(e.context.getYByRelY(i.relY)-t)<Math.max(.5*e.viewConfig.trackLineWidth,e.viewConfig.minHitWidth)}));if(o)return{station:a,track:o,relY:o.relY}}}},{key:"onStageClick",value:function(t){var e,i,n,a=this.viewState.drawingState;if(a){if(0==t.evt.button&&this.viewState.pointerTargetLine&&(0==a.direction&&(a.direction=this.viewState.pointerTime>=a.lastStev.time?1:-1),a.floating)){var o,r,s=a.floating.track==a.lastStev.track&&(a.direction>0&&a.lastStev.track==(null===(o=a.lastStev.prev)||void 0===o?void 0:o.track)||a.direction<0&&a.lastStev.track==(null===(r=a.lastStev.next)||void 0===r?void 0:r.track));s?(a.lastStev.time=this.viewState.pointerTime,a.train.removeStopEvent(a.floating)):a.lastStev=a.floating,a.floating=null}if(2==t.evt.button)if(a.lastStev==a.stableEnd)a.floating&&a.train.removeStopEvent(a.floating),this.viewState.drawingState=null;else{var c=a.direction>0?a.lastStev.prev:a.lastStev.next;c?(a.train.removeStopEvent(a.lastStev),a.lastStev=c):(this.$delete(this.diagram.trains,a.train.id),this.viewState.drawingState=null)}}1==t.evt.button&&this.setGlobalScale(1,t.evt.clientX,t.evt.clientY),t.target!=t.currentTarget||t.evt.ctrlKey||t.evt.shiftKey||null!==(e=this.stageDragState)&&void 0!==e&&e.dragging||null!==(i=this.viewState.trainPathDragState)&&void 0!==i&&i.dragging||this.viewState.drawingState||(this.viewState.trainSelections={}),!this.viewState.trainInfoEditorTarget||null!==(n=t.target.attrs.ref)&&void 0!==n&&n.startsWith("train-name-label")||this.$emit("trainInfoEditEnd")}},{key:"onTouchEnd",value:function(t){var e;t.target!=t.currentTarget||null!==(e=this.stageDragState)&&void 0!==e&&e.dragging||(this.viewState.trainSelections={}),this.stageDragState&&(this.stageDragState=null)}},{key:"onStageDoubleClick",value:function(t){var e=this;if(t.target==t.currentTarget&&this.viewState.drawingState){var i=this.viewState.drawingState;if(i.floating&&i.train.removeStopEvent(i.floating),i.train.stevs.length<=1)this.$delete(this.diagram.trains,i.train.id);else{var n=i.stableEnd;if(n){var a=i.train.stevs.indexOf(n),o=i.direction>0?i.train.stevs.filter((function(t,e){return e>a})):i.train.stevs.filter((function(t,e){return e<a}));i.direction>0?this.context.history.push({this:this,undo:function(){i.train.stevs.splice(a+1)},redo:function(){o.forEach((function(t){return i.train.stevs.push(t)}))}}):this.context.history.push({this:this,undo:function(){i.train.stevs.splice(0,a)},redo:function(){i.train.stevs=o.concat(i.train.stevs)}})}else this.context.history.push({this:this,undo:function(){e.$delete(e.diagram.trains,i.train.id)},redo:function(){e.$set(e.diagram.trains,i.train.id,i.train)}})}this.viewState.drawingState=null,this.viewState.trainSelections={}}else if(t.target==t.currentTarget&&this.viewState.editMode)if(t.evt.clientX>=this.diagram.config.leftPaneWidth*this.context.subScale){var r=this.viewState.pointerTargetLine;if(r&&(r.track||!r.station.expanded)){var s,c=null!==(s=r.track)&&void 0!==s?s:r.station.tracks[0],l=this.diagram.addNewTrain();l.addNewStopEvent(new C(l,c,this.viewState.pointerTime)),this.viewState.trainSelections=Object(N["a"])({},l.id,{train:l,stevRange:null}),this.viewState.drawingState={train:this.diagram.trains[l.id],lastStev:this.diagram.trains[l.id].stevs[0],direction:0,stableEnd:null,floating:null}}}else{var h=this.context.getRelYByY(t.evt.clientY),u=this.stationsInMileageOrder.reverse().find((function(t){return t.topRelY<h})),d=u?(h-u.bottomRelY)/this.context.yPhysScale+u.mileage:h/this.context.yPhysScale,v=this.diagram.addNewStation();v.mileage=d,this.context.updateY(),this.context.history.push({this:this,undo:function(){e.$delete(e.diagram.stations,v.id),e.context.updateY()},redo:function(){e.$set(e.diagram.stations,v.id,v),e.context.updateY()}}),this.viewState.stationNameInputTarget=v,this.$emit("stationNameInputStart")}}},{key:"onStageMouseDown",value:function(t){t.target==t.currentTarget&&this.startDrag(t.evt.screenX,t.evt.screenY)}},{key:"onWindowMouseMove",value:function(t){this.moveDrag(t.screenX,t.screenY)}},{key:"onWindowMouseUp",value:function(t){this.stageDragState&&(this.moveDrag(t.screenX,t.screenY),this.stageDragState=null)}},{key:"onPanStart",value:function(t){"mouse"!=t.pointerType&&this.startDrag(t.center.x,t.center.y)}},{key:"onPanMove",value:function(t){"mouse"!=t.pointerType&&this.moveDrag(t.center.x,t.center.y)}},{key:"onPanEnd",value:function(t){"mouse"!=t.pointerType&&this.stageDragState&&this.moveDrag(t.center.x,t.center.y)}},{key:"startDrag",value:function(t,e){this.viewState.pointerPreciseState||(this.stageDragState={scrollTime0:this.diagram.config.scrollTime,scrollRelY0:this.diagram.config.scrollRelY,x0:t,y0:e,dragging:!1})}},{key:"moveDrag",value:function(t,e){this.stageDragState&&(Math.hypot(t-this.stageDragState.x0,e-this.stageDragState.y0)>1&&(this.stageDragState.dragging=!0),this.stageDragState.dragging&&(this.diagram.config.scrollTime=this.stageDragState.scrollTime0-(t-this.stageDragState.x0)/this.context.xPhysScale,this.diagram.config.scrollRelY=this.stageDragState.scrollRelY0-(e-this.stageDragState.y0),this.context.truncateScrollPosition()))}},{key:"onStageMouseWheel",value:function(t){var e=Math.pow(2,-Math.sign(t.evt.deltaY)*this.viewConfig.wheelScale);this.setGlobalScale(this.viewState.gScale*e,t.evt.clientX,t.evt.clientY),t.evt.preventDefault()}},{key:"onPinchStart",value:function(t){this.pinchState={lastScale:t.scale}}},{key:"onPinchMove",value:function(t){this.pinchState&&(this.setGlobalScale(this.viewState.gScale*t.scale/this.pinchState.lastScale,t.center.x,t.center.y),this.pinchState.lastScale=t.scale)}},{key:"onPinchEnd",value:function(t){this.pinchState&&(this.onPinchMove(t),this.pinchState=null)}},{key:"setGlobalScale",value:function(t,e,i){var n=this.context.getTimeByX(e),a=this.context.getRelYByY(i)/this.viewState.gScale;this.viewState.gScale=t,this.context.updateY(),this.diagram.config.scrollTime-=this.context.getTimeByX(e)-n,this.diagram.config.scrollRelY-=this.context.getRelYByY(i)-a*this.viewState.gScale,this.context.truncateScrollPosition()}},{key:"onKeyDown",value:function(t){var e=this;if(!t.repeat&&("Alt"==t.key&&(this.viewState.pointerPreciseState={sx0:this.viewState.pointerScreenX,t0:this.viewState.pointerTime}),"Control"==t.key&&(this.viewState.controlKeyPressed=!0),"Delete"==t.key&&this.viewState.editMode&&!this.viewState.busy)){for(var i=[],n=[],a=0,o=Object.values(this.viewState.trainSelections);a<o.length;a++){var r=o[a];if(r.stevRange){var s=r.train.stevs.indexOf(r.stevRange.from),c=r.train.stevs.indexOf(r.stevRange.to),l=c-s+1;if(l>=r.train.stevs.length-1)i.push(r.train);else for(var h=s;h<=c;++h)n.push({stev:r.train.stevs[h],index:h})}else i.push(r.train)}i.forEach((function(t){return e.$delete(e.diagram.trains,t.id)})),n.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)})),this.context.history.push({this:this,undo:function(){n.forEach((function(t){return t.stev.train.addNewStopEvent(t.stev,t.index)})),i.forEach((function(t){return e.$set(e.diagram.trains,t.id,t)}))},redo:function(){i.forEach((function(t){return e.$delete(e.diagram.trains,t.id)})),n.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)}))}}),this.viewState.trainSelections={}}}},{key:"onKeyUp",value:function(t){"Alt"==t.key&&(this.viewState.pointerPreciseState=null),"Control"==t.key&&(this.viewState.controlKeyPressed=!1)}},{key:"onContextMenu",value:function(t){return t.evt.preventDefault(),!1}}]),i}(p["e"]);Object(f["a"])([Object(p["b"])()],_t.prototype,"context",void 0),_t=Object(f["a"])([Object(p["a"])({components:{BackLayer:at,Pointer:ft,TrainPathLayer:It}})],_t);var $t=_t,Dt=$t,Ht=Object(G["a"])(Dt,R,E,!1,null,"b4da4416",null),zt=Ht.exports,Ft=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.viewState.editMode&&t.station.expanded&&t.isBottomLineIntersectingPlotPane?i("b-icon",{style:t.style,attrs:{icon:"plus",size:"is-small"},nativeOn:{click:function(e){return t.onClick(e)}}}):t._e()},Xt=[],Jt=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(d["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"style",get:function(){return{left:"".concat((this.diagram.config.leftPaneWidth-this.viewConfig.stationLabelRightMargin)*this.context.subScale,"px"),top:"".concat(this.context.getYByRelY(this.station.bottomRelY)-this.viewConfig.trackLineSpan,"px"),height:"".concat(this.viewConfig.trackLineSpan,"px")}}},{key:"isBottomLineIntersectingPlotPane",get:function(){return this.context.getYByRelY(this.station.bottomRelY)>=this.viewConfig.topPaneHeight*this.context.subScale&&this.context.getYByRelY(this.station.bottomRelY)<this.viewState.viewHeight}},{key:"onClick",value:function(){var t=this;if(!this.viewState.inputEnabled){var e=this.station.addNewTrack();this.context.updateY(),this.context.history.push({this:this,undo:function(){t.station.removeTrack(e),t.context.updateY()},redo:function(){t.station.addNewTrack(e),t.context.updateY()}}),this.viewState.trackNameInputTarget=e,this.$emit("trackNameInputStart")}}}]),i}(p["e"]);Object(f["a"])([Object(p["b"])()],Jt.prototype,"context",void 0),Object(f["a"])([Object(p["c"])()],Jt.prototype,"station",void 0),Jt=Object(f["a"])([p["a"]],Jt);var Gt=Jt,Ut=Gt,At=Object(G["a"])(Ut,Ft,Xt,!1,null,"624f8972",null),Kt=At.exports,Vt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.isBottomLineIntersectingPlotPane?i("b-icon",{style:t.style,attrs:{icon:t.icon,size:"is-small"},nativeOn:{click:function(e){return t.onClick(e)}}}):t._e()},qt=[],Qt=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(d["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"icon",get:function(){return this.station.expanded?"chevron-up":"chevron-down"}},{key:"style",get:function(){return{left:"".concat(this.viewConfig.stationLabelLeftMargin*this.context.subScale,"px"),top:"".concat(this.context.getYByRelY(this.station.bottomRelY),"px"),height:"".concat(this.viewConfig.trackLineSpan,"px")}}},{key:"isBottomLineIntersectingPlotPane",get:function(){return this.context.getYByRelY(this.station.bottomRelY)>=this.viewConfig.topPaneHeight*this.context.subScale&&this.context.getYByRelY(this.station.bottomRelY)<this.viewState.viewHeight}},{key:"onClick",value:function(){this.viewState.inputEnabled||(this.station.expanded=!this.station.expanded,this.context.updateY())}}]),i}(p["e"]);Object(f["a"])([Object(p["b"])()],Qt.prototype,"context",void 0),Object(f["a"])([Object(p["c"])()],Qt.prototype,"station",void 0),Qt=Object(f["a"])([p["a"]],Qt);var Zt=Qt,te=Zt,ee=Object(G["a"])(te,Vt,qt,!1,null,"876ffa9c",null),ie=ee.exports,ne=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("input",{directives:[{name:"show",rawName:"v-show",value:t.viewState.stationNameInputTarget,expression:"viewState.stationNameInputTarget"}],style:t.style,domProps:{value:t.targetStation.name},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onComplete(e)},blur:t.onComplete}})},ae=[],oe=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(d["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"targetStation",get:function(){var t;return null!==(t=this.viewState.stationNameInputTarget)&&void 0!==t?t:{}}},{key:"style",get:function(){return{left:"".concat(this.viewConfig.stationLabelLeftMargin*this.context.subScale,"px"),top:"".concat(this.context.getYByRelY(this.targetStation.topRelY)-this.viewConfig.stationLabelFontSize*this.context.subScale-4,"px"),width:"".concat((this.diagram.config.leftPaneWidth-this.viewConfig.stationLabelLeftMargin-this.viewConfig.stationLabelRightMargin)*this.context.subScale,"px"),height:"".concat(this.viewConfig.stationLabelFontSize*this.context.subScale+4,"px"),paddingTop:"2px",lineHeight:"".concat(this.viewConfig.stationLabelFontSize*this.context.subScale,"px"),border:"none",fontSize:"".concat(this.viewConfig.stationLabelFontSize*this.context.subScale,"px")}}},{key:"onComplete",value:function(){var t=this.targetStation,e=this.targetStation.name,i=this.$el.value;e!=i&&(t.name=i,this.context.history.push({this:this,undo:function(){t.name=e},redo:function(){t.name=i}})),this.viewState.stationNameInputTarget=null}}]),i}(p["e"]);Object(f["a"])([Object(p["b"])()],oe.prototype,"context",void 0),oe=Object(f["a"])([p["a"]],oe);var re=oe,se=re,ce=Object(G["a"])(se,ne,ae,!1,null,"e1d1587e",null),le=ce.exports,he=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.viewState.editMode&&t.isTopLineIntersectingPlotPane?i("b-icon",{style:t.style,attrs:{icon:"close",size:"is-small"},nativeOn:{click:function(e){return t.onClick(e)}}}):t._e()},ue=[],de=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(d["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"style",get:function(){return{left:"".concat((this.diagram.config.leftPaneWidth-this.viewConfig.stationLabelRightMargin)*this.context.subScale,"px"),top:"".concat(this.context.getYByRelY(this.station.topRelY)-this.viewConfig.trackLineSpan,"px"),height:"".concat(this.viewConfig.trackLineSpan,"px")}}},{key:"isTopLineIntersectingPlotPane",get:function(){return this.context.getYByRelY(this.station.topRelY)>=this.viewConfig.topPaneHeight*this.context.subScale&&this.context.getYByRelY(this.station.topRelY)<this.viewState.viewHeight}},{key:"onClick",value:function(){var t=this;if(!this.viewState.busy){for(var e=[],i=[],n=0,a=Object.values(this.diagram.trains);n<a.length;n++)for(var o=a[n],r=0;r<o.stevs.length;++r){var s=o.stevs[r];s.station==this.station&&(i.push({stev:s,index:r}),o.stevs.length<=1&&e.push(o))}i.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)})),e.forEach((function(e){return t.diagram.removeTrain(e)})),this.$delete(this.diagram.stations,this.station.id),this.context.updateY(),this.context.history.push({this:this,undo:function(){t.$set(t.diagram.stations,t.station.id,t.station),e.forEach((function(e){return t.diagram.addNewTrain(e)})),i.forEach((function(t){return t.stev.train.addNewStopEvent(t.stev,t.index)})),t.context.updateY()},redo:function(){i.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)})),e.forEach((function(e){return t.diagram.removeTrain(e)})),t.$delete(t.diagram.stations,t.station.id),t.context.updateY()}})}}}]),i}(p["e"]);Object(f["a"])([Object(p["b"])()],de.prototype,"context",void 0),Object(f["a"])([Object(p["c"])()],de.prototype,"station",void 0),de=Object(f["a"])([p["a"]],de);var ve=de,ge=ve,fe=Object(G["a"])(ge,he,ue,!1,null,"491e6f01",null),pe=fe.exports,me=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.viewState.editMode&&t.station.expanded&&Object.values(t.station.tracks).length>1&&t.isLineIntersectingPlotPane?i("b-icon",{style:t.style,attrs:{icon:"close",size:"is-small"},nativeOn:{click:function(e){return t.onClick(e)}}}):t._e()},Se=[],be=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(d["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"style",get:function(){return{left:"".concat((this.diagram.config.leftPaneWidth-this.viewConfig.stationLabelRightMargin)*this.context.subScale,"px"),top:"".concat(this.context.getYByRelY(this.track.relY)-this.viewConfig.trackLineSpan,"px"),height:"".concat(this.viewConfig.trackLineSpan,"px")}}},{key:"isLineIntersectingPlotPane",get:function(){return this.context.getYByRelY(this.track.relY)>=this.viewConfig.topPaneHeight*this.context.subScale&&this.context.getYByRelY(this.track.relY)<this.viewState.viewHeight}},{key:"onClick",value:function(){var t=this;if(!this.viewState.busy){for(var e=[],i=[],n=0,a=Object.values(this.diagram.trains);n<a.length;n++)for(var o=a[n],r=0;r<o.stevs.length;++r){var s=o.stevs[r];s.track==this.track&&(i.push({stev:s,index:r}),o.stevs.length<=1&&e.push(o))}var c=this.station.tracks.indexOf(this.track);i.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)})),e.forEach((function(e){return t.diagram.removeTrain(e)})),this.station.removeTrack(this.track),this.context.updateY(),this.context.history.push({this:this,undo:function(){t.station.addNewTrack(t.track,c),e.forEach((function(e){return t.diagram.addNewTrain(e)})),i.forEach((function(t){return t.stev.train.addNewStopEvent(t.stev,t.index)})),t.context.updateY()},redo:function(){i.forEach((function(t){return t.stev.train.removeStopEvent(t.stev)})),e.forEach((function(e){return t.diagram.removeTrain(e)})),t.station.removeTrack(t.track),t.context.updateY()}})}}}]),i}(p["e"]);Object(f["a"])([Object(p["b"])()],be.prototype,"context",void 0),Object(f["a"])([Object(p["c"])()],be.prototype,"station",void 0),Object(f["a"])([Object(p["c"])()],be.prototype,"track",void 0),be=Object(f["a"])([p["a"]],be);var ye=be,we=ye,ke=Object(G["a"])(we,me,Se,!1,null,"5b79c832",null),xe=ke.exports,Ce=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("input",{directives:[{name:"show",rawName:"v-show",value:t.viewState.trackNameInputTarget,expression:"viewState.trackNameInputTarget"}],style:t.style,domProps:{value:t.targetTrack.name},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onComplete(e)},blur:t.onComplete}})},Te=[],Oe=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(d["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"targetTrack",get:function(){var t;return null!==(t=this.viewState.trackNameInputTarget)&&void 0!==t?t:{}}},{key:"style",get:function(){return this.viewState.trackNameInputTarget?{left:"".concat((this.viewConfig.stationLabelLeftMargin+this.viewConfig.trackLabelLeftMargin)*this.context.subScale,"px"),top:"".concat(this.context.getYByRelY(this.targetTrack.relY)-this.viewConfig.stationLabelFontSize*this.context.subScale-4,"px"),width:"".concat((this.diagram.config.leftPaneWidth-this.viewConfig.stationLabelLeftMargin-this.viewConfig.trackLabelLeftMargin-this.viewConfig.stationLabelRightMargin)*this.context.subScale,"px"),height:"".concat(this.viewConfig.stationLabelFontSize*this.context.subScale+4,"px"),paddingTop:"2px",lineHeight:"".concat(this.viewConfig.stationLabelFontSize*this.context.subScale,"px"),border:"none",fontSize:"".concat(this.viewConfig.stationLabelFontSize*this.context.subScale,"px")}:{}}},{key:"onComplete",value:function(){var t=this.targetTrack,e=t.name,i=this.$el.value;e!=i&&(t.name=i,this.context.history.push({this:this,undo:function(){t.name=e},redo:function(){t.name=i}})),this.viewState.trackNameInputTarget=null}}]),i}(p["e"]);Object(f["a"])([Object(p["b"])()],Oe.prototype,"context",void 0),Oe=Object(f["a"])([p["a"]],Oe);var Pe=Oe,je=Pe,Le=Object(G["a"])(je,Ce,Te,!1,null,"7dff0a42",null),Me=Le.exports,Ye=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"train-info-editor-group"},[i("div",{ref:"trainInfoEditorBox",staticClass:"train-info-editor-box box",style:t.trainInfoEditorBoxStyle},[i("input",{ref:"trainNameInput",staticClass:"train-name-input",style:t.trainNameInputStyle,domProps:{value:t.targetTrain.name},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onComplete(e)},blur:t.onBlur}}),i("span",{ref:"colorPickerTrigger",staticClass:"color-picker picker",style:{background:t.targetTrain.color||t.viewConfig.trainPathColor},on:{click:t.onColorPickerTriggerClick}}),i("span",{ref:"lineWidthPickerTrigger",staticClass:"line-width-picker picker",on:{click:t.onLineWidthPickerTriggerClick}},[i("span",{staticClass:"line-width-picker-preview",style:{background:t.targetTrain.color||t.viewConfig.trainPathColor,height:t.getDispLineWidthByValue(t.targetTrain.lineWidth||t.viewConfig.trainPathWidth)+"px"}})])]),i("div",{staticClass:"color-picker-box picker-box box",style:t.colorPickerBoxStyle},[i("div",[i("span",{staticClass:"color-picker picker",staticStyle:{background:"#000"},on:{click:function(e){return t.onColorPickerClick("#000")}}})]),i("div",t._l(t.colorPickerColors,(function(e,n){return i("span",{key:"train-path-color-picker-"+n,staticClass:"color-picker picker",style:{background:e},on:{click:function(i){return t.onColorPickerClick(e)}}})})),0)]),i("div",{staticClass:"line-width-picker-box picker-box box",style:t.lineWidthPickerBoxStyle},[i("div",t._l(t.lineWidthPickerValues,(function(e,n){return i("span",{key:"train-path-line-width-picker-"+n,staticClass:"line-width-picker picker",on:{click:function(i){return t.onLineWidthPickerClick(e.value)}}},[i("span",{staticClass:"line-width-picker-preview",style:{background:t.targetTrain.color||t.viewConfig.trainPathColor,height:e.disp+"px"}})])})),0)])])},Re=[],Ee=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){var t;return Object(u["a"])(this,i),t=e.apply(this,arguments),t.pickerMode="none",t}return Object(d["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"targetTrain",get:function(){var t,e;return null!==(t=null===(e=this.viewState.trainInfoEditorTarget)||void 0===e?void 0:e.train)&&void 0!==t?t:{}}},{key:"trainInfoEditorBoxTop",get:function(){var t,e=this.viewState.trainInfoEditorTarget;return e?e.y+("bottom"==e.verticalAlign&&null!==(t=-this.$refs.trainInfoEditorBox.clientHeight)&&void 0!==t?t:0):this.viewState.viewHeight}},{key:"trainInfoEditorBoxStyle",get:function(){var t=this.viewState.trainInfoEditorTarget;return t?{left:"".concat(t.x,"px"),top:"".concat(this.trainInfoEditorBoxTop,"px")}:{top:"".concat(this.viewState.viewHeight,"px")}}},{key:"trainNameInputStyle",get:function(){return this.viewState.trainInfoEditorTarget?{lineHeight:"".concat(this.viewConfig.stationLabelFontSize,"px"),fontSize:"".concat(this.viewConfig.stationLabelFontSize,"px")}:{}}},{key:"colorPickerBoxStyle",get:function(){var t=this.viewState.trainInfoEditorTarget;return t&&"color"==this.pickerMode?{left:"calc(".concat(t.x+this.$refs.colorPickerTrigger.offsetLeft,"px - 0.5rem)"),top:"".concat(this.trainInfoEditorBoxTop+this.$refs.trainInfoEditorBox.clientHeight,"px")}:{top:"".concat(this.viewState.viewHeight,"px")}}},{key:"colorPickerColors",get:function(){return["#ce1a34","#dd7d15","#ceae0f","#298e30","#2d75bc","#790894"]}},{key:"lineWidthPickerBoxStyle",get:function(){var t=this.viewState.trainInfoEditorTarget;return t&&"lineWidth"==this.pickerMode?{left:"calc(".concat(t.x+this.$refs.lineWidthPickerTrigger.offsetLeft,"px - 0.5rem)"),top:"".concat(this.trainInfoEditorBoxTop+this.$refs.trainInfoEditorBox.clientHeight,"px")}:{top:"".concat(this.viewState.viewHeight,"px")}}},{key:"getDispLineWidthByValue",value:function(t){var e,i;return null!==(e=null===(i=this.lineWidthPickerValues.find((function(e){return e.value==t})))||void 0===i?void 0:i.disp)&&void 0!==e?e:t}},{key:"lineWidthPickerValues",get:function(){return[{value:1,disp:.75},{value:2,disp:2.25}]}},{key:"onComplete",value:function(){this.onBlur(),this.viewState.trainInfoEditorTarget=null,this.pickerMode="none"}},{key:"onBlur",value:function(){var t=this.viewState.trainInfoEditorTarget;if(t){var e=this.targetTrain,i=t.train.name,n=this.$refs.trainNameInput.value;n!=i&&(t.train.name=n,this.context.history.push({this:this,undo:function(){e.name=i},redo:function(){e.name=n}}))}}},{key:"onColorPickerTriggerClick",value:function(){this.pickerMode="color"==this.pickerMode?"none":"color"}},{key:"onLineWidthPickerTriggerClick",value:function(){this.pickerMode="lineWidth"==this.pickerMode?"none":"lineWidth"}},{key:"onColorPickerClick",value:function(t){var e=this.targetTrain,i=e.color;e.color=t,this.context.history.push({this:this,undo:function(){e.color=i},redo:function(){e.color=t}})}},{key:"onLineWidthPickerClick",value:function(t){var e=this.targetTrain,i=e.lineWidth;e.lineWidth=t,this.context.history.push({this:this,undo:function(){e.lineWidth=i},redo:function(){e.lineWidth=t}})}}]),i}(p["e"]);Object(f["a"])([Object(p["b"])()],Ee.prototype,"context",void 0),Ee=Object(f["a"])([p["a"]],Ee);var Ne=Ee,Be=Ne,We=(i("146d"),Object(G["a"])(Be,Ye,Re,!1,null,"29c65084",null)),Ie=We.exports,_e=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return Object(d["a"])(i,[{key:"diagram",get:function(){return this.context.diagram}},{key:"viewConfig",get:function(){return this.context.config}},{key:"viewState",get:function(){return this.context.state}},{key:"mounted",value:function(){var t=new ResizeObserver(this.updateViewSize);t.observe(this.$el)}},{key:"onStationNameInputStart",value:function(){var t=this;this.$nextTick((function(){return t.$refs.stationNameInput.$el.focus()}))}},{key:"onTrackNameInputStart",value:function(){var t=this;this.$nextTick((function(){return t.$refs.trackNameInput.$el.focus()}))}},{key:"onTrainInfoEditStart",value:function(){var t=this;this.$nextTick((function(){return t.$refs.trainInfoEditor.$refs.trainNameInput.focus()}))}},{key:"onTrainInfoEditEnd",value:function(){this.$refs.trainInfoEditor.onComplete()}},{key:"updateViewSize",value:function(){this.$el&&(this.viewState.viewWidth=this.$el.clientWidth,this.viewState.viewHeight=this.$el.clientHeight,this.context.truncateScrollPosition())}}]),i}(p["e"]);Object(f["a"])([Object(p["c"])({default:new L}),Object(p["d"])()],_e.prototype,"context",void 0),_e=Object(f["a"])([Object(p["a"])({components:{Stage:zt,StationAddTrackButton:Kt,StationExpandButton:ie,StationNameInput:le,StationRemoveButton:pe,StationRemoveTrackButton:xe,TrackNameInput:Me,TrainInfoEditor:Ie}})],_e);var $e=_e,De=$e,He=(i("509f"),Object(G["a"])(De,M,Y,!1,null,"1d818f47",null)),ze=He.exports,Fe=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-carousel",{attrs:{autoplay:!1,"indicator-inside":!1}},[n("b-carousel-item",[n("div",{staticClass:"help-item"},[n("div",{staticClass:"help-image"},[n("img",{attrs:{src:i("c98c")}})]),n("div",{staticClass:"help-desc content"},[n("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.addNewStationTitle"))}}),n("p",{domProps:{innerHTML:t._s(t.$t("message.help.addNewStationBody"))}})])])]),n("b-carousel-item",[n("div",{staticClass:"help-item"},[n("div",{staticClass:"help-image"},[n("img",{attrs:{src:i("bfd4")}})]),n("div",{staticClass:"help-desc content"},[n("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.addNewTrainTitle"))}}),n("p",{domProps:{innerHTML:t._s(t.$t("message.help.addNewTrainBody"))}})])])]),n("b-carousel-item",[n("div",{staticClass:"help-item"},[n("div",{staticClass:"help-image"},[n("img",{attrs:{src:i("41d8")}})]),n("div",{staticClass:"help-desc content"},[n("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.selectTrainTitle"))}}),n("p",{domProps:{innerHTML:t._s(t.$t("message.help.selectTrainBody"))}})])])]),n("b-carousel-item",[n("div",{staticClass:"help-item"},[n("div",{staticClass:"help-image"},[n("img",{attrs:{src:i("07f5")}})]),n("div",{staticClass:"help-desc content"},[n("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.editTrainTitle"))}}),n("p",{domProps:{innerHTML:t._s(t.$t("message.help.editTrainBody"))}})])])]),n("b-carousel-item",[n("div",{staticClass:"help-item"},[n("div",{staticClass:"help-image"},[n("img",{attrs:{src:i("965e")}})]),n("div",{staticClass:"help-desc content"},[n("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.editTimeTitle"))}}),n("p",{domProps:{innerHTML:t._s(t.$t("message.help.editTimeBody"))}})])])]),n("b-carousel-item",[n("div",{staticClass:"help-item"},[n("img",{attrs:{src:i("60b1")}}),n("div",{staticClass:"help-desc content"},[n("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.tipsTitle"))}}),n("p",{domProps:{innerHTML:t._s(t.$t("message.help.tipsBody"))}})])])]),n("b-carousel-item",[n("div",{staticClass:"help-item"},[n("div",{staticClass:"help-desc content"},[n("h5",{staticClass:"title is-5",domProps:{innerHTML:t._s(t.$t("message.help.contactTitle"))}}),n("p",{domProps:{innerHTML:t._s(t.$t("message.help.contactBody"))}})])])])],1)},Xe=[],Je=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){return Object(u["a"])(this,i),e.apply(this,arguments)}return i}(p["e"]);Je=Object(f["a"])([p["a"]],Je);var Ge=Je,Ue=Ge,Ae=(i("6a20"),Object(G["a"])(Ue,Fe,Xe,!1,null,"6afc7d96",null)),Ke=Ae.exports,Ve=function(t){Object(v["a"])(i,t);var e=Object(g["a"])(i);function i(){var t;return Object(u["a"])(this,i),t=e.apply(this,arguments),t.context=new L,t.diagramFileName="diagram.json",t.enableSwitchEditMode=window.screen.width>=640,t.subView="none",t}return Object(d["a"])(i,[{key:"mounted",value:function(){var t=this;this.context.state.editMode=this.enableSwitchEditMode,fetch("sample-diagram.json").then(function(){var e=Object(h["a"])(regeneratorRuntime.mark((function e(i){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i.json();case 2:n=e.sent,t.context.setDiagram(O.fromJSON(n)),t.diagramFileName="sample-diagram.json";case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"onEditButtonClick",value:function(){this.context.state.editMode=!this.context.state.editMode}},{key:"onUndoButtonClick",value:function(){this.context.history.undo()}},{key:"onRedoButtonClick",value:function(){this.context.history.redo()}},{key:"onVanishButtonClick",value:function(){var t=this;if(Object.keys(this.context.diagram.trains).length>0){var e=this.context.diagram.trains;this.context.history.push({this:this,undo:function(){t.context.diagram.trains=e},redo:function(){t.context.diagram.trains={}}}),this.context.diagram.trains={}}else{var i=this.context.diagram;this.context.history.push({this:this,undo:function(){t.context.setDiagram(i)},redo:function(){t.context.setDiagram(O.fromJSON({stations:{},trains:{}}))}}),this.context.setDiagram(O.fromJSON({stations:{},trains:{}}))}}},{key:"onUploadButtonClick",value:function(){var t=this,e=document.createElement("input");e.type="file",e.accept=".json, application/json",e.onchange=function(){var i=new FileReader;if(e.files&&e.files.length>0){var n=e.files[0];i.readAsText(n),i.onload=function(){if("string"==typeof i.result)try{var e=JSON.parse(i.result);t.context.setDiagram(O.fromJSON(e)),t.diagramFileName=n.name,t.context.history.clear()}catch(a){t.$buefy.notification.open({type:"is-danger",message:"".concat(t.$t("message.failedToLoadJSON").toString(),"<br>").concat(n.name)})}}}},e.click()}},{key:"onDownloadButtonClick",value:function(){var t=JSON.stringify(this.context.diagram),e=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(e),n=document.createElement("a");n.href=i,n.download=this.diagramFileName,n.click()}},{key:"onHelpButtonClick",value:function(){this.subView="help"==this.subView?"none":"help"}}]),i}(p["e"]);Ve=Object(f["a"])([Object(p["a"])({components:{DiagramView:ze,HelpView:Ke}})],Ve);var qe=Ve,Qe=qe,Ze=(i("5c0b"),Object(G["a"])(Qe,c,l,!1,null,null,null)),ti=Ze.exports,ei={ja:{message:{failedToLoadJSON:"ファイルの読み込みに失敗しました。",editButtonTooltip:"編集モード",undoButtonTooltip:"元に戻す",redoButtonTooltip:"やり直す",vanishTrainsButtonTooltip:"列車をクリア",vanishStationsButtonTooltip:"駅をクリア",uploadButtonTooltip:"ダイヤファイルを読み込む",downloadButtonTooltip:"ダイヤファイルを保存する",helpButtonTooltip:"操作方法",help:{addNewStationTitle:"駅を追加する",addNewStationBody:"<p>左側の駅名エリアをダブルクリックすると、新しい駅を追加できます。</p><ul><li>駅名をドラッグすると、駅線の位置を調整できます。<li>駅名をクリックすると、駅名を編集できます。<li>駅右側の<i class='mdi mdi-close'></i>アイコンをクリックすると、駅を削除できます。</ul>",addNewTrainTitle:"列車を追加する",addNewTrainBody:"<p>駅線の上でダブルクリックすると、新しい列車を追加できます。駅線を続けてクリックして、停車駅を順に追加できます。</p><ul><li>列車線の編集を終了するには、もう一度ダブルクリックします。<li>Altキーを押しながらカーソルを動かすと、秒単位で時刻を指定できます。<li>右クリックすると、追加した停車駅を順に削除します。</ul>",selectTrainTitle:"列車を選択する",selectTrainBody:"<p>列車線をクリックすると、列車を選択できます。</p><ul><li>Shiftキーを押しながら別の列車線をクリックすると、複数列車を選択できます。<li>列車を選択した状態でさらにクリックすると、特定の駅または駅間を選択できます。<br>Shiftキーを押しながらクリックすると、複数駅間を選択できます。</ul>",editTrainTitle:"列車を編集する",editTrainBody:"<p>列車を選択した状態では、さまざまな方法で列車を編集できます。</p><ul><li>列車線と駅線の交点をダブルクリックすると、停車駅を追加できます。<li>列車線の始端・終端をダブルクリックすると、列車線を延長できます。<li>Deleteキーを押すと、選択した区間の列車線を削除できます。</ul>",editTimeTitle:"着発時刻を変更する",editTimeBody:"<p>列車を選択した状態で列車線をドラッグすると、着発時刻を変更できます。</p><ul><li>Altキーを押しながらカーソルを動かすと、秒単位で時刻を指定できます。<li>番線線上の列車線をドラッグすると、着発番線を変更できます。<li>Ctrlキーを押しながらドラッグすると、着発時刻を変更する代わりに、<br>列車線をコピーして新しい列車を作成できます。</ul>",tipsTitle:"アイコンメニュー",tipsBody:"<ul><li><i class='mdi mdi-undo'></i><i class='mdi mdi-redo'></i>ボタンで、操作の取り消し・やり直しができます。<li><i class='mdi mdi-vanish'></i>ボタンで、列車・駅の一括削除ができます。<li><i class='mdi mdi-upload'></i><i class='mdi mdi-download'></i>ボタンで、データの読み込み・保存ができます。</ul>",contactTitle:"不明点・不具合などを見つけたら",contactBody:"<p>不明点・不具合などがありましたら、<a href='https://twitter.com/nosrithe'>@nosrithe</a> までお知らせください。</p><ul><li>お問い合わせの際は、操作の目的や再現手順を具体的にお伝えください。<li>不具合などの修正は <a href='https://github.com/nosrith/diafreaks/issues'>GitHub プロジェクト</a> で管理しています。<br>既知の不具合についてはこちらをご確認ください。</ul>"}}}};n["default"].config.productionTip=!1,n["default"].use(a["a"],{defaultNotificationDuration:5e3,defaultNotificationPosition:"is-bottom-right"}),n["default"].use(o["a"]),n["default"].use(s.a);var ii=new o["a"]({locale:"ja",messages:ei});new n["default"]({render:function(t){return t(ti)},i18n:ii}).$mount("#app")}});
//# sourceMappingURL=app.ce94c056.js.map