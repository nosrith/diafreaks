(function(t){function e(e){for(var a,o,s=e[0],d=e[1],c=e[2],h=0,g=[];h<s.length;h++)o=s[h],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&g.push(n[o][0]),n[o]=0;for(a in d)Object.prototype.hasOwnProperty.call(d,a)&&(t[a]=d[a]);l&&l(e);while(g.length)g.shift()();return r.push.apply(r,c||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],a=!0,s=1;s<i.length;s++){var d=i[s];0!==n[d]&&(a=!1)}a&&(r.splice(e--,1),t=o(o.s=i[0]))}return t}var a={},n={app:0},r=[];function o(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=a,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(i,a,function(e){return t[e]}.bind(null,a));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],d=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var l=d;r.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("cd49")},"5c0b":function(t,e,i){"use strict";i("9c0c")},"9c0c":function(t,e,i){},cd49:function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var a=i("2b0e"),n=i("289d"),r=(i("5abe"),i("a925")),o=i("7591"),s=i.n(o),d=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("div",{attrs:{id:"view-pane"}},[i("stage",{attrs:{id:"stage-pane"},on:{updateY:t.updateY,stationNameInputStart:t.onStationNameInputStart,trackNameInputStart:t.onTrackNameInputStart}}),i("div",{attrs:{id:"ui-pane"}},[i("station-name-input",{ref:"stationNameInput"}),i("track-name-input",{ref:"trackNameInput"}),t._l(Object.values(t.diagram.stations),(function(e){return i("station-expand-button",{key:"station-expand-button-"+e.id,attrs:{station:e},on:{updateY:t.updateY,trackNameInputStart:t.onTrackNameInputStart}})})),t._l(Object.values(t.diagram.stations),(function(e){return i("station-remove-button",{key:"station-remove-button-"+e.id,attrs:{station:e},on:{updateY:t.updateY}})})),t._l(Object.values(t.diagram.stations),(function(e){return i("station-add-track-button",{key:"station-add-track-button-"+e.id,attrs:{station:e},on:{updateY:t.updateY,trackNameInputStart:t.onTrackNameInputStart}})})),t._l(Object.values(t.diagram.stations),(function(e){return t._l(e.tracks,(function(a){return i("station-remove-track-button",{key:"station-remove-track-button-"+e.id+"-"+a.id,attrs:{station:e,track:a},on:{updateY:t.updateY}})}))}))],2)],1),i("b-navbar",{attrs:{id:"nav-pane",transparent:""},scopedSlots:t._u([{key:"brand",fn:function(){return[i("b-navbar-item",[t._v("Diafreaks")])]},proxy:!0},{key:"start",fn:function(){return[i("b-navbar-item",[i("b-button",{class:t.viewState.editMode?"is-selected":"",attrs:{"icon-left":"pencil-outline",size:"medium"},on:{click:t.onEditButtonClick}})],1)]},proxy:!0},{key:"end",fn:function(){return[i("b-navbar-item",[i("b-button",{attrs:{"icon-left":"upload",size:"medium"},on:{click:t.onUploadButtonClick}})],1),i("b-navbar-item",[i("b-button",{attrs:{"icon-left":"download",size:"medium"},on:{click:t.onDownloadButtonClick}})],1)]},proxy:!0}])})],1)},c=[],l=i("b85c"),h=i("d4ec"),g=i("bee2"),m=i("262e"),p=i("2caf"),u=(i("99af"),i("d3b7"),i("25f0"),i("b0c0"),i("3ca3"),i("ddb0"),i("2b3d"),i("159b"),i("07ac"),i("9ab4")),f=i("1b40"),v=i("53ca"),S=(i("7db0"),i("2af1"),i("c1f9"),i("d81d"),function(){function t(){Object(h["a"])(this,t),this.minimumTimeUnit=5,this.fontFamily="Verdana, sans-serif",this.topPaneHeight=32,this.hourlyLabelBottomMargin=4,this.hourlyLabelFontSize=16,this.hourlyLabelColor="rgb(128, 192, 128)",this.hourlyGridLineWidth=2.25,this.hourlyGridLineColor="rgb(128, 192, 128)",this.majorMinutelyGridLineSpan=600,this.majorMinutelyGridLineWidth=1.5,this.majorMinutelyGridLineColor="rgb(128, 192, 128)",this.minorMinutelyGridLineSpan=120,this.minorMinutelyGridLineWidth=.75,this.minorMinutelyGridLineColor="rgb(128, 192, 128)",this.leftPaneWidth=160,this.stationLabelLeftMargin=16,this.stationLabelRightMargin=16,this.stationLabelFontSize=16,this.stationLabelColor="rgb(128, 192, 128)",this.stationLineWidth=1,this.stationLineColor="rgb(128, 192, 128)",this.plotPaneVerticalPadding=4,this.trackLabelLeftMargin=10,this.trackLabelFontSize=12,this.trackLabelColor="rgb(128, 192, 128)",this.trackLineWidth=.75,this.trackLineColor="rgb(128, 192, 128)",this.trackLineSpan=12,this.scrollX=1728,this.scrollY=0,this.xScale=.08,this.yScale=10,this.trainPathWidth=1,this.trainPathColor="rgb(0, 0, 0)"}return Object(g["a"])(t,null,[{key:"fromJSON",value:function(e){if(!e||"object"!=Object(v["a"])(e))throw"Invalid JSON";var i=new t;return Object.assign(i,e),i}}]),t}()),b=function(){function t(e,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(h["a"])(this,t),this.id=e,this.name=i,this.relY=a}return Object(g["a"])(t,[{key:"toJSON",value:function(){return{id:this.id,name:this.name}}}],[{key:"fromJSON",value:function(e){if(!e||"object"!=Object(v["a"])(e)||null==e.id||null==e.name)throw"Invalid JSON @ Track";return new t(e.id,e.name)}}]),t}(),k=function(){function t(e,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;Object(h["a"])(this,t),this.id=e,this.name=i,this.mileage=a,this.tracks=n,this.expanded=r,this.topRelY=o,this.bottomRelY=s,this.floating=d}return Object(g["a"])(t,[{key:"toJSON",value:function(){return{id:this.id,name:this.name,mileage:this.mileage,tracks:this.tracks,expanded:this.expanded}}}],[{key:"fromJSON",value:function(e){if(!e||"object"!=Object(v["a"])(e)||null==e.id||null==e.name||null==e.mileage||!Array.isArray(e.tracks))throw"Invalid JSON @ Station";return new t(e.id,e.name,e.mileage,e.tracks.map((function(t){return b.fromJSON(t)})),e.expanded)}}]),t}(),y=function(){function t(e,i,a,n,r){Object(h["a"])(this,t),this.id=e,this.stationId=i,this.trackId=a,this.arrTime=n,this.depTime=r}return Object(g["a"])(t,null,[{key:"fromJSON",value:function(e){if(!e||"object"!=Object(v["a"])(e)||null==e.stationId||null==e.trackId||null==e.arrTime&&null==e.depTime)throw"Invalid JSON @ Stop";return new t(e.id,e.stationId,e.trackId,null!=e.arrTime?e.arrTime:e.depTime,null!=e.depTime?e.depTime:e.arrTime)}}]),t}(),w=function(){function t(e,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];Object(h["a"])(this,t),this.id=e,this.name=i,this.stops=a}return Object(g["a"])(t,[{key:"getStopEvent",value:function(t,e){var i=this.stops.find((function(e){return e.id==t}));return i?{stop:i,side:e,time:"arr"==e?i.arrTime:i.depTime}:void 0}},{key:"getStopEvents",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=[],a=null===e,n=Object(l["a"])(this.stops);try{for(n.s();!(t=n.n()).done;){var r=t.value;e&&e.fromStopId==r.id&&"arr"==e.fromStopSide&&(a=!0),a&&i.push({stop:r,side:"arr",time:r.arrTime}),e&&e.toStopId==r.id&&"arr"==e.toStopSide&&(a=!1),e&&e.fromStopId==r.id&&"dep"==e.fromStopSide&&(a=!0),a&&i.push({stop:r,side:"dep",time:r.depTime}),e&&e.toStopId==r.id&&"dep"==e.toStopSide&&(a=!1)}}catch(o){n.e(o)}finally{n.f()}return i}},{key:"getPreviousStopEvent",value:function(t,e){var i=this.stops.find((function(e){return e.id==t}));if(i){if("dep"==e)return{stop:i,side:"arr",time:i.arrTime};var a=this.stops.indexOf(i);if(0==a)return;var n=this.stops[a-1];return{stop:n,side:"dep",time:n.depTime}}}},{key:"getNextStopEvent",value:function(t,e){var i=this.stops.find((function(e){return e.id==t}));if(i){if("arr"==e)return{stop:i,side:"dep",time:i.depTime};var a=this.stops.indexOf(i);if(a==this.stops.length-1)return;var n=this.stops[a+1];return{stop:n,side:"arr",time:n.arrTime}}}}],[{key:"fromJSON",value:function(e){if(!e||"object"!=Object(v["a"])(e)||null==e.id||null==e.name||!Array.isArray(e.stops))throw"Invalid JSON @ Train";return new t(e.id,e.name,e.stops.map((function(t){return y.fromJSON(t)})))}}]),t}(),O=function(){function t(e,i,a,n){Object(h["a"])(this,t),this.config=e,this.stations=i,this.trains=a,this.maxId=n}return Object(g["a"])(t,[{key:"getYByRelY",value:function(t){return t+this.config.topPaneHeight-this.config.scrollY}},{key:"getRelYByY",value:function(t){return t-this.config.topPaneHeight+this.config.scrollY}},{key:"getXByTime",value:function(t){return t*this.config.xScale+this.config.leftPaneWidth-this.config.scrollX}},{key:"getTimeByX",value:function(t){return(t-this.config.leftPaneWidth+this.config.scrollX)/this.config.xScale}},{key:"getStationsInMileageOrder",value:function(){return Object.values(this.stations).sort((function(t,e){return t.mileage-e.mileage}))}},{key:"getTrainPathDirection",value:function(t,e,i){var a=this.trains[t];if(!a)return 0;var n=a.stops.find((function(t){return t.id==e}));if(!n)return 0;var r=this.stations[n.stationId];if(!r)return 0;var o="arr"==i?a.getPreviousStopEvent(e,"arr"):a.getNextStopEvent(e,"dep");if(o){var s=this.stations[o.stop.stationId];return s?Math.sign(s.mileage-r.mileage):0}var d="arr"==i?a.getNextStopEvent(e,"dep"):a.getPreviousStopEvent(e,"arr");if(d){var c=this.stations[d.stop.stationId];return c?Math.sign(r.mileage-c.mileage):0}return 0}},{key:"genId",value:function(){return++this.maxId}},{key:"toJSON",value:function(){return{config:this.config,stations:this.stations,trains:this.trains}}}],[{key:"fromJSON",value:function(e){if(!e||"object"!=Object(v["a"])(e)||"object"!=Object(v["a"])(e.stations)||"object"!=Object(v["a"])(e.trains))throw"Invalid JSON";for(var i=S.fromJSON(e.config||{}),a=Object.fromEntries(Object.values(e.stations).map((function(t){return[t.id,k.fromJSON(t)]}))),n=Object.fromEntries(Object.values(e.trains).map((function(t){return[t.id,w.fromJSON(t)]}))),r=e.maxId?Math.max(e.maxId,0):0,o=0,s=Object.values(a);o<s.length;o++){var d=s[o];r=Math.max(d.id,r);var c,h=Object(l["a"])(d.tracks);try{for(h.s();!(c=h.n()).done;){var g=c.value;r=Math.max(g.id,r)}}catch(O){h.e(O)}finally{h.f()}}for(var m=0,p=Object.values(n);m<p.length;m++){var u=p[m];r=Math.max(u.id,r);var f,b=Object(l["a"])(u.stops);try{for(b.s();!(f=b.n()).done;){var y=f.value;r=Math.max(y.id,r)}}catch(O){b.e(O)}finally{b.f()}}return new t(i,a,n,r)}}]),t}(),T=function t(){Object(h["a"])(this,t),this.minHitWidth=3,this.pointerWidth=3,this.pointerColor="rgb(0, 0, 0)",this.pointerOnMarkerColor="rgb(255, 0, 0)",this.pointerLabelFontSize=12,this.pointerPrecisePixelPerTimeUnit=5,this.selectedTrackLabelColor="rgb(255, 0, 0)",this.selectedTrackLineColor="rgb(255, 0, 0)",this.selectedTrainPathColor="rgb(255, 0, 0)",this.selectedTrainPathWidthScale=1.5,this.selectedTrainPathMarkerWidth=5,this.selectedTrainPathMarkerColor="rgb(255, 0, 0)",this.unselectedTrainPathOpacity=.5,this.markerLabelMaxDistance=20,this.markerLabelColor="rgb(255, 0, 0)",this.markerLabelFontSize=12,this.markerLabelLineHeight=16,this.wheelScale=1},I=function(){function t(){Object(h["a"])(this,t),this.viewWidth=0,this.viewHeight=0,this.appHeight=0,this.maxRelY=0,this.trainSelections={},this.pointerDragging=!1,this.pointerOnMarker=!1,this.pointerScreenX=0,this.pointerTime=0,this.pointerY=0,this.pointerTargetLine=null,this.pointerPreciseState=null,this.editMode=!0,this.drawingState=null,this.trainPathDragState=null,this.stationNameInputTarget=null,this.trackNameInputTarget=null,this.controlKeyPressed=!1,this.diagramFileName="diafreaks-diagram.json"}return Object(g["a"])(t,[{key:"isInputEnabled",get:function(){return null!=this.stationNameInputTarget||null!=this.trackNameInputTarget}}]),t}(),j=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.diagram?i("v-stage",{attrs:{config:t.stageConfig},on:{mousedown:t.onStageMouseDown,mousemove:t.onStageMouseMove,click:t.onStageClick,dblclick:t.onStageDoubleClick,wheel:t.onStageMouseWheel,contextmenu:t.onContextMenu}},[i("back-layer",t._g({},t.$listeners)),i("train-path-layer"),i("v-layer",[i("pointer")],1)],1):t._e()},L=[],Y=i("ade3"),P=(i("a434"),i("38cf"),i("c740"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-layer",{attrs:{id:"back-layer"}},[t._l(t.timeGridLines,(function(e){return i("v-group",{key:e.key},[i("v-line",{attrs:{config:e.lineConfig}}),e.labelConfig?i("v-text",{attrs:{config:e.labelConfig}}):t._e()],1)})),t._l(Object.values(t.diagram.stations),(function(e){return i("station-group",t._g({key:"station-"+e.id,attrs:{station:e}},t.$listeners))}))],2)}),M=[],x=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-group",[t.isTopLineIntersectingPlotPane?i("v-group",[i("v-line",{attrs:{config:t.topLineConfig}}),t._l(t.labelCharacters,(function(t){return i("v-text",{key:t.key,attrs:{config:t}})})),i("v-rect",{attrs:{config:t.labelRectConfig},on:{click:t.onStationLabelClick,mousedown:t.onStationLabelMouseDown}})],2):t._e(),t.station.expanded&&t.isBottomLineIntersectingPlotPane?i("v-line",{attrs:{config:t.bottomLineConfig}}):t._e(),t.station.expanded?t._l(t.station.tracks,(function(e){return i("track-group",t._g({key:"track-"+t.station.id+"-"+e.id,attrs:{station:t.station,track:e}},t.$listeners))})):t._e()],2)},C=[],R=(i("a630"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.isLineIntersectingPlotPane?i("v-group",[i("v-line",{attrs:{config:t.lineConfig}}),i("v-text",{attrs:{config:t.labelConfig},on:{click:t.onLabelClick}})],1):t._e()}),N=[],W=function(t){Object(m["a"])(i,t);var e=Object(p["a"])(i);function i(){return Object(h["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"lineConfig",get:function(){return{points:[this.diagram.config.stationLabelLeftMargin+this.diagram.config.trackLabelLeftMargin,this.diagram.getYByRelY(this.track.relY),this.viewState.viewWidth,this.diagram.getYByRelY(this.track.relY)],stroke:this.diagram.config.trackLineColor,strokeWidth:this.diagram.config.trackLineWidth,listening:!1}}},{key:"labelConfig",get:function(){return{id:"track-label-".concat(this.station.id,"-").concat(this.track.id),x:this.diagram.config.stationLabelLeftMargin+this.diagram.config.trackLabelLeftMargin,y:this.diagram.getYByRelY(this.track.relY)-this.diagram.config.trackLabelFontSize,width:this.diagram.config.leftPaneWidth-this.diagram.config.stationLabelLeftMargin-this.diagram.config.trackLabelLeftMargin-this.diagram.config.stationLabelRightMargin,height:this.diagram.config.trackLabelFontSize,text:this.track.name,fontSize:this.diagram.config.trackLabelFontSize,fontFamily:this.diagram.config.fontFamily,fill:this.diagram.config.trackLabelColor,align:"left",verticalAlign:"bottom"}}},{key:"isLineIntersectingPlotPane",get:function(){return this.diagram.getYByRelY(this.track.relY)>=this.diagram.config.topPaneHeight&&this.diagram.getYByRelY(this.track.relY)<this.viewState.viewHeight}},{key:"onLabelClick",value:function(){this.viewState.editMode&&!this.viewState.isInputEnabled&&(this.viewState.trackNameInputTarget={stationId:this.station.id,trackId:this.track.id},this.$emit("trackNameInputStart"))}}]),i}(f["e"]);Object(u["a"])([Object(f["b"])()],W.prototype,"viewConfig",void 0),Object(u["a"])([Object(f["b"])()],W.prototype,"viewState",void 0),Object(u["a"])([Object(f["b"])()],W.prototype,"diagram",void 0),Object(u["a"])([Object(f["c"])()],W.prototype,"station",void 0),Object(u["a"])([Object(f["c"])()],W.prototype,"track",void 0),W=Object(u["a"])([f["a"]],W);var E=W,B=E,D=i("2877"),_=Object(D["a"])(B,R,N,!1,null,"78152546",null),$=_.exports,z=function(t){Object(m["a"])(i,t);var e=Object(p["a"])(i);function i(){var t;return Object(h["a"])(this,i),t=e.apply(this,arguments),t.dragState=null,t}return Object(g["a"])(i,[{key:"topLineConfig",get:function(){return{points:[0,this.diagram.getYByRelY(this.station.topRelY),this.viewState.viewWidth,this.diagram.getYByRelY(this.station.topRelY)],stroke:this.diagram.config.stationLineColor,strokeWidth:this.diagram.config.stationLineWidth,listening:!1}}},{key:"bottomLineConfig",get:function(){return{points:[0,this.diagram.getYByRelY(this.station.bottomRelY),this.viewState.viewWidth,this.diagram.getYByRelY(this.station.bottomRelY)],stroke:this.diagram.config.stationLineColor,strokeWidth:this.diagram.config.stationLineWidth,listening:!1}}},{key:"labelRectConfig",get:function(){return{id:"station-label-".concat(this.station.id),x:this.diagram.config.stationLabelLeftMargin,y:this.diagram.getYByRelY(this.station.topRelY)-this.diagram.config.stationLabelFontSize,width:this.diagram.config.leftPaneWidth-this.diagram.config.stationLabelLeftMargin-this.diagram.config.stationLabelRightMargin,height:this.diagram.config.stationLabelFontSize}}},{key:"labelCharacters",get:function(){var t=this,e=this.diagram.config.leftPaneWidth-this.diagram.config.stationLabelLeftMargin-this.diagram.config.stationLabelRightMargin-this.diagram.config.stationLabelFontSize,i=this.station.name.length>1?e/(this.station.name.length-1):0;return Array.from(this.station.name).map((function(a,n){return{key:"station-label-".concat(t.station.id,"-").concat(n),x:t.station.name.length>1?t.diagram.config.stationLabelLeftMargin+n*i:t.diagram.config.stationLabelLeftMargin+.5*e,y:t.diagram.getYByRelY(t.station.topRelY)-t.diagram.config.stationLabelFontSize,height:t.diagram.config.stationLabelFontSize,text:a,fontSize:t.diagram.config.stationLabelFontSize,fontFamily:t.diagram.config.fontFamily,fill:t.diagram.config.stationLabelColor,align:"left",verticalAlign:"bottom"}}))}},{key:"isTopLineIntersectingPlotPane",get:function(){return this.diagram.getYByRelY(this.station.topRelY)>=this.diagram.config.topPaneHeight&&this.diagram.getYByRelY(this.station.topRelY)<this.viewState.viewHeight}},{key:"isBottomLineIntersectingPlotPane",get:function(){return this.diagram.getYByRelY(this.station.bottomRelY)>=this.diagram.config.topPaneHeight&&this.diagram.getYByRelY(this.station.bottomRelY)<this.viewState.viewHeight}},{key:"onStationLabelClick",value:function(){var t;!this.viewState.editMode||this.viewState.isInputEnabled||null!==(t=this.dragState)&&void 0!==t&&t.dragging||(this.viewState.stationNameInputTarget={stationId:this.station.id},this.$emit("stationNameInputStart"))}},{key:"onStationLabelMouseDown",value:function(t){this.dragState={sy0:t.evt.screenY,mileage0:this.station.mileage,dragging:!1},window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp)}},{key:"onWindowMouseMove",value:function(t){this.dragState&&(this.dragState.dragging=!0,this.station.mileage=this.dragState.mileage0+(t.screenY-this.dragState.sy0)/this.diagram.config.yScale,this.$emit("updateY"))}},{key:"onWindowMouseUp",value:function(t){this.dragState&&(window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp),this.onWindowMouseMove(t),this.dragState=null)}}]),i}(f["e"]);Object(u["a"])([Object(f["b"])()],z.prototype,"viewConfig",void 0),Object(u["a"])([Object(f["b"])()],z.prototype,"viewState",void 0),Object(u["a"])([Object(f["b"])()],z.prototype,"diagram",void 0),Object(u["a"])([Object(f["c"])()],z.prototype,"station",void 0),z=Object(u["a"])([Object(f["a"])({components:{TrackGroup:$}})],z);var H=z,F=H,X=Object(D["a"])(F,x,C,!1,null,"3a438b01",null),J=X.exports,G=function(t){Object(m["a"])(i,t);var e=Object(p["a"])(i);function i(){return Object(h["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"timeGridLines",get:function(){var t=[],e=this.diagram.config.scrollX/this.diagram.config.xScale,i=Math.ceil(e/this.diagram.config.minorMinutelyGridLineSpan)*this.diagram.config.minorMinutelyGridLineSpan,a=i*this.diagram.config.xScale-this.diagram.config.scrollX+this.diagram.config.leftPaneWidth;while(a<this.viewState.viewWidth)t.push({key:"time-grid-line-".concat(t.length),lineConfig:{points:[a,this.diagram.config.topPaneHeight,a,this.viewState.viewHeight],stroke:i%3600==0?this.diagram.config.hourlyGridLineColor:i%this.diagram.config.majorMinutelyGridLineSpan==0?this.diagram.config.majorMinutelyGridLineColor:this.diagram.config.minorMinutelyGridLineColor,strokeWidth:i%3600==0?this.diagram.config.hourlyGridLineWidth:i%this.diagram.config.majorMinutelyGridLineSpan==0?this.diagram.config.majorMinutelyGridLineWidth:this.diagram.config.minorMinutelyGridLineWidth,listening:!1},labelConfig:i%3600!=0?null:{x:a-this.diagram.config.hourlyLabelFontSize,y:this.diagram.config.topPaneHeight-this.diagram.config.hourlyLabelBottomMargin-this.diagram.config.hourlyLabelFontSize,width:2*this.diagram.config.hourlyLabelFontSize,height:this.diagram.config.hourlyLabelFontSize,text:"".concat(i/3600%24),fontSize:this.diagram.config.hourlyLabelFontSize,fontFamily:this.diagram.config.fontFamily,fill:this.diagram.config.hourlyLabelColor,align:"center",verticalAlign:"bottom"}}),i+=this.diagram.config.minorMinutelyGridLineSpan,a=i*this.diagram.config.xScale-this.diagram.config.scrollX+this.diagram.config.leftPaneWidth;return t}}]),i}(f["e"]);Object(u["a"])([Object(f["b"])()],G.prototype,"viewState",void 0),Object(u["a"])([Object(f["b"])()],G.prototype,"diagram",void 0),G=Object(u["a"])([Object(f["a"])({components:{StationGroup:J}})],G);var U=G,A=U,K=Object(D["a"])(A,P,M,!1,null,"654ee79b",null),V=K.exports,q=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-group",{attrs:{config:t.groupConfig}},[t.viewState.drawingState?i("v-line",{attrs:{config:t.drawingLineConfig}}):t._e(),i("v-rect",{attrs:{config:t.rectConfig}}),i("v-text",{attrs:{config:t.labelConfig}})],1)},Q=[];i("b64b"),i("4d90");function Z(t,e){var i="".concat(Math.floor(t/3600)),a="".concat(Math.floor(t/60)%60).padStart(2,"0"),n="".concat(t%60).padStart(2,"0");return t%60!=0||e?"".concat(i,":").concat(a,":").concat(n):"".concat(i,":").concat(a)}var tt=function(t){Object(m["a"])(i,t);var e=Object(p["a"])(i);function i(){return Object(h["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"groupConfig",get:function(){return{visible:null!=this.viewState.pointerTargetLine&&(0==Object.keys(this.viewState.trainSelections).length||null!=this.viewState.drawingState)}}},{key:"rectConfig",get:function(){var t=this.viewState.drawingState?this.viewConfig.selectedTrainPathMarkerWidth:this.viewConfig.pointerWidth;return{x:this.diagram.getXByTime(this.viewState.pointerTime)-.5*t,y:this.viewState.pointerY-.5*t,width:t,height:t,fill:this.viewState.pointerOnMarker||this.viewState.drawingState?this.viewConfig.pointerOnMarkerColor:this.viewConfig.pointerColor,listening:!1}}},{key:"labelConfig",get:function(){var t=this.viewState.pointerTime>=0?this.viewState.pointerTime:this.viewState.pointerTime+3600*Math.ceil(-this.viewState.pointerTime/3600);return{x:this.diagram.getXByTime(this.viewState.pointerTime),y:this.viewState.pointerY-this.viewConfig.pointerLabelFontSize,height:this.viewConfig.pointerLabelFontSize,text:Z(t,null!=this.viewState.pointerPreciseState),fontSize:this.viewConfig.pointerLabelFontSize,fontFamily:this.diagram.config.fontFamily,fill:this.viewState.pointerOnMarker||this.viewState.drawingState?this.viewConfig.pointerOnMarkerColor:this.viewConfig.pointerColor,align:"left",verticalAlign:"bottom",listening:!1}}},{key:"drawingLineConfig",get:function(){var t=this.viewState.drawingState;if(t){var e,i,a=this.diagram.trains[t.trainId],n=a.stops.find((function(e){return e.id==t.lastStopId}));return n?{points:[this.diagram.getXByTime(this.viewState.pointerTime),this.viewState.pointerY,this.diagram.getXByTime(t.direction>0?n.depTime:n.arrTime),this.diagram.getYByRelY(null!==(e=null===(i=this.diagram.stations[n.stationId].tracks.find((function(t){return t.id==n.trackId})))||void 0===i?void 0:i.relY)&&void 0!==e?e:0)],stroke:this.viewConfig.selectedTrainPathColor,strokeWidth:this.diagram.config.trainPathWidth*this.viewConfig.selectedTrainPathWidthScale}:{}}return{}}}]),i}(f["e"]);Object(u["a"])([Object(f["b"])()],tt.prototype,"viewConfig",void 0),Object(u["a"])([Object(f["b"])()],tt.prototype,"viewState",void 0),Object(u["a"])([Object(f["b"])()],tt.prototype,"diagram",void 0),tt=Object(u["a"])([f["a"]],tt);var et=tt,it=et,at=Object(D["a"])(it,q,Q,!1,null,"6a163b4d",null),nt=at.exports,rt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-layer",{ref:"trainPathLayer",attrs:{id:"train-path-layer",config:t.layerConfig}},[t._l(Object.values(t.diagram.trains).filter((function(e){return!t.viewState.trainSelections[e.id]})),(function(t){return i("train-path-group",{key:"train-"+t.id,attrs:{train:t}})})),t._l(Object.values(t.diagram.trains).filter((function(e){return t.viewState.trainSelections[e.id]})),(function(t){return i("train-path-group",{key:"train-"+t.id,attrs:{train:t}})}))],2)},ot=[],st=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-group",[i("v-line",{attrs:{config:t.regularTrainPathConfig},on:{click:t.onTrainPathClick}}),t.selectedTrainPathEnabled?[i("v-line",{attrs:{config:t.selectedTrainPathConfig},on:{click:t.onSelectedTrainPathClick,dblclick:t.onSelectedTrainPathDoubleClick,mousedown:t.onSelectedTrainPathMouseDown}}),t._l(t.selectedTrainPathNodes,(function(e,a){return i("train-path-marker",{key:"train-path-"+t.train.id+"-marker-"+a,attrs:{trainPathNode:e},on:{click:t.onMarkerClick,mousedown:t.onMarkerMouseDown}})}))]:t._e()],2)},dt=[],ct=(i("0481"),i("5db7"),i("73d9"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-group",[i("v-rect",{attrs:{config:t.rectConfig},on:{click:function(e){return t.$emit("click",e,t.trainPathNode)},mousemove:t.onRectMouseMove,mousedown:function(e){return t.$emit("mousedown",e,t.trainPathNode)},dblclick:t.onRectDoubleClick}}),t.labelEnabled?i("v-text",{attrs:{config:t.labelConfig}}):t._e()],1)}),lt=[],ht=function(t){Object(m["a"])(i,t);var e=Object(p["a"])(i);function i(){return Object(h["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"rectConfig",get:function(){return{x:this.trainPathNode.x-.5*this.viewConfig.selectedTrainPathMarkerWidth,y:this.trainPathNode.y-.5*this.viewConfig.selectedTrainPathMarkerWidth,width:this.viewConfig.selectedTrainPathMarkerWidth,height:this.viewConfig.selectedTrainPathMarkerWidth,fill:this.viewConfig.selectedTrainPathMarkerColor}}},{key:"labelEnabled",get:function(){var t=this.trainPathNode,e=t.stop.id==t.train.stops[t.train.stops.length-1].id;return"station"==t.vSide&&(e&&"arr"==t.side||!e&&("dep"==t.side||t.stop.arrTime!=t.stop.depTime))}},{key:"labelConfig",get:function(){var t=this.getLabelPosition();return{x:this.trainPathNode.x+t.x-8*this.viewConfig.markerLabelFontSize,y:this.trainPathNode.y+t.y-this.viewConfig.markerLabelLineHeight,width:8*this.viewConfig.markerLabelFontSize,height:this.viewConfig.markerLabelLineHeight,text:Z(this.trainPathNode.time,null!=this.viewState.pointerPreciseState),fontSize:this.viewConfig.pointerLabelFontSize,fontFamily:this.diagram.config.fontFamily,fill:this.viewConfig.markerLabelColor,align:"right",verticalAlign:"bottom",listening:!1}}},{key:"getLabelPosition",value:function(){if("arr"==this.trainPathNode.side){var t=this.trainPathNode.train.getPreviousStopEvent(this.trainPathNode.stop.id,"arr");if(t){var e="arr"==this.trainPathNode.side?this.trainPathNode.stop.arrTime:this.trainPathNode.stop.depTime,i=this.diagram.stations[this.trainPathNode.stop.stationId],a=this.diagram.stations[t.stop.stationId],n=a.mileage<i.mileage?i.topRelY:i.bottomRelY,r=a.mileage<i.mileage?a.bottomRelY:a.topRelY,o=-this.viewConfig.markerLabelLineHeight*((e-t.time)*this.diagram.config.xScale)/Math.abs(n-r);return{x:Math.max(o,-this.viewConfig.markerLabelMaxDistance),y:a.mileage<i.mileage?0:this.viewConfig.markerLabelLineHeight}}}var s=this.diagram.getTrainPathDirection(this.trainPathNode.train.id,this.trainPathNode.stop.id,this.trainPathNode.side);return{x:0,y:s<0||0==s&&"arr"==this.trainPathNode.side?0:this.viewConfig.markerLabelLineHeight}}},{key:"onRectMouseMove",value:function(t){var e=this,i=t.evt;if(!this.viewState.pointerPreciseState&&!this.viewState.pointerDragging&&!this.viewState.drawingState){var a=this.diagram.stations[this.trainPathNode.stop.stationId],n="track"==this.trainPathNode.vSide?a.tracks.find((function(t){return t.id==e.trainPathNode.stop.trackId})):void 0;this.viewState.pointerTargetLine={station:a,track:n},this.viewState.pointerScreenX=i.screenX,this.viewState.pointerTime=this.trainPathNode.time,this.viewState.pointerY=this.trainPathNode.y,this.viewState.pointerOnMarker=!0}}},{key:"onRectDoubleClick",value:function(){if(this.viewState.editMode&&!this.viewState.drawingState){var t=this.trainPathNode;t.stop.id!=t.train.stops[0].id||"arr"!=t.side&&t.stop.arrTime!=t.stop.depTime?t.stop.id!=t.train.stops[t.train.stops.length-1].id||"dep"!=t.side&&t.stop.arrTime!=t.stop.depTime||(this.viewState.drawingState={trainId:t.train.id,lastStopId:t.stop.id,direction:1},this.viewState.trainSelections[t.train.id].stopRange=null):(this.viewState.drawingState={trainId:t.train.id,lastStopId:t.stop.id,direction:-1},this.viewState.trainSelections[t.train.id].stopRange=null)}}}]),i}(f["e"]);Object(u["a"])([Object(f["b"])()],ht.prototype,"viewConfig",void 0),Object(u["a"])([Object(f["b"])()],ht.prototype,"viewState",void 0),Object(u["a"])([Object(f["b"])()],ht.prototype,"diagram",void 0),Object(u["a"])([Object(f["c"])()],ht.prototype,"trainPathNode",void 0),ht=Object(u["a"])([f["a"]],ht);var gt=ht,mt=gt,pt=Object(D["a"])(mt,ct,lt,!1,null,"631b1164",null),ut=pt.exports,ft=function(t){Object(m["a"])(i,t);var e=Object(p["a"])(i);function i(){var t;return Object(h["a"])(this,i),t=e.apply(this,arguments),t.dragState=null,t}return Object(g["a"])(i,[{key:"regularTrainPathConfig",get:function(){return{points:this.regularTrainPathNodes.map((function(t){return[t.x,t.y]})).flat(),stroke:this.diagram.config.trainPathColor,opacity:Object.keys(this.viewState.trainSelections).length>0?this.viewConfig.unselectedTrainPathOpacity:1,strokeWidth:this.diagram.config.trainPathWidth,hitStrokeWidth:Math.max(this.diagram.config.trainPathWidth,2*this.viewConfig.minHitWidth)}}},{key:"regularTrainPathNodes",get:function(){var t,e=[],i=Object(l["a"])(this.trainPathNodes);try{for(i.s();!(t=i.n()).done;){var a=t.value,n=a.time+(this.selectedTrainPathEnabled&&this.viewState.trainPathDragState&&!this.viewState.controlKeyPressed?this.viewState.trainPathDragState.timeShift:0);e.push({train:a.train,stop:a.stop,side:a.side,vSide:a.vSide,time:n,x:this.diagram.getXByTime(n),y:a.y,selected:a.selected})}}catch(r){i.e(r)}finally{i.f()}return e}},{key:"selectedTrainPathEnabled",get:function(){return null!=this.viewState.trainSelections[this.train.id]}},{key:"selectedTrainPathConfig",get:function(){return{points:this.selectedTrainPathNodes.flatMap((function(t){return[t.x,t.y]})),stroke:this.viewConfig.selectedTrainPathColor,strokeWidth:this.diagram.config.trainPathWidth*this.viewConfig.selectedTrainPathWidthScale,hitStrokeWidth:Math.max(this.diagram.config.trainPathWidth*this.viewConfig.selectedTrainPathWidthScale,2*this.viewConfig.minHitWidth)}}},{key:"selectedTrainPathNodes",get:function(){var t,e=[],i=Object(l["a"])(this.trainPathNodes);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.selected){var n,r,o=a.time+(null!==(n=null===(r=this.viewState.trainPathDragState)||void 0===r?void 0:r.timeShift)&&void 0!==n?n:0);e.push({train:a.train,stop:a.stop,side:a.side,vSide:a.vSide,time:o,x:this.diagram.getXByTime(o),y:a.y,selected:a.selected})}}}catch(s){i.e(s)}finally{i.f()}return e}},{key:"trainPathNodes",get:function(){for(var t,e=this,i=[],a=this.train.getStopEvents(),n=null===(t=this.viewState.trainSelections[this.train.id])||void 0===t?void 0:t.stopRange,r=null===n,o=function(t){var o=a[t],s=e.diagram.stations[o.stop.stationId];n&&n.fromStopId==o.stop.id&&n.fromStopSide==o.side&&(r=!0);var d=o.time,c=e.diagram.getXByTime(d);if(s.expanded){var l,h;if("arr"==o.side&&t>0){var g=a[t-1];if(g.stop.stationId!=o.stop.stationId){var m=e.diagram.stations[g.stop.stationId];i.push({train:e.train,stop:o.stop,side:"arr",vSide:"station",time:d,x:c,y:e.diagram.getYByRelY(m.mileage<s.mileage?s.topRelY:s.bottomRelY),selected:r})}}if(i.push({train:e.train,stop:o.stop,side:o.side,vSide:"track",time:d,x:c,y:e.diagram.getYByRelY(null!==(l=null===(h=s.tracks.find((function(t){return t.id==o.stop.trackId})))||void 0===h?void 0:h.relY)&&void 0!==l?l:0),selected:r}),"dep"==o.side&&t<a.length-1){var p=a[t+1];if(p.stop.stationId!=o.stop.stationId){var u=e.diagram.stations[p.stop.stationId];i.push({train:e.train,stop:o.stop,side:"dep",vSide:"station",time:d,x:c,y:e.diagram.getYByRelY(u.mileage>s.mileage?s.bottomRelY:s.topRelY),selected:r})}}}else i.push({train:e.train,stop:o.stop,side:o.side,vSide:"station",time:d,x:c,y:e.diagram.getYByRelY(s.topRelY),selected:r});n&&n.toStopId==o.stop.id&&n.toStopSide==o.side&&(r=!1)},s=0;s<a.length;s++)o(s);return i}},{key:"onTrainPathClick",value:function(t){var e=this.getClickedStopRange(t.evt.clientX,t.evt.clientY);this.changeTrainSelections(t,e,!1)}},{key:"onSelectedTrainPathClick",value:function(t){var e=this.getClickedStopRange(t.evt.clientX,t.evt.clientY);this.changeTrainSelections(t,e,!0)}},{key:"onMarkerClick",value:function(t,e){var i={fromStopId:e.stop.id,fromStopSide:e.stop.arrTime!=e.stop.depTime?e.side:"arr",toStopId:e.stop.id,toStopSide:e.stop.arrTime!=e.stop.depTime?e.side:"dep"};this.changeTrainSelections(t,i,!0)}},{key:"changeTrainSelections",value:function(t,e,i){if(!this.viewState.pointerDragging&&!this.viewState.drawingState){var a=this.viewState.trainSelections[this.train.id];if(t.evt.ctrlKey||(this.viewState.trainSelections=a?Object(Y["a"])({},this.train.id,a):{}),a){var n=a.stopRange;if(n)if(t.evt.ctrlKey){var r=this.train.stops.findIndex((function(t){return t.id==n.fromStopId})),o=this.train.stops.findIndex((function(t){return t.id==n.toStopId})),s=this.train.stops.findIndex((function(t){return t.id==e.fromStopId})),d=this.train.stops.findIndex((function(t){return t.id==e.toStopId}));s<r||s==r&&"arr"==e.fromStopSide?(n.fromStopId=e.fromStopId,n.fromStopSide=e.fromStopSide):d>o||d==o&&"dep"==e.toStopSide?(n.toStopId=e.toStopId,n.toStopSide=e.toStopSide):this.$delete(this.viewState.trainSelections,this.train.id)}else i||(a.stopRange=null);else a.stopRange=e}else this.$set(this.viewState.trainSelections,this.train.id,{trainId:this.train.id,stopRange:null})}}},{key:"getClickedStopRange",value:function(t,e){for(var i=this.diagram.getTimeByX(t),a=0;a<this.train.stops.length;++a){var n=this.train.stops[a],r=this.diagram.stations[n.stationId];if(e>this.diagram.getYByRelY(r.topRelY)-this.viewConfig.minHitWidth&&e<this.diagram.getYByRelY(r.bottomRelY)+this.viewConfig.minHitWidth)return{fromStopId:n.id,fromStopSide:"arr",toStopId:n.id,toStopSide:"dep"};if(a>0&&i<n.arrTime){var o=this.train.stops[a-1];return{fromStopId:o.id,fromStopSide:o.arrTime==o.depTime?"arr":"dep",toStopId:n.id,toStopSide:n.arrTime==n.depTime?"dep":"arr"}}}var s=this.train.stops[this.train.stops.length-1];return{fromStopId:s.id,fromStopSide:"arr",toStopId:s.id,toStopSide:"dep"}}},{key:"onSelectedTrainPathDoubleClick",value:function(t){if(this.viewState.editMode&&!this.viewState.drawingState){var e=this.viewState.pointerTime,i=this.getNearestStation(t.evt.clientY),a=this.getNearestStop(e);if(i.id!=a.stationId){var n=this.train.stops.findIndex((function(t){return t.arrTime>e})),r=this.diagram.genId();this.train.stops.splice(n,0,new y(r,i.id,this.diagram.stations[i.id].tracks[0].id,e,e)),this.viewState.trainSelections=Object(Y["a"])({},this.train.id,{trainId:this.train.id,stopRange:{fromStopId:r,fromStopSide:"arr",toStopId:r,toStopSide:"dep"}})}else a.arrTime==a.depTime&&(e<a.arrTime?(a.arrTime=e,this.viewState.trainSelections=Object(Y["a"])({},this.train.id,{trainId:this.train.id,stopRange:{fromStopId:a.id,fromStopSide:"arr",toStopId:a.id,toStopSide:"arr"}})):e>a.depTime&&(a.depTime=e,this.viewState.trainSelections=Object(Y["a"])({},this.train.id,{trainId:this.train.id,stopRange:{fromStopId:a.id,fromStopSide:"dep",toStopId:a.id,toStopSide:"dep"}})))}}},{key:"getNearestStation",value:function(t){var e,i=this.diagram.getStationsInMileageOrder(),a=this.diagram.getRelYByY(t),n=i[0],r=Math.abs(a-n.bottomRelY),o=Object(l["a"])(i);try{for(o.s();!(e=o.n()).done;){var s=e.value;Math.abs(a-s.topRelY)<r&&(n=s,r=Math.abs(a-s.topRelY)),Math.abs(a-s.bottomRelY)<r&&(n=s,r=Math.abs(a-s.bottomRelY))}}catch(d){o.e(d)}finally{o.f()}return n}},{key:"getNearestStop",value:function(t){var e,i=this.train.stops[0],a=Math.abs(t-i.arrTime),n=Object(l["a"])(this.train.stops);try{for(n.s();!(e=n.n()).done;){var r=e.value;Math.abs(t-r.arrTime)<a&&(i=r,a=Math.abs(t-r.arrTime)),Math.abs(t-r.depTime)<a&&(i=r,a=Math.abs(t-r.depTime))}}catch(o){n.e(o)}finally{n.f()}return i}},{key:"onSelectedTrainPathMouseDown",value:function(t){if(this.viewState.editMode){for(var e=-86400,i=86400,a=0,n=Object.values(this.viewState.trainSelections);a<n.length;a++){var r=n[a],o=r.stopRange;if(o){var s=this.diagram.trains[r.trainId],d=s.getStopEvent(o.fromStopId,o.fromStopSide),c=d?s.getPreviousStopEvent(d.stop.id,d.side):void 0;d&&c&&(e=Math.max(e,c.time-d.time));var l=s.getStopEvent(o.toStopId,o.toStopSide),h=l?s.getNextStopEvent(l.stop.id,l.side):void 0;l&&h&&(i=Math.min(i,h.time-l.time))}}var g=this.selectedTrainPathNodes[0];this.dragState={t0:g.time,sx0:t.evt.screenX,y0:g.y,minTimeShift:e,maxTimeShift:i,targetStopEvents:null},this.viewState.trainPathDragState={timeShift:0},window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp)}}},{key:"onMarkerMouseDown",value:function(t,e){if(this.viewState.editMode){var i="dep"==e.side&&e.stop.arrTime==e.stop.depTime?this.train.getPreviousStopEvent(e.stop.id,"arr"):this.train.getPreviousStopEvent(e.stop.id,e.side),a="arr"==e.side&&e.stop.arrTime==e.stop.depTime?this.train.getNextStopEvent(e.stop.id,"dep"):this.train.getNextStopEvent(e.stop.id,e.side);this.dragState={t0:e.time,sx0:t.evt.screenX,y0:e.y,minTimeShift:i?i.time-e.time:-86400,maxTimeShift:a?a.time-e.time:86400,targetStopEvents:e.stop.arrTime==e.stop.depTime?[{stop:e.stop,side:"arr",time:e.stop.arrTime},{stop:e.stop,side:"dep",time:e.stop.depTime}]:[e]},this.viewState.trainPathDragState={timeShift:0},window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp)}}},{key:"onWindowMouseMove",value:function(t){this.dragState&&this.viewState.trainPathDragState&&(this.viewState.pointerDragging||(this.viewState.pointerDragging=!0,this.viewState.pointerY=this.dragState.y0),this.viewState.pointerPreciseState||(this.viewState.pointerTime=this.dragState.t0+60*Math.floor((t.screenX-this.dragState.sx0)/this.diagram.config.xScale/60)),this.viewState.trainPathDragState.timeShift=Math.min(this.dragState.maxTimeShift,Math.max(this.dragState.minTimeShift,this.viewState.pointerTime-this.dragState.t0)))}},{key:"onWindowMouseUp",value:function(){var t=this;if(this.dragState&&this.viewState.trainPathDragState){if(window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp),this.viewState.controlKeyPressed)for(var e=0,i=Object.values(this.viewState.trainSelections);e<i.length;e++){var a,n=i[e],r=this.diagram.trains[n.trainId],o=[],s=Object(l["a"])(r.getStopEvents(n.stopRange));try{for(s.s();!(a=s.n()).done;){var d=a.value,c=d.time+this.viewState.trainPathDragState.timeShift;if(o.length>0&&o[o.length-1].stationId==d.stop.stationId)o[o.length-1].depTime=c;else{var h=y.fromJSON({id:this.diagram.genId(),stationId:d.stop.stationId,trackId:d.stop.trackId,arrTime:c,depTime:c});o.push(h)}}}catch(b){s.e(b)}finally{s.f()}var g=w.fromJSON({id:this.diagram.genId(),name:"",stops:o});this.$set(this.diagram.trains,g.id,g),this.$delete(this.viewState.trainSelections,n.trainId),this.$set(this.viewState.trainSelections,g.id,{trainId:g.id,stopRange:null})}else{var m,p,u=null!==(m=this.dragState.targetStopEvents)&&void 0!==m?m:Object.values(this.viewState.trainSelections).flatMap((function(e){return t.diagram.trains[e.trainId].getStopEvents(e.stopRange)})),f=Object(l["a"])(u);try{for(f.s();!(p=f.n()).done;){var v=p.value,S=v.time+this.viewState.trainPathDragState.timeShift;"arr"==v.side?v.stop.arrTime=S:v.stop.depTime=S}}catch(b){f.e(b)}finally{f.f()}}this.viewState.pointerDragging=!1,this.viewState.trainPathDragState=null,this.dragState=null}}}]),i}(f["e"]);Object(u["a"])([Object(f["b"])()],ft.prototype,"viewConfig",void 0),Object(u["a"])([Object(f["b"])()],ft.prototype,"viewState",void 0),Object(u["a"])([Object(f["b"])()],ft.prototype,"diagram",void 0),Object(u["a"])([Object(f["c"])()],ft.prototype,"train",void 0),ft=Object(u["a"])([Object(f["a"])({components:{TrainPathMarker:ut}})],ft);var vt=ft,St=vt,bt=Object(D["a"])(St,st,dt,!1,null,"db26ad56",null),kt=bt.exports,yt=function(t){Object(m["a"])(i,t);var e=Object(p["a"])(i);function i(){return Object(h["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"layerConfig",get:function(){return{clip:{x:this.diagram.config.leftPaneWidth,y:this.diagram.config.topPaneHeight,width:this.viewState.viewWidth-this.diagram.config.leftPaneWidth,height:this.viewState.viewHeight-this.diagram.config.topPaneHeight}}}}]),i}(f["e"]);Object(u["a"])([Object(f["b"])()],yt.prototype,"viewState",void 0),Object(u["a"])([Object(f["b"])()],yt.prototype,"diagram",void 0),yt=Object(u["a"])([Object(f["a"])({components:{TrainPathGroup:kt}})],yt);var wt=yt,Ot=wt,Tt=Object(D["a"])(Ot,rt,ot,!1,null,"2f6cdf07",null),It=Tt.exports,jt=function(t){Object(m["a"])(i,t);var e=Object(p["a"])(i);function i(){var t;return Object(h["a"])(this,i),t=e.apply(this,arguments),t.stageDragState=null,t}return Object(g["a"])(i,[{key:"stageConfig",get:function(){return{width:this.viewState.viewWidth,height:this.viewState.viewHeight}}},{key:"stationsInMileageOrder",get:function(){return this.diagram.getStationsInMileageOrder()}},{key:"mounted",value:function(){window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp)}},{key:"unmounted",value:function(){window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp)}},{key:"onStageMouseDown",value:function(t){if(t.target==t.currentTarget){var e=t.evt;this.stageDragState={scrollX0:this.diagram.config.scrollX,scrollY0:this.diagram.config.scrollY,screenX0:e.screenX,screenY0:e.screenY,dragged:!1}}}},{key:"onStageMouseMove",value:function(t){var e=this;this.viewState.pointerOnMarker=!1;var i=t.evt;if(this.viewState.pointerScreenX=i.screenX,this.viewState.pointerPreciseState){var a=Math.round((i.screenX-this.viewState.pointerPreciseState.sx0)/this.viewConfig.pointerPrecisePixelPerTimeUnit);this.viewState.pointerTime=a*this.diagram.config.minimumTimeUnit+this.viewState.pointerPreciseState.t0}else if(!this.viewState.pointerDragging)if(this.viewState.pointerTime=60*Math.round(this.diagram.getTimeByX(i.clientX)/60),i.clientX>=this.diagram.config.leftPaneWidth){var n,r,o=this.findPointerTargetLine(i.clientY);if(o)this.viewState.pointerTargetLine=null!==o&&void 0!==o?o:null,this.viewState.pointerY=this.diagram.getYByRelY(null!==(n=null===(r=o.track)||void 0===r?void 0:r.relY)&&void 0!==n?n:o.station.topRelY);else this.viewState.pointerTargetLine=null}else this.viewState.pointerTargetLine=null;if(this.viewState.drawingState){var s=this.diagram.trains[this.viewState.drawingState.trainId],d=s.stops.find((function(t){var i;return t.id==(null===(i=e.viewState.drawingState)||void 0===i?void 0:i.lastStopId)}));d&&(this.viewState.drawingState.direction>0?this.viewState.pointerTime=Math.max(this.viewState.pointerTime,d.depTime):this.viewState.drawingState.direction<0&&(this.viewState.pointerTime=Math.min(this.viewState.pointerTime,d.arrTime)))}}},{key:"findPointerTargetLine",value:function(t){var e=this,i=this.stationsInMileageOrder.find((function(i){return Math.min(Math.abs(e.diagram.getYByRelY(i.topRelY)-t),Math.abs(e.diagram.getYByRelY(i.bottomRelY)-t))<Math.max(.5*e.diagram.config.stationLineWidth,e.viewConfig.minHitWidth)}));if(i)return{station:i};var a=this.stationsInMileageOrder.find((function(i){return e.diagram.getYByRelY(i.topRelY)+e.diagram.config.trackLineSpan-Math.max(.5*e.diagram.config.trackLineWidth,e.viewConfig.minHitWidth)<t&&e.diagram.getYByRelY(i.bottomRelY)-e.diagram.config.trackLineSpan+Math.max(.5*e.diagram.config.trackLineWidth,e.viewConfig.minHitWidth)>t}));if(a){var n=a.tracks.find((function(i){return Math.abs(e.diagram.getYByRelY(i.relY)-t)<Math.max(.5*e.diagram.config.trackLineWidth,e.viewConfig.minHitWidth)}));if(n)return{station:a,track:n}}}},{key:"onStageClick",value:function(t){var e,i=this.viewState.drawingState;if(i){var a=this.diagram.trains[i.trainId];if(this.viewState.pointerTargetLine){var n=a.stops.find((function(t){return t.id==i.lastStopId}));if(n)if(0==i.direction&&(i.direction=Math.sign(this.viewState.pointerTime-n.arrTime)),this.viewState.pointerTargetLine.station.id==n.stationId)i.direction>0?n.depTime=this.viewState.pointerTime:n.arrTime=this.viewState.pointerTime;else{var r,o,s=y.fromJSON({id:this.diagram.genId(),stationId:this.viewState.pointerTargetLine.station.id,trackId:null!==(r=null===(o=this.viewState.pointerTargetLine.track)||void 0===o?void 0:o.id)&&void 0!==r?r:this.viewState.pointerTargetLine.station.tracks[0].id,arrTime:this.viewState.pointerTime,depTime:this.viewState.pointerTime});i.direction>0?a.stops.push(s):a.stops.splice(0,0,s),i.lastStopId=s.id}}else 0==a.stops.length&&this.$delete(this.diagram.trains,a.id),this.viewState.drawingState=null}t.target!=t.currentTarget||t.evt.ctrlKey||null!==(e=this.stageDragState)&&void 0!==e&&e.dragged||this.viewState.pointerDragging||this.viewState.drawingState||(this.viewState.trainSelections={})}},{key:"onStageDoubleClick",value:function(t){if(t.target==t.currentTarget&&this.viewState.editMode)if(t.evt.clientX>=this.diagram.config.leftPaneWidth){var e=this.viewState.pointerTargetLine;if(e&&(e.track||!e.station.expanded)){var i,a=null!==(i=e.track)&&void 0!==i?i:e.station.tracks[0],n=y.fromJSON({id:this.diagram.genId(),stationId:e.station.id,trackId:a.id,arrTime:this.viewState.pointerTime,depTime:this.viewState.pointerTime}),r=w.fromJSON({id:this.diagram.genId(),name:"",stops:[n]});this.$set(this.diagram.trains,r.id,r),this.viewState.trainSelections=Object(Y["a"])({},r.id,{trainId:r.id,stopRange:null}),this.viewState.drawingState={trainId:r.id,lastStopId:n.id,direction:0}}}else{var o=this.diagram.getRelYByY(t.evt.clientY),s=this.stationsInMileageOrder.reverse().find((function(t){return t.topRelY<o})),d=s?(o-s.bottomRelY)/this.diagram.config.yScale+s.mileage:o/this.diagram.config.yScale,c=k.fromJSON({id:this.diagram.genId(),name:"",mileage:d,tracks:[{id:this.diagram.genId(),name:""}]});this.$set(this.diagram.stations,c.id,c),this.$emit("updateY"),this.viewState.stationNameInputTarget={stationId:c.id},this.$emit("stationNameInputStart")}}},{key:"onWindowMouseMove",value:function(t){this.stageDragState&&(this.stageDragState.dragged=!0,this.diagram.config.scrollX=this.stageDragState.scrollX0-(t.screenX-this.stageDragState.screenX0),this.diagram.config.scrollY=Math.max(0,Math.min(this.viewState.maxRelY+this.diagram.config.topPaneHeight-this.viewState.viewHeight,this.stageDragState.scrollY0-(t.screenY-this.stageDragState.screenY0))))}},{key:"onWindowMouseUp",value:function(t){this.stageDragState&&(this.onWindowMouseMove(t),this.stageDragState=null)}},{key:"onStageMouseWheel",value:function(t){var e=Math.pow(2,-t.evt.deltaY*this.viewConfig.wheelScale*.001);this.diagram.config.scrollX+=(e-1)*(t.evt.clientX-this.diagram.config.leftPaneWidth+this.diagram.config.scrollX),this.diagram.config.scrollY=Math.max(0,Math.min(this.viewState.maxRelY+this.diagram.config.topPaneHeight-this.viewState.viewHeight,this.diagram.config.scrollY+(e-1)*(t.evt.clientY-this.diagram.config.topPaneHeight+this.diagram.config.scrollY))),this.diagram.config.xScale*=e,this.diagram.config.yScale*=e,this.$emit("updateY")}},{key:"onKeyDown",value:function(t){var e=this;if(!t.repeat&&("Shift"==t.key&&(this.viewState.pointerPreciseState={sx0:this.viewState.pointerScreenX,t0:this.viewState.pointerTime}),"Control"==t.key&&(this.viewState.controlKeyPressed=!0),"Delete"==t.key))for(var i=function(){var t=n[a],i=t.stopRange;if(i){var r=e.diagram.trains[t.trainId];if(i.fromStopId==r.stops[0].id&&"arr"==i.fromStopSide){if(i.toStopId==i.fromStopId&&"arr"==i.toStopSide)r.stops[0].arrTime=r.stops[0].depTime;else if(i.toStopId==i.fromStopId&&r.stops[0].arrTime==r.stops[0].depTime)r.stops.splice(0,1);else{var o=r.stops.findIndex((function(t){return t.id==i.toStopId}));r.stops.splice(0,o),"dep"==i.toStopSide&&(r.stops[0].arrTime=r.stops[0].depTime)}1==r.stops.length&&r.stops[0].arrTime==r.stops[0].depTime&&e.$delete(e.diagram.trains,t.trainId),e.$delete(e.viewState.trainSelections,t.trainId)}else if(i.toStopId==r.stops[r.stops.length-1].id&&"dep"==i.toStopSide){var s=r.stops[r.stops.length-1];if(i.fromStopId==i.toStopId&&"dep"==i.fromStopSide)s.depTime=s.arrTime;else if(i.fromStopId==i.toStopId&&s.arrTime==s.depTime)r.stops.splice(r.stops.length-1,1);else{var d=r.stops.findIndex((function(t){return t.id==i.fromStopId}));r.stops.splice(d+1,r.stops.length-d-1),"arr"==i.fromStopSide&&(r.stops[d].depTime=r.stops[d].arrTime)}1==r.stops.length&&r.stops[0].arrTime==r.stops[0].depTime&&e.$delete(e.diagram.trains,t.trainId),e.$delete(e.viewState.trainSelections,t.trainId)}else!0}else e.$delete(e.diagram.trains,t.trainId),e.$delete(e.viewState.trainSelections,t.trainId)},a=0,n=Object.values(this.viewState.trainSelections);a<n.length;a++)i()}},{key:"onKeyUp",value:function(t){"Shift"==t.key&&(this.viewState.pointerPreciseState=null),"Control"==t.key&&(this.viewState.controlKeyPressed=!1)}},{key:"onContextMenu",value:function(t){return t.evt.preventDefault(),!1}}]),i}(f["e"]);Object(u["a"])([Object(f["b"])()],jt.prototype,"viewConfig",void 0),Object(u["a"])([Object(f["b"])()],jt.prototype,"viewState",void 0),Object(u["a"])([Object(f["b"])()],jt.prototype,"diagram",void 0),jt=Object(u["a"])([Object(f["a"])({components:{BackLayer:V,Pointer:nt,TrainPathLayer:It}})],jt);var Lt=jt,Yt=Lt,Pt=Object(D["a"])(Yt,j,L,!1,null,"0ef88590",null),Mt=Pt.exports,xt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.isBottomLineIntersectingPlotPane?i("b-icon",{directives:[{name:"show",rawName:"v-show",value:t.viewState.editMode&&t.station.expanded,expression:"viewState.editMode && station.expanded"}],style:t.style,attrs:{icon:"plus",size:"is-small"},nativeOn:{click:function(e){return t.onClick(e)}}}):t._e()},Ct=[],Rt=function(t){Object(m["a"])(i,t);var e=Object(p["a"])(i);function i(){return Object(h["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"style",get:function(){return{left:"".concat(this.diagram.config.leftPaneWidth-this.diagram.config.stationLabelRightMargin,"px"),top:"".concat(this.diagram.getYByRelY(this.station.bottomRelY)-this.diagram.config.trackLineSpan,"px"),height:"".concat(this.diagram.config.trackLineSpan,"px")}}},{key:"isBottomLineIntersectingPlotPane",get:function(){return this.diagram.getYByRelY(this.station.bottomRelY)>=this.diagram.config.topPaneHeight&&this.diagram.getYByRelY(this.station.bottomRelY)<this.viewState.viewHeight}},{key:"onClick",value:function(){if(!this.viewState.isInputEnabled){var t=b.fromJSON({id:this.diagram.genId(),name:""});this.station.tracks.push(t),this.$emit("updateY"),this.viewState.trackNameInputTarget={stationId:this.station.id,trackId:t.id},this.$emit("trackNameInputStart")}}}]),i}(f["e"]);Object(u["a"])([Object(f["b"])()],Rt.prototype,"viewState",void 0),Object(u["a"])([Object(f["b"])()],Rt.prototype,"diagram",void 0),Object(u["a"])([Object(f["c"])()],Rt.prototype,"station",void 0),Rt=Object(u["a"])([f["a"]],Rt);var Nt=Rt,Wt=Nt,Et=Object(D["a"])(Wt,xt,Ct,!1,null,"096d95ea",null),Bt=Et.exports,Dt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.isBottomLineIntersectingPlotPane?i("b-icon",{style:t.style,attrs:{icon:t.icon,size:"is-small"},nativeOn:{click:function(e){return t.onClick(e)}}}):t._e()},_t=[],$t=function(t){Object(m["a"])(i,t);var e=Object(p["a"])(i);function i(){return Object(h["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"icon",get:function(){return this.station.expanded?"chevron-up":"chevron-down"}},{key:"style",get:function(){return{left:"".concat(this.diagram.config.stationLabelLeftMargin,"px"),top:"".concat(this.diagram.getYByRelY(this.station.bottomRelY),"px"),height:"".concat(this.diagram.config.trackLineSpan,"px")}}},{key:"isBottomLineIntersectingPlotPane",get:function(){return this.diagram.getYByRelY(this.station.bottomRelY)>=this.diagram.config.topPaneHeight&&this.diagram.getYByRelY(this.station.bottomRelY)<this.viewState.viewHeight}},{key:"onClick",value:function(){this.viewState.isInputEnabled||(this.$set(this.station,"expanded",!this.station.expanded),this.$emit("updateY"))}}]),i}(f["e"]);Object(u["a"])([Object(f["b"])()],$t.prototype,"viewState",void 0),Object(u["a"])([Object(f["b"])()],$t.prototype,"diagram",void 0),Object(u["a"])([Object(f["c"])()],$t.prototype,"station",void 0),$t=Object(u["a"])([f["a"]],$t);var zt=$t,Ht=zt,Ft=Object(D["a"])(Ht,Dt,_t,!1,null,"1884b36c",null),Xt=Ft.exports,Jt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("input",{directives:[{name:"model",rawName:"v-model",value:t.targetStation.name,expression:"targetStation.name"},{name:"show",rawName:"v-show",value:t.viewState.stationNameInputTarget,expression:"viewState.stationNameInputTarget"}],style:t.style,domProps:{value:t.targetStation.name},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onComplete(e)},blur:t.onComplete,input:function(e){e.target.composing||t.$set(t.targetStation,"name",e.target.value)}}})},Gt=[],Ut=function(t){Object(m["a"])(i,t);var e=Object(p["a"])(i);function i(){return Object(h["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"targetStation",get:function(){return this.viewState.stationNameInputTarget?this.diagram.stations[this.viewState.stationNameInputTarget.stationId]:{}}},{key:"style",get:function(){return{left:"".concat(this.diagram.config.stationLabelLeftMargin,"px"),top:"".concat(this.diagram.getYByRelY(this.targetStation.topRelY)-this.diagram.config.stationLabelFontSize-4,"px"),width:"".concat(this.diagram.config.leftPaneWidth-this.diagram.config.stationLabelLeftMargin-this.diagram.config.stationLabelRightMargin,"px"),height:"".concat(this.diagram.config.stationLabelFontSize+4,"px"),paddingTop:"2px",lineHeight:"".concat(this.diagram.config.stationLabelFontSize,"px"),border:"none",fontSize:"".concat(this.diagram.config.stationLabelFontSize,"px")}}},{key:"onComplete",value:function(){this.viewState.stationNameInputTarget=null}}]),i}(f["e"]);Object(u["a"])([Object(f["b"])()],Ut.prototype,"viewState",void 0),Object(u["a"])([Object(f["b"])()],Ut.prototype,"diagram",void 0),Ut=Object(u["a"])([f["a"]],Ut);var At=Ut,Kt=At,Vt=Object(D["a"])(Kt,Jt,Gt,!1,null,"09e5daf8",null),qt=Vt.exports,Qt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.isTopLineIntersectingPlotPane?i("b-icon",{directives:[{name:"show",rawName:"v-show",value:t.viewState.editMode,expression:"viewState.editMode"}],style:t.style,attrs:{icon:"close",size:"is-small"},nativeOn:{click:function(e){return t.onClick(e)}}}):t._e()},Zt=[],te=(i("4de4"),function(t){Object(m["a"])(i,t);var e=Object(p["a"])(i);function i(){return Object(h["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"style",get:function(){return{left:"".concat(this.diagram.config.leftPaneWidth-this.diagram.config.stationLabelRightMargin,"px"),top:"".concat(this.diagram.getYByRelY(this.station.topRelY)-this.diagram.config.trackLineSpan,"px"),height:"".concat(this.diagram.config.trackLineSpan,"px")}}},{key:"isTopLineIntersectingPlotPane",get:function(){return this.diagram.getYByRelY(this.station.topRelY)>=this.diagram.config.topPaneHeight&&this.diagram.getYByRelY(this.station.topRelY)<this.viewState.viewHeight}},{key:"onClick",value:function(){var t=this;if(!this.viewState.isInputEnabled){var e=Object.values(this.diagram.trains).some((function(e){return e.stops.some((function(e){return e.stationId==t.station.id}))}));e?this.$buefy.dialog.confirm({message:this.$t("message.confirmRemoveStationRefered").toString(),onConfirm:function(){Object.values(t.diagram.trains).forEach((function(e){e.stops.map((function(e,i){return e.stationId==t.station.id?i:-1})).filter((function(t){return t>=0})).reverse().forEach((function(t){return e.stops.splice(t,1)}))})),t.$delete(t.diagram.stations,t.station.id),t.$emit("updateY")}}):(this.$delete(this.diagram.stations,this.station.id),this.$emit("updateY"))}}}]),i}(f["e"]));Object(u["a"])([Object(f["b"])()],te.prototype,"viewState",void 0),Object(u["a"])([Object(f["b"])()],te.prototype,"diagram",void 0),Object(u["a"])([Object(f["c"])()],te.prototype,"station",void 0),te=Object(u["a"])([f["a"]],te);var ee=te,ie=ee,ae=Object(D["a"])(ie,Qt,Zt,!1,null,"4f1fe388",null),ne=ae.exports,re=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.isLineIntersectingPlotPane?i("b-icon",{directives:[{name:"show",rawName:"v-show",value:t.viewState.editMode&&t.station.expanded&&Object.values(t.station.tracks).length>1,expression:"viewState.editMode && station.expanded && Object.values(station.tracks).length > 1"}],style:t.style,attrs:{icon:"close",size:"is-small"},nativeOn:{click:function(e){return t.onClick(e)}}}):t._e()},oe=[],se=function(t){Object(m["a"])(i,t);var e=Object(p["a"])(i);function i(){return Object(h["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"style",get:function(){return{left:"".concat(this.diagram.config.leftPaneWidth-this.diagram.config.stationLabelRightMargin,"px"),top:"".concat(this.diagram.getYByRelY(this.track.relY)-this.diagram.config.trackLineSpan,"px"),height:"".concat(this.diagram.config.trackLineSpan,"px")}}},{key:"isLineIntersectingPlotPane",get:function(){return this.diagram.getYByRelY(this.track.relY)>=this.diagram.config.topPaneHeight&&this.diagram.getYByRelY(this.track.relY)<this.viewState.viewHeight}},{key:"onClick",value:function(){var t=this;if(!this.viewState.isInputEnabled){var e=Object.values(this.diagram.trains).some((function(e){return e.stops.some((function(e){return e.stationId==t.station.id&&e.trackId==t.track.id}))}));e?this.$buefy.dialog.confirm({message:this.$t("message.confirmRemoveTrackRefered").toString(),onConfirm:function(){Object.values(t.diagram.trains).forEach((function(e){e.stops.map((function(e,i){return e.stationId==t.station.id&&e.trackId==t.track.id?i:-1})).filter((function(t){return t>=0})).reverse().forEach((function(t){return e.stops.splice(t,1)}))})),t.$delete(t.station.tracks,t.track.id),t.$emit("updateY")}}):(this.$delete(this.station.tracks,this.track.id),this.$emit("updateY"))}}}]),i}(f["e"]);Object(u["a"])([Object(f["b"])()],se.prototype,"viewState",void 0),Object(u["a"])([Object(f["b"])()],se.prototype,"diagram",void 0),Object(u["a"])([Object(f["c"])()],se.prototype,"station",void 0),Object(u["a"])([Object(f["c"])()],se.prototype,"track",void 0),se=Object(u["a"])([f["a"]],se);var de=se,ce=de,le=Object(D["a"])(ce,re,oe,!1,null,"6d2dbf95",null),he=le.exports,ge=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("input",{directives:[{name:"model",rawName:"v-model",value:t.targetTrack.name,expression:"targetTrack.name"},{name:"show",rawName:"v-show",value:t.viewState.trackNameInputTarget,expression:"viewState.trackNameInputTarget"}],style:t.style,domProps:{value:t.targetTrack.name},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onComplete(e)},blur:t.onComplete,input:function(e){e.target.composing||t.$set(t.targetTrack,"name",e.target.value)}}})},me=[],pe=function(t){Object(m["a"])(i,t);var e=Object(p["a"])(i);function i(){return Object(h["a"])(this,i),e.apply(this,arguments)}return Object(g["a"])(i,[{key:"targetTrack",get:function(){var t,e=this.viewState.trackNameInputTarget;return e&&null!==(t=this.diagram.stations[e.stationId].tracks.find((function(t){return t.id==e.trackId})))&&void 0!==t?t:{}}},{key:"style",get:function(){return this.viewState.trackNameInputTarget?{left:"".concat(this.diagram.config.stationLabelLeftMargin+this.diagram.config.trackLabelLeftMargin,"px"),top:"".concat(this.diagram.getYByRelY(this.targetTrack.relY)-this.diagram.config.stationLabelFontSize-4,"px"),width:"".concat(this.diagram.config.leftPaneWidth-this.diagram.config.stationLabelLeftMargin-this.diagram.config.trackLabelLeftMargin-this.diagram.config.stationLabelRightMargin,"px"),height:"".concat(this.diagram.config.stationLabelFontSize+4,"px"),paddingTop:"2px",lineHeight:"".concat(this.diagram.config.stationLabelFontSize,"px"),border:"none",fontSize:"".concat(this.diagram.config.stationLabelFontSize,"px")}:{}}},{key:"onComplete",value:function(){this.viewState.trackNameInputTarget=null}}]),i}(f["e"]);Object(u["a"])([Object(f["b"])()],pe.prototype,"viewState",void 0),Object(u["a"])([Object(f["b"])()],pe.prototype,"diagram",void 0),pe=Object(u["a"])([f["a"]],pe);var ue=pe,fe=ue,ve=Object(D["a"])(fe,ge,me,!1,null,"4c30130c",null),Se=ve.exports,be={stations:[{id:1,name:"上郡",tracks:[{id:1,name:"1"},{id:2,name:"2"}],mileage:0,expanded:!0},{id:15,name:"岩木（信）",tracks:[{id:1,name:""}],mileage:3.6},{id:3,name:"河野原円心",tracks:[{id:1,name:""}],mileage:7.4},{id:4,name:"久崎",tracks:[{id:1,name:""}],mileage:12.2},{id:5,name:"佐用",tracks:[{id:1,name:""}],mileage:17.2},{id:6,name:"平福",tracks:[{id:1,name:""}],mileage:22.5},{id:9,name:"大原",tracks:[{id:1,name:""}],mileage:33.2},{id:11,name:"あわくら温泉",tracks:[{id:1,name:""}],mileage:40.6},{id:14,name:"智頭",tracks:[{id:1,name:""}],mileage:56.1}],trains:[{id:721,name:"721D",stops:[{id:72109,stationId:9,trackId:1,depTime:20040},{id:72114,stationId:14,trackId:1,arrTime:21600}]},{id:723,name:"723D",stops:[{id:72309,stationId:9,trackId:1,depTime:23820},{id:72314,stationId:14,trackId:1,arrTime:25380}]},{id:725,name:"725D",stops:[{id:72501,stationId:1,trackId:1,depTime:23520},{id:72504,stationId:4,trackId:1,arrTime:24360,depTime:24600},{id:72505,stationId:5,trackId:1,arrTime:24900,depTime:25140},{id:72509,stationId:9,trackId:1,arrTime:26280,depTime:26940},{id:72511,stationId:11,trackId:1,arrTime:27540,depTime:27900},{id:72514,stationId:14,trackId:1,arrTime:28860}]},{id:727,name:"727D",stops:[{id:72701,stationId:1,trackId:1,depTime:25980},{id:72703,stationId:3,trackId:1,arrTime:26580,depTime:27180},{id:72704,stationId:4,trackId:1,arrTime:27480,depTime:27840},{id:72705,stationId:5,trackId:1,arrTime:28200,depTime:29100},{id:72709,stationId:9,trackId:1,arrTime:30240}]},{id:71,name:"71D",stops:[{id:7101,stationId:1,trackId:1,depTime:26700},{id:7105,stationId:5,trackId:1,arrTime:27420,depTime:27480},{id:7109,stationId:9,trackId:1,arrTime:28320,depTime:28380},{id:7114,stationId:14,trackId:1,arrTime:29340}]},{id:729,name:"729D",stops:[{id:72901,stationId:1,trackId:1,depTime:28260},{id:72904,stationId:4,trackId:1,arrTime:29160,depTime:29340},{id:72905,stationId:5,trackId:1,arrTime:29640,depTime:30060},{id:72909,stationId:9,trackId:1,arrTime:31200}]},{id:720,name:"720D",stops:[{id:72009,stationId:9,trackId:1,depTime:19140},{id:72005,stationId:5,trackId:1,arrTime:20220,depTime:20280},{id:72001,stationId:1,trackId:1,arrTime:21360}]},{id:722,name:"722D",stops:[{id:72209,stationId:9,trackId:1,depTime:22440},{id:72205,stationId:5,trackId:1,arrTime:23520,depTime:23820},{id:72204,stationId:4,trackId:1,arrTime:24120,depTime:24360},{id:72201,stationId:1,trackId:1,arrTime:25200}]},{id:724,name:"724D",stops:[{id:72414,stationId:14,trackId:1,depTime:22140},{id:72409,stationId:9,trackId:1,arrTime:23760,depTime:23820},{id:72405,stationId:5,trackId:1,arrTime:24900,depTime:25080},{id:72415,stationId:15,trackId:1,arrTime:25980,depTime:26280},{id:72401,stationId:1,trackId:1,arrTime:26520}]},{id:52,name:"52D",stops:[{id:5214,stationId:14,trackId:1,depTime:25680},{id:5209,stationId:9,trackId:1,arrTime:26580,depTime:26625},{id:5205,stationId:5,trackId:1,arrTime:27300,depTime:27480},{id:5201,stationId:1,trackId:1,arrTime:28140}]},{id:726,name:"726D",stops:[{id:72609,stationId:9,trackId:1,depTime:26940},{id:72606,stationId:6,trackId:1,arrTime:27720,depTime:27840},{id:72605,stationId:5,trackId:1,arrTime:28200,depTime:28260},{id:72601,stationId:1,trackId:1,arrTime:29400}]},{id:72,name:"72D",stops:[{id:7214,stationId:14,trackId:1,depTime:27240},{id:7209,stationId:9,trackId:1,arrTime:28200,depTime:28380},{id:7205,stationId:5,trackId:1,arrTime:29040,depTime:29100},{id:7201,stationId:1,trackId:1,arrTime:29820}]}],maxId:1e6},ke=function(t){Object(m["a"])(i,t);var e=Object(p["a"])(i);function i(){var t;return Object(h["a"])(this,i),t=e.apply(this,arguments),t.viewConfig=new T,t.viewState=new I,t.diagram=O.fromJSON({stations:[],trains:[]}),t.file=null,t}return Object(g["a"])(i,[{key:"stationsInMileageOrder",get:function(){return this.diagram.getStationsInMileageOrder()}},{key:"mounted",value:function(){window.addEventListener("resize",this.updateAppSize),this.updateAppSize(),this.diagram=O.fromJSON(be),this.updateY()}},{key:"unmounted",value:function(){window.removeEventListener("resize",this.updateAppSize)}},{key:"onStationNameInputStart",value:function(){var t=this;this.$nextTick((function(){return t.$refs.stationNameInput.$el.focus()}))}},{key:"onTrackNameInputStart",value:function(){var t=this;this.$nextTick((function(){return t.$refs.trackNameInput.$el.focus()}))}},{key:"onEditButtonClick",value:function(){this.viewState.editMode=!this.viewState.editMode}},{key:"onUploadButtonClick",value:function(){var t=this,e=document.createElement("input");e.type="file",e.accept=".json, application/json",e.onchange=function(){var i=new FileReader;if(e.files&&e.files.length>0){var a=e.files[0];i.readAsText(a),i.onload=function(){if("string"==typeof i.result){var e=JSON.parse(i.result);try{t.diagram=O.fromJSON(e)}catch(n){t.$buefy.notification.open({type:"is-danger",message:"".concat(t.$t("message.failedToLoadJSON").toString(),"<br>").concat(a.name)})}t.viewState=new I,t.updateAppSize(),t.viewState.diagramFileName=a.name,t.updateY()}}}},e.click()}},{key:"onDownloadButtonClick",value:function(){var t=JSON.stringify(this.diagram),e=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(e),a=document.createElement("a");a.href=i,a.download=this.viewState.diagramFileName,a.click()}},{key:"updateAppSize",value:function(){var t,e=document.getElementById("view-pane");e&&(this.viewState.viewWidth=e.clientWidth,this.viewState.viewHeight=e.clientHeight,this.viewState.appHeight=(null===(t=document.getElementById("app"))||void 0===t?void 0:t.clientHeight)||0)}},{key:"updateY",value:function(){var t=this,e=this.stationsInMileageOrder;if(0!=e.length){var i,a=e[0].mileage,n=Object(l["a"])(e);try{for(n.s();!(i=n.n()).done;){var r=i.value;r.mileage=r.mileage-a}}catch(g){n.e(g)}finally{n.f()}var o,s=this.diagram.config.plotPaneVerticalPadding,d=0,c=Object(l["a"])(e);try{var h=function(){var e=o.value;s+=(e.mileage-d)*t.diagram.config.yScale;var i=e.floating?e.topRelY:s;e.topRelY=i,e.expanded?(e.tracks.forEach((function(e,a){e.relY=i+(a+1)*t.diagram.config.trackLineSpan})),e.bottomRelY=i+(e.tracks.length+1)*t.diagram.config.trackLineSpan,s+=(e.tracks.length+1)*t.diagram.config.trackLineSpan):(Object.values(e.tracks).forEach((function(t){return t.relY=i})),e.bottomRelY=i),d=e.mileage};for(c.s();!(o=c.n()).done;)h()}catch(g){c.e(g)}finally{c.f()}this.viewState.maxRelY=e[e.length-1].bottomRelY+this.diagram.config.plotPaneVerticalPadding}}}]),i}(f["e"]);Object(u["a"])([Object(f["d"])()],ke.prototype,"viewConfig",void 0),Object(u["a"])([Object(f["d"])()],ke.prototype,"viewState",void 0),Object(u["a"])([Object(f["d"])()],ke.prototype,"diagram",void 0),ke=Object(u["a"])([Object(f["a"])({components:{Stage:Mt,StationAddTrackButton:Bt,StationExpandButton:Xt,StationNameInput:qt,StationRemoveButton:ne,StationRemoveTrackButton:he,TrackNameInput:Se}})],ke);var ye=ke,we=ye,Oe=(i("5c0b"),Object(D["a"])(we,d,c,!1,null,null,null)),Te=Oe.exports,Ie={ja:{message:{confirmRemoveStationRefered:"この駅を使用している列車があります。駅を削除すると、列車の時刻情報も削除されます。よろしいですか？",confirmRemoveTrackRefered:"この番線を使用している列車があります。番線を削除すると、列車の時刻情報も削除されます。よろしいですか？",failedToLoadJSON:"ファイルの読み込みに失敗しました。"}}};a["default"].config.productionTip=!1,a["default"].use(n["a"],{defaultNotificationDuration:5e3,defaultNotificationPosition:"is-bottom-right"}),a["default"].use(r["a"]),a["default"].use(s.a);var je=new r["a"]({locale:"ja",messages:Ie});new a["default"]({render:function(t){return t(Te)},i18n:je}).$mount("#app")}});
//# sourceMappingURL=app.8ad4c92a.js.map